# $Id: Makefile 40768 2016-04-26 17:41:35Z karl $
# Public domain.  Originally written by Manuel Pegourie-Gonnard, 2008.

DIR = man1 man5

export GROFF = groff
export PDFOPTS = -man -t -rS11
export PSPDF = ps2pdf -sPAPERSIZE=a4

all: $(DIR)
pdf: $(DIR)
clean: $(DIR)

# we don't cd to the new dir, since otherwise '.so man1/XXXX.1' doesn't work
$(DIR): 
	$(MAKE) -f $@/Makefile $(MAKECMDGOALS)
.PHONY: $(DIR)

# The rules for the .so pages are generated by this target.
# Compare by hand against man1/Makefile.
so_pattern = ^\(.*\)\.1:\.so \(.*\)\.1$$
so_replace = \1.man1.pdf: \1.1 \2.1\n\t$$(MKPDF)\n
so.rules:
	@grep '^\.so ' man1/* \
	| sed -e 's/$(so_pattern)/$(so_replace)/'
