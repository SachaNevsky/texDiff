%\iffalse meta-comment
%
% factura.dtx
% Copyright 2019 Emilio Augusto Lazo Zaia <emiliolazozaia@gmail.com>
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either
% version 1.3c of this license or (at your option) any later
% version. This version of this license is in
%   http://www.latex-project.org/lppl/lppl-1-3c.{html|txt|tex|pdf}
% and the latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3c or later is part of all distributions of
% LaTeX version 2008/05/04 or later.
%
% This work has the LPPL maintenance status `maintained'.
%
% The Current Maintainer of this work is Emilio Augusto Lazo Zaia.
%
% This work consists of the files README and factura.dtx
% with its derived files factura.ins, factura.cls, factura.def,
% factura-ejemplo-aux.tex, factura-ejemplo-firma.tex,
% factura-ejemplo-fondo.tex, factura-ejemplo-membrete.tex,
% factura-ejemplo-cotizacion.tex, factura-ejemplo-prefactura.tex,
% factura-ejemplo-factura01.tex, factura-ejemplo-factura02.tex,
% factura-ejemplo-factura03.tex, factura-ejemplo-factura04.tex,
% factura-ejemplo-factura05.tex, factura-ejemplo-factura06.tex,
% factura-ejemplo-factura07.tex, factura-ejemplo-factura08.tex,
% factura-ejemplo-factura09.tex, factura-ejemplo-factura10.tex,
% factura-ejemplo-reporte1.tex, factura-ejemplo-reporte2.tex,
% factura-ejemplo-reporte3.tex and factura-beispiel-rechnung.tex.
%<*internalbatchfile>
\def\nameofplainTeX{plain}
\ifx\fmtname\nameofplainTeX
\else
 \expandafter\begingroup
\fi
%</internalbatchfile>
%<*batchfile>
\input docstrip.tex
\preamble

Copyright 2019 Emilio Augusto Lazo Zaia <emiliolazozaia@gmail.com>

This work may be distributed and/or modified under the
conditions of the LaTeX Project Public License, either
version 1.3c of this license or (at your option) any later
version. This version of this license is in
 http://www.latex-project.org/lppl/lppl-1-3c.{html|txt|tex|pdf}
and the latest version of this license is in
 http://www.latex-project.org/lppl.txt
and version 1.3c or later is part of all distributions of
LaTeX version 2008/05/04 or later.

This work has the LPPL maintenance status `maintained'.

The Current Maintainer of this work is Emilio Augusto Lazo Zaia.

This work consists of the files README and factura.dtx
with its derived files factura.ins, factura.cls, factura.def,
factura-ejemplo-aux.tex, factura-ejemplo-firma.tex,
factura-ejemplo-fondo.tex, factura-ejemplo-membrete.tex,
factura-ejemplo-cotizacion.tex, factura-ejemplo-prefactura.tex,
factura-ejemplo-factura01.tex, factura-ejemplo-factura02.tex,
factura-ejemplo-factura03.tex, factura-ejemplo-factura04.tex,
factura-ejemplo-factura05.tex, factura-ejemplo-factura06.tex,
factura-ejemplo-factura07.tex, factura-ejemplo-factura08.tex,
factura-ejemplo-factura09.tex, factura-ejemplo-factura10.tex,
factura-ejemplo-reporte1.tex, factura-ejemplo-reporte2.tex,
factura-ejemplo-reporte3.tex and factura-beispiel-rechnung.tex.

\endpreamble
\keepsilent
\askforoverwritefalse
\obeyspaces
\Msg{*****************************************************************}
\Msg{**************************** factura ****************************}
\Msg{*****************************************************************}
\generate{\file{\jobname.cls}{\from{\jobname.dtx}{class}}}
\generate{\file{\jobname.def}{\from{\jobname.dtx}{def}}}
\Msg{\jobname.cls and \jobname.def written.}
\Msg{}
\postamble
\endpostamble
%</batchfile>
%<*internalbatchfile>
\generate{\file{\jobname.ins}{\from{\jobname.dtx}{batchfile}}}
\Msg{\jobname.ins written.}
%</internalbatchfile>
%<*batchfile>
\def\factuno{factura-ejemplo-factura01.tex}
\def\factdos{factura-ejemplo-factura02.tex}
\def\facttres{factura-ejemplo-factura03.tex}
\def\factcuatro{factura-ejemplo-factura04.tex}
\def\factcinco{factura-ejemplo-factura05.tex}
\def\factseis{factura-ejemplo-factura06.tex}
\def\factsiete{factura-ejemplo-factura07.tex}
\def\factocho{factura-ejemplo-factura08.tex}
\def\factnueve{factura-ejemplo-factura09.tex}
\def\factdiez{factura-ejemplo-factura10.tex}
\def\repuno{factura-ejemplo-reporte1.tex}
\def\repdos{factura-ejemplo-reporte2.tex}
\def\reptres{factura-ejemplo-reporte3.tex}
\def\cotiza{factura-ejemplo-cotizacion.tex}
\def\prefac{factura-ejemplo-prefactura.tex}
\def\beispiel{factura-beispiel-rechnung.tex}
\def\auxejemplo{factura-ejemplo-aux.tex}
\def\firma{factura-ejemplo-firma.tex}
\def\fondo{factura-ejemplo-fondo.tex}
\def\membrete{factura-ejemplo-membrete.tex}
\generate{\file{\factuno}{\from{\jobname.dtx}{factuno}}}
\generate{\file{\factdos}{\from{\jobname.dtx}{factdos}}}
\generate{\file{\facttres}{\from{\jobname.dtx}{facttres}}}
\generate{\file{\factcuatro}{\from{\jobname.dtx}{factcuatro}}}
\generate{\file{\factcinco}{\from{\jobname.dtx}{factcinco}}}
\generate{\file{\factseis}{\from{\jobname.dtx}{factseis}}}
\generate{\file{\factsiete}{\from{\jobname.dtx}{factsiete}}}
\generate{\file{\factocho}{\from{\jobname.dtx}{factocho}}}
\generate{\file{\factnueve}{\from{\jobname.dtx}{factnueve}}}
\generate{\file{\factdiez}{\from{\jobname.dtx}{factdiez}}}
\generate{\file{\repuno}{\from{\jobname.dtx}{repuno}}}
\generate{\file{\repdos}{\from{\jobname.dtx}{repdos}}}
\generate{\file{\reptres}{\from{\jobname.dtx}{reptres}}}
\generate{\file{\cotiza}{\from{\jobname.dtx}{cotiza}}}
\generate{\file{\prefac}{\from{\jobname.dtx}{prefac}}}
\generate{\file{\beispiel}{\from{\jobname.dtx}{beispiel}}}
\generate{\file{\auxejemplo}{\from{\jobname.dtx}{aux}}}
\generate{\file{\firma}{\from{\jobname.dtx}{firma}}}
\generate{\file{\fondo}{\from{\jobname.dtx}{fondo}}}
\generate{\file{\membrete}{\from{\jobname.dtx}{membrete}}}
\Msg{.tex examples written.}
\Msg{}
\Msg{*****************************************************************}
\immediate\write18{makeindex -s gind.ist -o \jobname.ind \jobname.idx}
\immediate\write18{makeindex -s gglo.ist -o \jobname.gls \jobname.glo}
\Msg{}
\Msg{Change history and index updated.}
\Msg{*****************************************************************}
\Msg{To produce only package files, type}
\Msg{  pdftex \jobname.dtx}
\Msg{To produce package files and pdf documentation, type}
\Msg{  xelatex \jobname.dtx}
\Msg{  pdflatex factura-ejemplo-fondo.tex}
\Msg{  pdflatex factura-ejemplo-membrete.tex}
\Msg{  xelatex factura-ejemplo-firma.tex}
\Msg{}
\Msg{Also compile all other examples and recompile \jobname.dtx.}
\Msg{(factura-ejemplo-aux.tex is not an example!)}
\Msg{}
\Msg{To manual update index and changelog, type}
\Msg{  makeindex -s gind.ist -o \jobname.ind \jobname.idx}
\Msg{  makeindex -s gglo.ist -o \jobname.gls \jobname.glo}
\Msg{}
\Msg{More information (in spanish) about compiling on README and documentation.}
\Msg{}
\Msg{*****************************************************************}
\Msg{**************************** factura ****************************}
\Msg{*****************************************************************}
\Msg{}
%</batchfile>
%<batchfile>\endbatchfile
%<*internalbatchfile>
\ifx\fmtname\nameofplainTeX
 \expandafter\endbatchfile
\else
 \expandafter\endgroup
\fi
%</internalbatchfile>
%<*driver>
\ProvidesFile{factura.dtx}
%</driver>
%<class>\NeedsTeXFormat{LaTeX2e}[1995/12/01]
%<class>\ProvidesClass{factura}
%<def>\ProvidesFile{factura.def}
%<*class|def>
[2019/08/16 v3.70
%<class>Clase para elaborar facturas legales
%<class>en la Repu'blica Bolivariana de Venezuela.
%<def>Archivo de valores iniciales y condiciones de borde para factura.cls
]

%</class|def>
%<*driver>
\documentclass{ltxdoc}
\usepackage[a4paper,headheight=0.6cm,headsep=0.77cm,footskip=1.2cm,footnotesep=0.54cm,marginparsep=10pt,vmargin={3cm,2cm},hmargin={4cm,2cm}]{geometry}
\usepackage[dvipsnames]{xcolor}
\usepackage[spanish]{babel}
\usepackage{
 array,
 calc,
 catchfilebetweentags,
 etoolbox,
 footnote,
 graphicx,
 ifluatex,
 ifxetex,
 metalogo,
 paralist,
 pgffor,
 regexpatch,
 setspace,
 tikz,
 todo,
 verbatim,
 xparse,
 xspace,
 xstring,
 hypdoc}

% Necesario ejecutar \newif de esta forma:
\csname newif\expandafter\endcsname\csname ifmotorunicode\endcsname
\csname newif\expandafter\endcsname\csname ifejemplos\endcsname

\ejemplostrue

\ifxetex
 \motorunicodetrue
\else
 \ifluatex \motorunicodetrue \fi
\fi

\ifmotorunicode
 \usepackage{fontspec}
 \setmainfont[Ligatures=TeX,Mapping=TeX]{Linux Libertine O}
\else
 \usepackage[T1]{fontenc}
 \usepackage[utf8]{inputenc}
\fi

\overfullrule15pt

\newcommand{\VERBATIM}{\verbatimcolor\setstretch{1.0}}

\xspaceaddexceptions{*}

\hypersetup{
 plainpages=false,
 colorlinks=true,
 linkcolor=blue,
 unicode=true}

\makesavenoteenv{tabular}
\makesavenoteenv{table}

\newcommand\flechaCR{%
 \raisebox{-0.4ex}{%
  \begin{tikzpicture}
  \draw[line width=0.075ex] (0,0) arc (20:70:0.75ex) + (0,0) arc (-70:-20:0.75ex) ++ (0.8ex,0.55ex) arc (0:-100:1ex);
 \end{tikzpicture}}}

\EnableCrossrefs
\CodelineIndex
\OnlyDescription
\RecordChanges

\setlength\parskip{7pt}
\setlength\IndexMin{100pt}

\widowpenalty10000

\newbool{Ejemplo}
\newbool{EjemploIzq}
\newbool{EjemploDer}
\newbool{DescripEjemplo}

\def\ejemplooptcolor{\color{blue}}
\def\ejemplomacrocolor{\color{purple}}
\def\verbatimcolor{\color{OrangeRed}}
\def\macromandcolor{\color{Red}}
\def\macrooptcolor{\color{RoyalBlue}}

\def\tikz{T\emph{i}kZ\xspace}

\catcode`\%=11
\catcode`\|=14
\NewDocumentCommand{\Ejemplo}{s O{0.5} m s O{} G{1} o}{|
 \IfFileExists{factura-#3.pdf}{|
  \catcode`\<=12
  \catcode`\>=12
  \IfBooleanTF{#4}
   {\IfBooleanTF{#1}
    {\booltrue{DescripEjemplo}}
    {\booltrue{Ejemplo}\booltrue{EjemploDer}}}
   {\IfBooleanTF{#1}
    {\booltrue{Ejemplo}\booltrue{EjemploIzq}}
    {\booltrue{Ejemplo}\booltrue{EjemploIzq}\booltrue{DescripEjemplo}}}
  \ifbool{Ejemplo}
   {\ifnum #6=1 \def\Ancho{#2}{\phantomsection\par\mbox{}\hfill{\color{RoyalBlue}\ttfamily \large factura-#3}\hfill\mbox{}\par}{}\fi}
   {\def\Ancho{0.05}}|
  \ifbool{EjemploDer}{\hfill}{}|
  \ifbool{Ejemplo}
   {\begin{minipage}{\Ancho\linewidth}
     \fbox{\includegraphics[page=#6,width=\linewidth-2\fboxrule-2\fboxsep]{factura-#3}}
     \ifbool{DescripEjemplo}{\addcontentsline{toc}{subsection}{factura-#3}}{}
    \end{minipage}}
   {}|
  \ifbool{EjemploIzq}{\hfill}{}|
  \ifbool{DescripEjemplo}
   {\hfill
   | Gracias a cfr y a egreg por el esclarecimiento en cuanto a la necesidad de \makeatletter en \CatchFileBetweenDelims y antes de \regexpatchcmd*.
   | Thanks to cfr and egreg for the clarification on the use of \makeatletter on \CatchFileBetweenDelims and before \regexpatchcmd*.
   | (https://tex.stackexchange.com/questions/380796/how-to-patch-a-macro-with-control-sequences-using-regexpatch)
   \CatchFileBetweenDelims{\DescEjemplo}{factura-#3.tex}{<desc>}{</desc>}[\catcode37=11\catcode13=14\makeatletter]|
   \catcode`\%=11
   \makeatletter
   | Gracias a Werner y a egreg por el uso de \begingroup\ttfamily\string ... \endgroup.
   | Thanks to Werner and egreg for the use of \begingroup\ttfamily\string ... \endgroup.
   | (http://tex.stackexchange.com/questions/342572/error-using-verb-as-the-replace-string-on-xpatchcmd)
   \regexpatchcmd*{\DescEjemplo}{\cC.\cO[*]*}{\c{begingroup}\c{ejemplomacrocolor}\c{ttfamily}\c{string}\0\c{endgroup}\c{xspace}}{}{}|
   \regexpatchcmd*{\DescEjemplo}{(\()(\cL[a-zG]*)(\))}{(\c{begingroup}\c{ejemplooptcolor}\c{ttfamily}\2\c{endgroup})}{}{}|
   \xpatchcmd*{\DescEjemplo}{%% }{\item}{}{}|
   \xpatchcmd*{\DescEjemplo}{%%}{}{}{}|
   \makeatother
   \begin{minipage}{\linewidth-\Ancho\linewidth}
    \begin{itemize}
     \setlength{\itemsep}{0pt}
     #5\DescEjemplo
    \end{itemize}
   \end{minipage}
   \IfValueT{#7}{{#7}}}
   {}|
  \boolfalse{Ejemplo}\boolfalse{EjemploIzq}\boolfalse{EjemploDer}\boolfalse{DescripEjemplo}|
  \catcode`\%=9
  \catcode`\<=13
  \catcode`\>=13
 }{\message{^^JLaTeX Warning: No existe factura-#4.pdf; hay que compilarlo antes de compilar este documento.^^J}}}
\catcode`\%=14
\catcode`\|=12

% No quiero que las notas pendientes tengan los n√∫meros de p√°gina:
\patchcmd{\todoitem}{(p.~\pageref{todopage:\thetodo}):}{-}{}{}

\renewcommand{\todoname}{Pendiente}
\renewcommand{\todomark}{Pendiente}
\newcommand{\changesname}{Lista de cambios en las versiones}
\newcommand{\glosname}{√çndice de comandos, entornos y opciones}

\makeatletter
 \def\SpecialEnvIndex#1{\@bsphack
  \index{#1\actualchar{\protect\ttfamily#1}
   (entorno)\encapchar usage}%
  \index{entornos:\levelchar#1\actualchar
   {\protect\ttfamily#1}\encapchar usage}\@esphack}
 \def\es@yearl{l a√±o}

 % Definimos el comando para describir opciones, que inexplicablemente falta en doc.sty:
 \def\DescribeOption{\leavevmode\@bsphack\begingroup\MakePrivateLetters
  \Describe@Option}
 \def\Describe@Option#1{\endgroup
  \marginpar{\raggedleft\PrintDescribeOption{#1}}%
  \SpecialOptionIndex{#1}\@esphack\ignorespaces}
 \def\SpecialOptionIndex#1{\@bsphack
  \index{#1\actualchar{\protect\ttfamily#1}
   (opci√≥n)\encapchar usage}%
  \index{opciones:\levelchar#1\actualchar{\protect\ttfamily#1}\encapchar
   usage}\@esphack}
 \def\PrintDescribeOption#1{\strut \MacroFont #1\ }

 % Redefinimos el comando del encabezado del √≠ndice:
 \def\index@prologue{%
  \section*{\glosname}%
  \markboth{\glosname}{\glosname}}%

 % Adaptamos un poco la lista de cambios:
 \def\changes@#1#2#3{%
  \protected@edef\@tempa{%
   \noexpand\glossary{%
    {\bfseries #1 --- #2}%
    \ifx\saved@macroname\@empty
     \relax\actualchar
    \else
     \saved@indexname
     \actualchar
     \string\verb\quotechar*%
     \verbatimchar\saved@macroname
     \verbatimchar
    \fi
    \levelchar #3}}%
  \@tempa\endgroup\@esphack}
 
 \def\@wrglossary#1{%
  \protected@write\@glossaryfile{}%
  {\string\glossaryentry{#1}{1}}%
  \endgroup\@esphack}%

 \patchcmd{\glossary@prologue}{Change History}{\changesname}{}{}
\makeatother

\title{The \textsf{\jobname} class\thanks{Esta documentaci√≥n corresponde a la clase \textsf{\jobname}~\fileversion, de fecha \filedate.}}
\author{Emilio Augusto Lazo Zaia\\ \texttt{<emiliolazozaia at gmail.com>}}

\GetFileInfo{\jobname.dtx}

\begin{document}
 \maketitle
 \DocInput{\jobname.dtx}
 \clearpage
 \phantomsection
 \addcontentsline{toc}{section}{\todoname}
 \todos
 \section*{Informaci√≥n espec√≠fica de esta versi√≥n + Reconversi√≥n Monetaria}
 % v2.82 Desde la versi√≥n v2.82 de esta clase, para poder compilar con \LuaLaTeX{} es necesaria la versi√≥n v2.26 del paquete |zref|, de fecha 2016/05/21, y la versi√≥n v1.18 de |atbegshi| de fecha 2016/06/09.

 % v2.82 -> Esta versi√≥n de |factura| se sac√≥ principalmente para corregir un error introducido en la versi√≥n anterior v2.72 en cuanto a las referencias, para agregar la opci√≥n |numitem| que enumera los √≠tems en la factura y para que la l√≠nea diagonal (opci√≥n |linea|) funcione correctamente siempre.
 
 % v3.00 -> Desde la versi√≥n v3.00, todos los ejemplos est√°n incorporados a la documentaci√≥n, con la descripci√≥n de cada uno, de manera automatizada.
 
 % v3.02 -> Esta versi√≥n v3.02 se saca porque la versi√≥n 3.9 de |fancyhdr| hizo necesaria esta actualizaci√≥n por un error que daba con los reportes por el uso en esta clase de la macro |\fancy@setoffs|. Lo que hac√≠amos con esa macro de |fancyhdr| lo hicimos ahora de otra forma mejor, dada la incompatibilidad con la nueva versi√≥n de ese paquete.%v3.02
 
 % v3.40 -> La versi√≥n 3.40 se saca por los cambios en la pol√≠tica impositiva decretados por el Presidente en Decreto n√∫mero 3085 relativos a descuentos del 3\% y 5\% en el IVA general cuando los pagos se hacen por medios electr√≥nicos; tambi√©n se corrigi√≥ la tasa de IVA adicional.
 
 % v3.40 -> En la versi√≥n 3.40 se agregaron nuevas opciones en cuanto al manejo de la fecha de emisi√≥n y su formato, posibilidad de facturas a cr√©dito con fecha de vencimiento, campos nuevos adicionales para agregar m√°s textos en la factura, posibilidad de imprimir informaci√≥n en el reverso de la hoja de la factura, posibilidades nuevas en cuanto al posicionamiento de los elementos fijos, dise√±o \tikz m√°s vers√°til en los cuadros con bordes, mejor manejo del archivo |.csv|, cambios en los nombres de algunos comandos y opciones.
 
 % v3.40 -> En la misma versi√≥n 3.40 se cambi√≥ la estructura de la secci√≥n de los comandos en esta documentaci√≥n y se agreg√≥ una p√°gina de descripci√≥n al final de cada ejemplo.
 
 % v3.44 -> El cambio en la pol√≠tica impositiva reflejado en la versi√≥n 3.40 queda sin efecto para fines legales, ya no est√° vigente dicho descuento; sin embargo, no eliminamos el c√≥digo que lo produce sino que la clase arroja una advertencia cuando se pide usar la opci√≥n de descuentos por pago electr√≥nico.
 
 % v3.44 -> Desde la versi√≥n 3.44 podemos activar cualquier opci√≥n de la clase a trav√©s de condicionales en el pre√°mbulo y no solamente como una opci√≥n al cargar la clase; tambi√©n se puede ahora quitar el efecto de cualquier opci√≥n previamente dada al cargar la clase, esto con el prop√≥sito de hacer m√°s vers√°til el uso de las opciones y as√≠ poder incluirlas tambi√©n en archivos |.tex| o |.def| personalizados.
 
 % v3.44 -> Adicionalmente desde la versi√≥n 3.44 el archivo |.log| de las compilaciones tiene como comentario todas las opciones que fueron pedidas al cargar la clase.
 
 % v3.47 -> La versi√≥n 3.47 corrige problemas con la compilaci√≥n en \LuaLaTeX{} y escribe la versi√≥n de la clase en el campo \texttt{Subject} de la {\slshape metadata} del archivo |.pdf| compilado.
 
 % v3.47 -> La versi√≥n 3.47 agrega el comando |\Moneda| para cambiar f√°cilmente la moneda.
 
 % v3.56 -> {\bfseries La versi√≥n 3.56 se saca para corregir la versi√≥n 3.47 en cuanto a dar cumplimiento al Decreto Presidencial 3.332 sobre la Reconvesi√≥n Monetaria.} Desde el 4 de junio del a√±o 2018 la moneda pasar√° a llamarse Bol√≠var Soberano (Bs.S) y luego en una fecha a√∫n no definida (la asumimos como el 1 de enero del a√±o 2019) la moneda volver√° a llamarse Bol√≠var (Bs.). Eventualmente el Banco Central de Venezuela emitir√° un comunicado para establecer desde cu√°ndo la moneda de curso legal vuelve a llamarse simplemente Bol√≠var. A part√≠r de esa fecha deber√° usarse el comando |\Moneda| para cambiar la moneda a su denominaci√≥n definitiva mientras no se haya emitido la actualizaci√≥n de esta clase. Esa fecha a√∫n no est√° determinada, as√≠ que la suponemos -y hacemos el cambio de moneda autom√°tico en esta clase- como el inicio del a√±o 2019. Antes del 4 de junio, se establece una nota interna autom√°tica que escribe el total tambi√©n en Bol√≠vares Soberanos.
 
 % v3.56 -> Por otra parte, la versi√≥n 3.56 elimina la inclusi√≥n del paquete |lmodern| y discrimina la inclusi√≥n de |fontenc| solamente para la compilaci√≥n con pdf\LaTeX, que es lo correcto. Adem√°s, en esta versi√≥n se agrega un campo extra opcional en los √≠tems de la factura para poder agregar una descripci√≥n m√°s larga a cada √≠tem que podr√° ser referenciada en otras partes del documento (por ejemplo en el reporte) pero que no aparece en el cuadro de la factura.

 % v3.56 -> En la versi√≥n 3.56 fueron corregidos errores en cuanto al posicionamiento de la l√≠nea diagonal y se agregaron las opciones: \texttt{sinlineahni}, \texttt{sinlineahtit} y \texttt{sinlineahtot} para poder quitar las l√≠neas horizontales internas una a una y no como antes, todas a la vez, con \texttt{sinlineashi}.

 % v3.57 -> {\bfseries Esta versi√≥n extraordinaria v3.57 se saca para dar cumplimiento al Decreto Presidencial 3.548 sobre la Reconversi√≥n Monetaria, publicado en Gaceta Oficial 41.446. Dicho decreto establece que la nueva moneda Bol√≠var Soberano no tendr√° 3 ceros menos como lo establec√≠a el derogado decreto 3.332 sino 5 ceros menos que el Bol√≠var Fuerte. La Reconversi√≥n Monetaria comienza el 20 de agosto del 2018\footnote{Salvo que se postergue otra vez.} y antes de esa fecha ya los precios tienen que estar especificados en ambas monedas, y esta clase est√° adaptada a esa exigencia.}

 % v3.57 -> Si el usuario especifica a mano la moneda con el comando |\Moneda| -introducido en una reciente versi√≥n-, la clase |factura| no interviene en nada en cuanto a la Reconversi√≥n Monetaria, ahora, si no se especifica la moneda, puede ocurrir lo siguiente:

 % v3.57 -> Al emitirse una factura con fecha anterior a la reconversi√≥n (20 de agosto del 2018), los montos quedar√°n expresados en Bol√≠vares Fuertes, simbolizado como {\slshape Bs.}, y la clase autom√°ticamente agregar√° un comentario como {\slshape nota interna} indicando cu√°l ser√≠a el monto en Bol√≠vares Soberanos; esto para dar cumplimiento al Decreto Presidencial que indica que los montos deben estar en expresados en ambas monedas antes de la entrada de la nueva moneda.

 % v3.57 -> Si se emite una factura con fecha posterior a la reconversi√≥n, los montos se asumir√°n como expresados en Bol√≠vares Soberanos, es decir, el usuario debe darlos ya con los 5 ceros quitados, la clase va a simbolizar la moneda como {\slshape Bs.S} y agregar√° un comentario similar al que acabamos de mencionar pero para expl√≠citar el monto en Bol√≠vares Fuertes, es decir, con 5 ceros m√°s; esto no forma parte del Decreto pero lo quisimos agregar.
 
 % v3.57 -> Luego, la moneda volver√° a llamarse Bol√≠var simplemente y se simbolizar√° otra vez como {\slshape Bs.}; ese momento a√∫n no lo sabemos pero para los efectos de esta clase vamos a asumirlo como que ocurrir√° el 1 de enero del a√±o 2019.
 
 % v3.57 -> Esta ser√° la √∫ltima versi√≥n que sacamos solamente para corregir fechas de la Reconversi√≥n Monetaria; si el Gobierno Nacional cambia las fechas nuevamente, el usuario tendr√° que hacer uso de la interfaz del paquete |datetime2| para ajustar el funcionamiento de esta clase a los nuevos plazos; para esto aclaramos que el identificador para la entrada de la Reconversi√≥n Monetaria se llama {\slshape FechaBsS}\footnote{recordemos que antes de esta fecha, los montos se expresan en Bol√≠vares Fuertes y la nota autom√°tica aclara cu√°nto es en Bol√≠vares Soberanos, y despu√©s de esta fecha es al contrario.} y el identificador para el momento (que a√∫n no se ha dicho) desde el cual la moneda vuelve a llamarse Bol√≠var es {\slshape FechaBs}. Para ajustarlos se usa el comando \cs{DTMsavedate} y las fechas se dan en formato {\slshape yyyy-mm-dd}. Damos como ejemplo lo que actualmente est√° programado en esta clase:
 
 Desde el 15/02/2019 la moneda nacional se vuelve a llamar ‚ÄúBol√≠var‚Äù abreviado ‚ÄúBs‚Äù sin ‚Äúsoberano‚Äù; esto seg√∫n Gaceta Oficial 41.587. Quitamos toda referencia a la Reconversi√≥n Monetaria.
 
 Tambi√©n en esta versi√≥n establecemos la tasa de IVA general como 16\% tal como ya est√° vigente desde agosto del a√±o 2018.
 
 Ya no est√° activa la opci√≥n |electro| para descuentos en pagos por medios electr√≥nicos porque ya no est√° vigente el decreto.
 
 Ahora en los totales aparece el signo monetario siempre a menos de que se pida en la clase la opci√≥n |sinmonedatotales|.
 
 En esta misma versi√≥n se agreg√≥ un ‚Äúgancho‚Äù llamado \cs{BeforeEndPreamble} para usos muy espec√≠ficos.
 
 Las ‚Äúcondiciones del documento‚Äù ya no son ‚Äúcondiciones‚Äù sino que ahora lo llamamos ‚Äúnota final‚Äù porque es otra nota m√°s aparte de las dem√°s, y va al final del documento; no tiene sentido hablar de condiciones del documento para referirse a ese espacio. Con eso se renombran los 5 comandos, pero dejando por compatibilidad unos alias a los viejos; los nuevos son: \cs{NotaFinal}, \cs{PosNotaFinal}, \cs{SepNotaFinal}, \cs{LineaNotaFinal}, \cs{LetraNotaFinal}.

 La macro \cs{PosNotaFinal} se comporta ahora como \cs{PosFirmas}, es decir, acepta un valor inicial en ‚Äúx‚Äù y uno final.

 \section*{Agradecimientos}
 
 Por pruebas y sugerencias que dieron lugar a mejoras agradezco a Ritguey%
 \ifmotorunicode\footnote{\setmainfont{Symbola}üêß}\else\message{^^J^^JLaTeX Warning: Compila con XeLaTeX.^^J}\fi{}
 Flores Esteves y a Alberto Mijares. Por contribuciones a trav√©s de \texttt{StackExchange} agradezco a Alan Munn, cfr, David Carlisle, egreg, Gustavo Mezzetti, Heiko Oberdiek, jfbu, Joseph Wright, Werner y wipet. El motivo por el que se da cada agradecimiento est√° como comentario en el archivo |.cls| o en el |.dtx|.
 
 \addcontentsline{toc}{section}{\changesname}
 {\makeatletter\def\pfill{\unskip\hfill\@gobble}\makeatother
  \setlength{\columnsep}{0pt}
  \PrintChanges}
 \phantomsection
 \addcontentsline{toc}{section}{\glosname}
 \PrintIndex
\end{document}
%</driver>
% \fi
%
%^^A Gracias a jfbu y a Joseph Wright por \starttodo, \stoptodo, \endorgo.
%^^A Thanks to jfbu and Joseph Wright for \starttodo, \stoptodo, \endorgo.
%^^A (http://tex.stackexchange.com/questions/235680/add-something-to-the-driver-section-inside-the-package-code-using-onlydescripti)
% \long\def\stoptodo#1\starttodo {}%
% \long\def\starttodo#1\stoptodo {}%
%
% \makeatletter
% \def\endorgo #1{%
%  \ifx #1\endinput\expandafter\stoptodo
%  \else #1\expandafter\@gobble\fi}%
% \makeatother
%
%^^A No se puede calcular el checksum con \OnlyDescription.
% \CheckSum{0}
%
% \CharacterTable
%  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
%   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
%   Digits        \0\1\2\3\4\5\6\7\8\9
%   Exclamation   \!     Double quote  \"     Hash (number) \#
%   Dollar        \$     Percent       \%     Ampersand     \&
%   Acute accent  \'     Left paren    \(     Right paren   \)
%   Asterisk      \*     Plus          \+     Comma         \,
%   Minus         \-     Point         \.     Solidus       \/
%   Colon         \:     Semicolon     \;     Less than     \<
%   Equals        \=     Greater than  \>     Question mark \?
%   Commercial at \@     Left bracket  \[     Backslash     \\
%   Right bracket \]     Circumflex    \^     Underscore    \_
%   Grave accent  \`     Left brace    \{     Vertical bar  \|
%   Right brace   \}     Tilde         \~}
%
% \changes{v1.00}{2013/04/29}{Primera versi√≥n.}
% \changes{v2.00}{2015/03/30}{Segunda versi√≥n: errores corregidos, comandos y opciones nuevas, ambiente de reporte, documentaci√≥n completa, ejemplos y convertido todo a formato \texttt{.dtx}.}
% \changes{v2.05}{2015/04/13}{Se cambi√≥ de \texttt{4pt} a \texttt{6pt} en \texttt{factura.def} para el margen interno predeterminado en las cajas del encabezado y en la descripci√≥n.}
% \changes{v2.05}{2015/04/13}{Se quit√≥ \texttt{UTF8} de \texttt{inputenc} como un paquete que se cargue de forma predeterminada.}
% \changes{v2.05}{2015/04/13}{Advierte que no son compatibles los comandos \cs{Descuento} con la opci√≥n \texttt{filas}.}
% \changes{v2.05}{2015/04/13}{Se puso un parche en \cs{@CargaFondoReporte} para arreglar que \cs{topskip} aplicara bien en \cs{@EncabezadoReporte}.}
% \changes{v2.05}{2015/04/13}{Arreglada la interacci√≥n entre las opciones \texttt{ivanoexplicito} y \texttt{filas}, y se quit√≥ la l√≠nea del total cuando se usa \texttt{ivanoexplicito}.}
% \changes{v2.05}{2015/04/13}{Se renombr√≥ la opci√≥n \texttt{relleno} a \texttt{exparriba}, a la vez que se quit√≥ \cs{Descripcion*} porque se agreg√≥ la opci√≥n \texttt{sinexpandir}.}
% \changes{v2.05}{2015/04/13}{Se renombr√≥ la opci√≥n \texttt{ivanoexplicito} por \texttt{sinivaexpresado}.}
% \changes{v2.05}{2015/04/13}{Se cambiaron los \cs{AtBeginDocument} por \cs{AtBeginShipoutNext} de la factura porque daba problemas al especificar \texttt{conreporte} sin luego agregar el ambiente de reporte.}
% \changes{v2.05}{2015/04/13}{Se coloc√≥ \cs{@SeparaMinTotales} dentro de otro \cs{AtBeginDocument} m√°s adecuado.}
% \changes{v2.05}{2015/04/13}{Modificaciones en la documentaci√≥n y en los ejemplos.}
% \changes{v2.05}{2015/04/13}{Los comandos \cs{ItemX} ahora colocan la l√≠nea bien con la opci√≥n \texttt{lineaitem}.}
% \changes{v2.1}{2015/08/26}{Advierte cuando la fecha del documento es distinta de la fecha del dia.}
% \changes{v2.1}{2015/08/26}{Los comandos de descuentos totales aceptan un * como argumento para que el descuento pueda ser en moneda y no en porcentaje.}
% \changes{v2.1}{2015/08/26}{Quitados los alias de macros viejas agregados por compatibilidad.}
% \changes{v2.1}{2015/08/26}{Corregida la forma como sale la denominaci√≥n del impuesto para todos los casos.}
% \changes{v2.1}{2015/08/26}{Corregida y mejorada la documentaci√≥n.}
% \changes{v2.1}{2015/08/26}{Correcciones en los ejemplos.}
% \changes{v2.1}{2015/08/26}{Mejor manejo de \cs{InicioReporte}.}
% \changes{v2.6}{2016/03/07}{Cambiado el lugar donde se fija el nombre del documento (FACTURA o COTIZACI√ìN) porque antes no era correcto y no se pod√≠a cambiar el nombre de la cotizaci√≥n a algo distinto como por ejemplo PRESUPUESTO.}
% \changes{v2.6}{2016/03/07}{Se renombr√≥ la opci√≥n \texttt{sincond} en favor de \texttt{sincondiciones}.}
% \changes{v2.6}{2016/03/07}{Cambiado ‚Äúcondiciones de pago‚Äù por ‚Äúcondiciones del documento‚Äù.}
% \changes{v2.6}{2016/03/07}{Los descuentos globales aceptan decimales bien; antes no.}
% \changes{v2.6}{2016/03/07}{Se cambi√≥ la forma como se llama al ambiente \texttt{tabularx} en la factura creando una nueva macro que se eval√∫a completamente resultando en la definici√≥n de las columnas.}
% \changes{v2.6}{2016/03/07}{Agregadas cuatro opciones: \texttt{sinlineasvi}, \texttt{sinlineasve}, \texttt{sinlineash}, \texttt{sinlineashi}, \texttt{sinlineashe} y renombrada la opci√≥n \texttt{lineaitem} por \texttt{conlineasha} aludiendo a ‚Äúcon l√≠neas horizontales para los art√≠culos‚Äù.}
% \changes{v2.6}{2016/03/07}{Se arregl√≥ la l√≠nea oblicua que en algunos casos segu√≠a sin salir.}
% \changes{v2.6}{2016/03/07}{Textos ‚ÄúPAGADO‚Äù y ‚ÄúPor el emisor‚Äù para las facturas y cotizaciones cuando no se define el emisor del documento.}
% \changes{v2.6}{2016/03/07}{Nueva opci√≥n \texttt{dosfirmas} para poner las dos firmas en casos en los que lo predeterminado sea una o ninguna firma (cotizaciones o prefacturas).}
% \changes{v2.6}{2016/03/07}{Nuevo comando \cs{Conforme} para el nombre de quien recibe la factura.}
% \changes{v2.6}{2016/03/07}{Cambiado el lugar en el c√≥digo donde se llama a la macro que dibuja la l√≠nea inutilizadora del espacio en blanco y se hace ahora con \cs{AddToShipoutPicture} para que no se genere un espacio en blanco extra.}
% \changes{v2.6}{2016/03/07}{El ejemplo de la documentaci√≥n es de una cotizaci√≥n y no de una prefactura; actualizada la documentaci√≥n y los ejemplos.}
% \changes{v2.6}{2016/03/07}{En el √≠ndice ponemos ‚Äúentorno‚Äù en lugar de ‚Äúenvironment‚Äù.}
% \changes{v2.6}{2016/03/07}{El verbo ‚Äúponer‚Äù es digno para la documentaci√≥n. No s√≥lo las gallinas ponen.}
% \changes{v2.6}{2016/03/07}{Renombrado el comando \cs{EstiloPag} por \cs{InfoPagina}; tambi√©n \cs{LetraEncReporte} por \cs{LetraInfoPagina}; por otra parte se cambi√≥ \cs{LetraDatosReporte} en favor de \cs{LetraEncReporte}, y por √∫ltimo se cambi√≥ \cs{LetraTitRenglon} por \cs{LetraTitColumnas}.}
% \changes{v2.6}{2016/03/07}{Renombrados los estilos de p√°gina: \texttt{soloenc} a \texttt{soloarriba}, y \texttt{solopie} a \texttt{soloabajo}.}
% \changes{v2.6}{2016/03/07}{Se mejor√≥ el c√≥digo relativo al estilo de p√°gina del reporte y agregada la macro \cs{EstiloPagReporte} para establecer el estilo de p√°gina del reporte.}
% \changes{v2.6}{2016/03/07}{Se agreg√≥ una forma para que m√°s de una l√≠nea en la descripci√≥n de la factura sea mejor manejada.}
% \changes{v2.6}{2016/03/07}{Mejorado el c√≥digo de la macro interna \cs{@EscribeTipoDeImpuesto}.}
% \changes{v2.6}{2016/03/07}{Cuando la descripci√≥n en el cuadro de la factura ocupa m√°s que una l√≠nea, agrega al final de cada l√≠nea el car√°cter $\hookleftarrow$.}
% \changes{v2.6}{2016/03/07}{Corregido que salga la ‚ÄúG‚Äù obligatoria de IVA General cuando hay un elemento exento y uno con IVA General.}
% \changes{v2.6}{2016/03/07}{Cuatro nuevas definiciones dentro del archivo \texttt{factura.def} para establecer algunos caracteres que antes estaban fijados dentro del archivo \texttt{factura.cls}}
% \changes{v2.6}{2016/03/07}{{\slshape parbox}es para cada elemento en la tabla, para asegurar que la denominaci√≥n del gravamen quede alineada correctamente.}
% \changes{v2.6}{2016/03/07}{Quitados los paquetes \texttt{xifthen} y \texttt{pbox}. Arreglada la presentaci√≥n de los datos del cliente cuando el resumen es m√°s grande.}
% \changes{v2.6}{2016/03/07}{Cuando hab√≠a descuentos totales y se ped√≠a modo de totalizaci√≥n en filas, este modo no se apagaba correctamente y la l√≠nea oblicua daba problemas. Arreglado.}
% \changes{v2.72}{2016/05/16}{Las macros internas \cs{@DescripcionAuxCmd} y \cs{@EscribeTipoDeImpuesto} fueron modificadas.}
% \changes{v2.72}{2016/05/16}{Arreglada la alineaci√≥n a la derecha en algunos casos en los precios.}
% \changes{v2.72}{2016/05/16}{Se incluy√≥ dentro de la macro interna \cs{@ITEM} la opci√≥n para soportar \cs{ItemX}.}
% \changes{v2.72}{2016/05/16}{Ahora se procesa el entorno de la factura a√∫n cuando se pide s√≥lo el reporte, para poder tomar las referencias y los totales. Para eso se cambiaron de sitio varias macros internas.}
% \changes{v2.72}{2016/05/16}{Agregadas las etiquetas y las referencias.}
% \changes{v2.82}{2016/06/25}{Agregada la opci√≥n \texttt{numitem} para enumerar cada √≠tem en la factura.}
% \changes{v2.82}{2016/06/25}{Corregido problema de etiquetas repetidas introducido en la versi√≥n 2.72.}
% \changes{v2.82}{2016/06/25}{Corregida la alineaci√≥n vertical entre las distintas columnas agregando \texttt{[t]} al abrir los ‚Äú{\slshape parboxes}‚Äù en los comandos auxiliares que ponen cada celda en un {\slshape parbox} del tama√±o de la celda m√°s grande, porque si no se centra verticalmente la celda y se desalinea respecto a la columna de al lado.}
% \changes{v2.82}{2016/06/25}{Ahora dentro de la definici√≥n de \cs{@CaracterCeldasVacias} est√° el c√≥digo que centra el texto, para poder usar comandos que llenen la caja completa como \cs{dotfill}.}
% \changes{v2.82}{2016/06/25}{Reimplementada la l√≠nea diagonal para que funcione en todos los casos.}
% \changes{v2.82}{2016/06/25}{Nueva macro interna \cs{@ColumnasMultiColumnTotalesAuxCmd} para hacer m√°s general la colocaci√≥n de los totales en el modo de columnas dentro de un \cs{multicolumn}.}
% \changes{v2.82}{2016/06/25}{Quitado el paquete \texttt{MnSymbol} en favor del comando \cs{flechaCR} para la flecha que indica que la descripci√≥n ocupa m√°s de una l√≠nea.}
% \changes{v3.00}{2017/03/11}{Se agreg√≥ la opci√≥n \texttt{sinmarcas} para pedir que no se escriba el car√°cter de fin de linea cuando la descripci√≥n ocupa m√°s que una l√≠nea y tambi√©n para evitar que salga el car√°cter que marca las celdas vac√≠as tambi√©n cuando la decripci√≥n es larga.}
% \changes{v3.00}{2017/03/11}{Nueva macro \cs{SepItemsExtra} para agregar espacio extra entre los √≠tems en la factura.}
% \changes{v3.00}{2017/03/11}{Opci√≥n nueva \texttt{sintotales} para que no se escriba ning√∫n total de los elementos. √ötil para cotizaciones de por ejemplo varias formas de un mismo producto.}
% \changes{v3.00}{2017/03/11}{Opci√≥n nueva \texttt{centradesc} para centrar el texto en la descripci√≥n de cada elemento en la factura.}
% \changes{v3.00}{2017/03/11}{Cambiado el interlineado en la documentaci√≥n, el tama√±o del papel y agregados a la documentaci√≥n todos los ejemplos que est√°n embebidos en el \texttt{.dtx}, de forma autom√°tica.}
% \changes{v3.00}{2017/03/11}{El descuento individual ahora es opcional al pedir la opci√≥n, es decir, no hace falta establecer en '0' los elementos donde no haya descuento cuando se usa la opci√≥n \texttt{descuentos}.}
% \changes{v3.00}{2017/03/11}{Opci√≥n \texttt{subtotal} para agregar una columna extra despu√©s del precio unitario y antes del descuento, para reflejar el precio antes de aplicar el descuento individual.}
% \changes{v3.02}{2017/07/16}{Ya no usamos la macro \cs{fancy@setoffs} de \texttt{fancyhdr} en el reporte para establecer valores iniciales por ejemplo de la longitud de la l√≠nea en los encabezados; ahora lo hacemos de una forma diferente, incluyendo en el \texttt{.def} una macro llamada \cs{@GrosorLineaInfoPag} que alberga el valor que \texttt{fancyhdr} asigna preterminadamente al grosor de dicha l√≠nea. No agregamos un comando para cambiar ese valor por no ser algo de relevancia.}
% \changes{v3.02}{2017/07/16}{Ajustada ligeramente esta lista de cambios y la inclusi√≥n de los ejemplos en la documentaci√≥n.}
% \changes{v3.40}{2017/12/11}{Se agreg√≥ la opci√≥n \texttt{electro} para dar cumplimiento con el Decreto Presidencial 3085 y la Providencia Administrativa 0048 que establece descuentos en el IVA.}
% \changes{v3.40}{2017/12/11}{Macros nuevas para notas internas al cuadro de la factura y externas a √©l.}
% \changes{v3.40}{2017/12/11}{Ahora \cs{PosCond} acepta \texttt{*} para que el texto pueda abrir hacia arriba en la posici√≥n establecida y no solamente hacia abajo.}
% \changes{v3.40}{2017/12/11}{Agregado el comando \cs{Credito} para la posibilidad de facturas a cr√©dito donde es calculada la fecha de vencimiento de la factura que aparecer√° debajo de la fecha de emisi√≥n.}
% \changes{v3.40}{2017/12/11}{Ahora \cs{PosFecha} tambi√©n acepta \texttt{*} para que las fechas (emisi√≥n y vencimiento) puedan fijarse tambi√©n respecto a una posici√≥n final y no solamente inicial.}
% \changes{v3.40}{2017/12/11}{El comando \cs{Fecha} acepta \texttt{*} para poder especificar la fecha en formato \texttt{iso} de forma m√°s est√°ndar para que sea tomada correctamente por el paquete \texttt{datetime2}, usado para calcular la fecha de vencimiento.}
% \changes{v3.40}{2017/12/11}{Se agreg√≥ la macro \cs{FormatoFecha} para poder cambiar el formato en el que el usuario da la fecha de emisi√≥n y c√≥mo √©sta es presentada.}
% \changes{v3.40}{2017/12/11}{Si no se especifica la fecha, ser√° tomada la fecha actual y generar√° una advertencia indicando eso y no un error indicando que no se ha especificado la fecha, como era antes.}
% \changes{v3.40}{2017/12/11}{Actualizada la documentaci√≥n para reflejar los cambios.}
% \changes{v3.40}{2017/12/11}{Se renombr√≥ \cs{@EstiloFecha} por \cs{@EstiloFechas}, y \cs{@PosicionaFecha} por \cs{@PosicionaFechas}.}
% \changes{v3.40}{2017/12/11}{Reestructuraci√≥n de la documentaci√≥n.}
% \changes{v3.40}{2017/12/11}{Nueva opci√≥n \texttt{vencimiento} para poner la fecha de vencimiento a√∫n en facturas a contado.}
% \changes{v3.40}{2017/12/11}{Tambi√©n \cs{PosDenom} y \cs{PosControl} aceptan \texttt{*}. Cambi√≥ en 2mm el margen superior predeterminado, as√≠ como tambi√©n hubo un cambio en la coordenada vertical de la fecha, la denominaci√≥n del documento y el n√∫mero de control, ya que antes los predeterminados estaban especificados sin \texttt{*} y luego no.}
% \changes{v3.40}{2017/12/11}{No poner el tel√©fono ahora produce una advertencia y no un error como antes.}
% \changes{v3.40}{2017/12/11}{Funciones internas para los mensajes informaticos, advertencias y errores de la clase.}
% \changes{v3.40}{2017/12/11}{Se le agreg√≥ la posibilidad de \texttt{*} a la macro interna \cs{@DatosAux} para que pudiera ser utilizada la misma macro por los casos donde hay resumen y donde no lo hay.}
% \changes{v3.40}{2017/12/11}{A los cuadros dibujados con \tikz les fue separada la definici√≥n del nodo para ponerla dentro del \texttt{.def} en lugar de estar en el \texttt{.cls}.}
% \changes{v3.40}{2017/12/11}{Cuando se especifica 0 como grosor de l√≠nea para la descripci√≥n o el encabezado, desaparece la l√≠nea completamente y la estructura \tikz.}
% \changes{v3.40}{2017/12/11}{Renombrada \cs{PosCond} a \cs{PosCondiciones}.}
% \changes{v3.40}{2017/12/11}{Ahora las condiciones aceptan l√≠nea en \tikz, es decir que hay dos macros nuevas: \cs{LineaCondiciones} y \cs{SepCondiciones}. Predeterminadamente las condiciones quedaron como antes, o sea sin dise√±o de \tikz.}
% \changes{v3.40}{2017/12/11}{Quitada la macro interna \cs{@TamDescrip} porque no hac√≠a nada.}
% \changes{v3.40}{2017/12/11}{Renombrada \cs{SepEncabez} a \cs{SepEncabezado}, tambie≈Ñ \cs{SepDescrip} a \cs{SepDescripcion}, \cs{LineaEncabez} en favor de \cs{LineaEncabezado}, y \cs{LineaDescrip} en favor de \cs{LineaDescripcion}, as√≠ como algunas macros internas asociadas a ellas.}
% \changes{v3.40}{2017/12/11}{Macro nueva para una nota previa al cuadro de la factura.}
% \changes{v3.40}{2017/12/11}{La macro \cs{SepEncabezado} fue dividida entre \cs{SepDatosResumen} y \cs{SepEncabezado}. La macro \cs{SepElementos} fue renombrada a \cs{SepVertical} y \cs{LetraTitCuadro} a \cs{LetraTitColumnas}.}
% \changes{v3.40}{2017/12/11}{Contador \texttt{@NumItem} renombrado a \texttt{NumItem}. Las macros para los par√°metros de las l√≠neas ahora aceptan dar solamente el primer argumento, por ejemplo para definir que no salga la l√≠nea, s√≥lo basta con por ejemplo \cs{LineaEncabezado}{0pt}.}
% \changes{v3.40}{2017/12/11}{Nuevo par√°metro opcional despu√©s de la descripci√≥n en los \cs{Item***} para cambiar el campo que va a salir en el \texttt{.csv}, y ahora se puede especificar un descuento individual en los √≠tems, que ser√° ignorado si no se carga la opci√≥n para descuentos individuales.}
% \changes{v3.40}{2017/12/11}{Actualizada la tasa de IVA adicional.}
% \changes{v3.40}{2017/12/11}{Nueva opci√≥n \texttt{iva} para agregar una columna adicional que muestra el IVA de cada item.}
% \changes{v3.40}{2017/12/11}{Modificada la macro interna \cs{@DescripcionAuxCmd} por problemas que daba en algunos casos.}
% \changes{v3.40}{2017/12/11}{Se renombr√≥ la opci√≥n \texttt{exparriba} por \texttt{expandecuadro}.}
% \DoNotIndex{}
% \changes{v3.40}{2017/12/11}{Modificada la definici√≥n de \cs{ItemX} para que maneje la descripci√≥n especial para el archivo \texttt{csv}.}
% \changes{v3.40}{2017/12/11}{Nuevo comando \cs{ivaref} para referenciar el IVA del √≠tem etiquetado.}
% \changes{v3.40}{2017/12/11}{Se cambiaron unos \cs{AtEndDocument} por \cs{AtBeginShipoutNext}. Se hizo necesario siempre el paquete \texttt{eso-pic}.}
% \changes{v3.40}{2017/12/11}{Se quit√≥ la fijaci√≥n del estilo de p√°gina de un \cs{AtBeginDocument} innecesario. Nuevo entorno \texttt{reverso} para el reverso de la factura y nuevo comando para la letra predeterminada del entorno: \cs{LetraReverso}.}
% \changes{v3.40}{2017/12/11}{Cada ejemplo tiene una p√°gina al final con su explicaci√≥n correspondiente.}
% \changes{v3.40}{2017/12/11}{Ahora en los ejemplos, primero va la opci√≥n o la macro entre par√©ntesis y despu√©s va la explicaci√≥n y no al rev√©s como era antes.}
% \changes{v3.40}{2017/12/11}{Quitada la opci√≥n \texttt{sincondiciones}. Si no se establecen las condiciones produce una advertencia.}
% \changes{v3.40}{2017/12/11}{Quitada la macro \cs{mostrar}. Ahora cada texto a mostrar se hace con el mismo comando con el que se defini√≥.}
% \changes{v3.40}{2017/12/11}{Algunos condicionales cambiados.}
% \changes{v3.40}{2017/12/11}{Otra vez corregida la macro interna \cs{@DescripcionAuxCmd} y arreglado el espaciado entre los √≠tems; ojal√° que esta vez s√≠ est√© bien.}
% \changes{v3.44}{2018/03/13}{Reestructurado el archivo \texttt{.cls} para aceptar prender y apagar las opciones de la clase a trav√©s de condicionales de \TeX{} con el mismo nombre de la opci√≥n.}
% \changes{v3.44}{2018/03/13}{Se cambi√≥ un \cs{AtBeginDocument} que escrib√≠a texto en la hoja por un \cs{AfterEndPreamble}.}
% \changes{v3.44}{2018/03/13}{Se acab√≥ el descuento del IVA. Ahora advierte cuando se usa, posibilitando su uso despu√©s si llegan a volver a activar la medida.}
% \changes{v3.44}{2018/03/13}{Cada opci√≥n cargada escribe un comentario en el archivo \texttt{.log} para depuraci√≥n.}
% \changes{v3.47}{2018/04/17}{No compilaba con \LuaLaTeX{} por diferencias en el motor. Ya compila.}
% \changes{v3.47}{2018/04/17}{Agrega la versi√≥n de la clase bajo \texttt{Subject} en la metadata de los PDF compilados.}
% \changes{v3.47}{2018/04/17}{Se agrega la macro \cs{Moneda} para cambiar el signo monetario a usar.}
% \changes{v3.47}{2018/04/17}{Se da cumplimiento al Decreto Presidencial 3.332 de la reconversi√≥n monetaria.}
% \changes{v3.47}{2018/04/17}{Cambiados algunos de los \cs{immediate}\cs{write} por \cs{write}.}
% \changes{v3.56}{2018/05/09}{Quitamos \texttt{lmodern} de todas partes y mejoramos la inclusi√≥n discrecional de \texttt{fontenc}.}
% \changes{v3.56}{2018/05/21}{Agregada la opci√≥n de una descripci√≥n larga para cada √≠tem de la factura √∫nicamente para referenciarla luego en otra parte del documento.}
% \changes{v3.56}{2018/05/21}{La implementaci√≥n anterior del Bol√≠var Soberano ten√≠a defectos; ya est√°n corregidos.}
% \changes{v3.56}{2018/05/21}{Volvimos a agregar la macro interna \cs{@TamDescripcion} quitada en la versi√≥n v3.40. Sin ella la l√≠nea no sal√≠a bien con la opci√≥n \texttt{filas}.}
% \changes{v3.56}{2018/05/21}{Creamos condicionales internos: \cs{if@ExpandeCuadro} y otros para evaluar la l√≠nea inutilizadora del espacio en blanco, as√≠ como tambi√©n unas macros que guardan los valores de \cs{baselineskip} y \cs{tabcolsep} y otros cambios en la l√≠nea.}
% \changes{v3.56}{2018/05/21}{Nuevas opciones \texttt{sinlineahni}, \texttt{sinlineahtit} y \texttt{sinlineahtot} para no poner la l√≠nea horizontal antes de la nota interna, despu√©s del t√≠tulo de las columnas y antes de los totales.}
% \changes{v3.56}{2018/05/21}{Agregamos el paquete \texttt{anyfontsize}.}
% \changes{v3.57}{2018/08/02}{El Gobierno Nacional posterga la Reconversi√≥n Monetaria. Cambiamos un poco la forma como estaba programado esto. El usuario podr√° cambiar las fechas que intervienen en eso, por si ocurre otro cambio.}
% \changes{v3.70}{2019/08/17}{Nueva tasa de IVA general del 16\% vigente desde agosto del 2018.}
% \changes{v3.70}{2019/08/17}{Establecido el 15/02/2019 como la fecha en la que ocurre que la nueva moneda pierde el adjetivo ‚Äúsoberano‚Äù para llamarse ‚Äúbol√≠var‚Äù simplemente.}
% \changes{v3.70}{2019/08/17}{Nueva macro interna \cs{@EstableceOpciones} para poder evaluarla doblemente, una antes del -nuevo tambi√©n- gancho \cs{BeforeEndPreamble} y otra despu√©s de √©l, porque en ese gancho se puede escribir c√≥digo que altere las opciones y deber√°n ser evaluadas nuevamente para la consistencia entre ellas.}
% \changes{v3.70}{2019/08/17}{Inhabilitada la opci√≥n \texttt{electro} pero se deja el c√≥digo todav√≠a, aunque comentado.}
% \changes{v3.70}{2019/08/17}{Se coment√≥ todo el c√≥digo referente a la Reconversi√≥n Monetaria.}
% \changes{v3.70}{2019/08/17}{Implementada la funci√≥n de que agregue el signo monetario en los totales, y una opci√≥n \texttt{sinmonedatotales} para evitarlo.}
% \changes{v3.70}{2019/08/17}{Ya no hablamos de condiciones sino de ‚Äúnota final‚Äù, que es aquello que va despu√©s de la descripci√≥n larga y que tiene posici√≥n fija. Ese espacio se puede usar para distintas cosas, por lo que hablar de ese espacio como el de las condiciones del documento no tiene mucho sentido. De manera que los comandos renombrados pasaron a ser \cs{NotaFinal}, \cs{PosNotaFinal}, \cs{SepNotaFinal}, \cs{LineaNotaFinal}, \cs{LetraNotaFinal}. Se mantienen los comandos anteriores por compatibilidad.}
% \changes{v3.70}{2019/08/17}{Corregido el posicionamiento en ‚Äúx‚Äù de la nota final.}
% \changes{v3.70}{2019/08/17}{Ahora la macro \cs{PosNotaFinal} acepta un intervalo en ‚Äúx‚Äù para posicionar la nota final, es decir que funciona como \cs{PosFirmas}.}
% \changes{v3.70}{2019/08/17}{Mejorada la macro interna que escribe la fecha en la metadata; ya no usa \texttt{xstring} sino \LaTeX3. Quitado c√≥digo esp√∫reo de \texttt{xstring} en las macros que permiten fijar las posiciones de los elementos fijos.}
%
%
% \tableofcontents
%
%
% \section*{Brief description in english}
%
% |factura| is the spanish word for `invoice', so this is a \LaTeX{} class for typesetting and calculating invoices, made taking into account requirements of {\slshape SENIAT} legislation (tax collector entity on the Bolivarian Republic of Venezuela), but its use is not restricted to Venezuela because all variables and displayed text can be redefined by invoking commands or editing.
%
% \newpage
% \setstretch{1.4}
%
%
% \section{Introducci√≥n}
%
% La clase de \LaTeX{} |factura| est√° dise√±ada para su uso en la Rep√∫blica Bolivariana de Venezuela, conforme a los requerimientos fijados por las providencias del {\slshape SENIAT} 0591, 0257, 0071 y 0048, v√°lidas √©stas para agosto del a√±o 2019.
%
% Con |factura| se pueden elaborar facturas en formas libres fiscales\footnote{En cuanto a las formas libres, cada hoja del talonario de facturas legales tiene un encabezado con los datos del emisor de la factura y un pie de p√°gina con la informaci√≥n de identificaci√≥n de la imprenta, en tama√±o de hoja carta entera; esto es lo que se llama ‚Äúforma libre‚Äù.}, cotizaciones y reportes de servicios, dejando todos los c√°lculos a \TeX{}.
%
% El dise√±o de las facturas hechas con esta clase consiste en un encabezado con los datos que identifican al cliente, con al lado un -opcional- resumen; estas partes de la factura est√°n encerradas en recuadros. Si no se especifica el resumen saldr√° solamente una de estas cajas en el encabezado que es la de los datos del cliente.
%
% Luego de esto viene un -opcional- recuadro con una nota donde puede ir la forma de pago, luego un cuadro con los campos: cantidad, descripci√≥n, precio unitario y precio total\footnote{Pueden haber variaciones en estos campos controlables con las opciones de la clase (v√©anse subsecciones \ref{subsec:columnas}, \ref{subsec:descuentos} y \ref{subsec:sincantidad}).}, con los elementos a facturar, cada uno en una l√≠nea, luego los totales, luego una -opcional- nota dentro del cuadro de la factura, otra nota (opcional tambi√©n) despu√©s del cuadro de la factura y al final viene una opcional descripci√≥n larga que sale en un recuadro. La factura puede tener tambi√©n un reverso con m√°s informaci√≥n.
%
% En fin, la factura consta de:
% \begin{enumerate}[\bfseries i)]
%  \item el encabezado con los datos del cliente y el -opcional- resumen,
%  \item la opcional nota previa al cuadro de la factura,
%  \item el cuadro con los elementos que se est√°n facturando y las totalizaciones,
%  \item la opcional nota interna al cuadro de la factura,
%  \item la opcional nota externa al cuadro de la factura,
%  \item una opcional descripci√≥n larga, e
%  \item informaci√≥n opcional en el reverso de la hoja.
% \end{enumerate}
%
% Aparte, el usuario puede escribir un reporte largo asociado a la factura, es decir, esta clase sirve tambi√©n para escribir reportes.
%
% \newpage
%
%
% \section{Instalaci√≥n}
%
% El paquete que est√° en CTAN consta de un archivo |README| en formato |UTF-8|, esta documentaci√≥n compilada como |factura.pdf| y el archivo |factura.dtx|, del cual se generan todos los dem√°s archivos.
%
% Al compilar |factura.dtx| va a producirse |factura.cls| y |factura.def|, adem√°s de todos los ejemplos en archivos |.tex| y |factura.ins|.
%
% \noindent Si queremos solamente generar los archivos sin compilar la documentaci√≥n, debemos ejecutar:
%
% \noindent {\color{RoyalBlue}|pdftex factura.dtx|}
%
% \noindent Para generar los archivos y tambi√©n compilar la documentaci√≥n, debemos ejecutar los siguientes pasos:
%
% \begin{enumerate}[\bfseries 1. ]
%
% \item {\color{RoyalBlue}|xelatex factura.dtx|}\footnote{Es preferible compilar el |.dtx| con \XeLaTeX{} o con \LuaLaTeX pero tambi√©n puede hacerse con pdf\LaTeX.}
%
% Luego de compilar |factura.dtx| hay que compilar el fondo de ejemplo, el membrete de ejemplo y la firma de ejemplo; estos tres archivos emulan haber digitalizado una hoja de una factura del talonario fiscal, un membrete para los reportes y tambi√©n una firma que puede agregarse a los documentos a producir. Estos ejemplos se usar√°n en algunos de los ejemplos de formatos que inclu√≠mos y por eso es necesario tenerlos compilados en |.pdf| previamente, ya que su inclusi√≥n en los ejemplos es en formato compilado |.pdf|.
%
% El fondo y membrete de ejemplo los debemos compilar as√≠:
%
% \item {\color{RoyalBlue}|pdflatex factura-ejemplo-fondo.tex|}
% \item {\color{RoyalBlue}|pdflatex factura-ejemplo-membrete.tex|}
%
% La firma escaneada de ejemplo necesita compilarse con \XeLaTeX{} porque son c√≥digos en PSTricks y debe producirse un |.pdf|. Se compila as√≠:
%
% \item {\color{RoyalBlue}|xelatex factura-ejemplo-firma.tex|}
%
% Al tener el fondo, el membrete y la firma compilados en |.pdf| seg√∫n los pasos anteriores, podremos compilar cualquiera de los ejemplos en |.tex| que el archivo |factura.dtx| genera, y eso lo debemos hacer, ya que todos ellos (en su versi√≥n en |.pdf|) forman parte de la documentaci√≥n. Los podemos compilar as√≠:
%
% \item {\color{RoyalBlue}|pdflatex factura-ejemplo-prefactura.tex|}
%
% De esta forma como compilamos {\ttfamily factura-ejemplo-prefactura} compilamos todos los dem√°s ejemplos: la cotizaci√≥n, las facturas del 1 hasta la √∫ltima, el reporte del 1 hasta el √∫ltimo, y finalmente la factura para otra legislaci√≥n.\footnote{Podemos tambi√©n compilar con \LuaLaTeX{} o con \XeLaTeX{}.}
%
% Al tener todo esto hecho volvemos a compilar |factura.dtx| para producir esta documentaci√≥n, puesto que el |.dtx| necesita ser compilado m√°s de una vez para que la documentaci√≥n quede correctamente elaborada:
%
% \item {\color{RoyalBlue}|xelatex factura.dtx|}
%
% Los comandos para generar el √≠ndice y la lista de cambios, que autom√°ticamente se ejecutan al compilar |factura.dtx| son:
%
% \item {\color{RoyalBlue}|makeindex -s gind.ist -o factura.ind factura.idx|}
% \item {\color{RoyalBlue}|makeindex -s gglo.ist -o factura.gls factura.glo|}
%
% {\slshape No es necesario actualizar los √≠ndices con los dos comandos anteriores porque esos dos comandos los ejecuta el motor de compilaci√≥n al actuar sobre }|factura.dtx|.
%
% \end{enumerate}
%
%
% \section{Archivos inclu√≠dos en el paquete}
%
% Este paquete incluye varios ejemplos, entre ellos la emulaci√≥n de un dise√±o de factura entregado por alguna imprenta, que nos sirve para nuestros ejemplos de prefacturas, un dise√±o de membrete que nos sirve para los reportes, una firma que emula ser una firma real escaneada para su inclusi√≥n en algunos casos, as√≠ como varios ejemplos de facturas, prefacturas, cotizaciones y reportes. Cada uno de ellos tiene al principio del documento fuente la aclaratoria de qu√© es lo que hace, para diferenciarlo de los dem√°s ejemplos.
%
% \noindent \begin{tabular}{rl}
%  \bfseries Archivo & \bfseries Descripci√≥n \\ \hline
%  |factura.dtx| & Archivo principal del que todos los dem√°s se generan, \\
%  |factura.pdf| & Esta documentaci√≥n, \\
%  |README| & Archivo con la descripci√≥n corta, \\
%  |factura-ejemplo-firma.tex| & Ejemplo de firma digitalizada, \\
%  |factura-ejemplo-fondo.tex| &  Elemplo de una forma libre fiscal digitalizada, \\
%  |factura-ejemplo-membrete.tex| & Ejemplo de membrete para los reportes, \\
%  |factura-ejemplo-aux.tex| & Archivo auxiliar que se incluye en todos los ejemplos y \\
%                            & sirve para que cada ejemplo conste de su descripci√≥n, \\
%  |factura-ejemplo-prefactura.tex| & Ejemplo de ‚Äú{\slshape prefactura}‚Äù, \\
%  |factura-ejemplo-cotizacion.tex| & Ejemplo de cotizaci√≥n, \\
%  |factura-ejemplo-factura*.tex| & Ejemplos de facturas, \\
%  |factura-ejemplo-reporte*.tex| & Ejemplos de reportes, \\
%  |factura-beispiel-rechnung.tex| & Un ejemplo de una factura adaptada a otra legislaci√≥n. \\ \hline
% \end{tabular}
%
% \IfFileExists{factura-ejemplo-prefactura.pdf}{%
%  \newpage\section{Ejemplo preliminar\label{sec:ejemplo}}
%  Lo que sigue es un ejemplo del aspecto final de una {\slshape ‚Äúprefactura‚Äù}, que est√° bajo el nombre de ‚Äú|factura-ejemplo-prefactura.tex|‚Äù y m√°s adelante explicaremos en qu√© consiste:
%
%  \noindent
%  \mbox{}\hfill
%  \vfil
%  \fbox{\includegraphics[width=0.9\linewidth]{factura-ejemplo-prefactura.pdf}}
%  \hfill\mbox{}
%  \vfil\mbox{}
%  \newpage}
% {\message{^^JLaTeX Warning: No existe factura-ejemplo-prefactura.pdf; hay que compilarlo antes de compilar este documento.^^J}}
%
%
% \section{Geometr√≠a de la hoja\label{sec:geohoja}}
%
% El espacio que la imprenta deja en blanco en la forma libre est√° todo disponible para la impresi√≥n de la factura con esta clase. Este espacio se delimita con el paquete |geometry|. Los valores predeterminados que tienen que ver con la geometr√≠a de la hoja est√°n todos definidos dentro del archivo |factura.def|.
%
% El margen superior que se da con |geometry| est√° contabilizado desde el inicio del papel\footnote{El papel predeterminado es tama√±o carta.} hasta donde empieza el encabezado con los datos del cliente, es decir que el encabezado es el primer elemento desde arriba hacia abajo en una factura.
%
% El margen inferior de |geometry| empieza donde termina la descripci√≥n del servicio -o el fin del cuadro de la factura, en caso de que no se agregue un texto de descripci√≥n larga-, hasta el final del papel.
%
% Para aclarar lo anterior es necesario decir que hay textos con posiciones fijas que est√°n fuera de estos m√°rgenes, como la fecha de emisi√≥n, la ‚Äúdenominaci√≥n‚Äù del documento (que es ‚ÄúFACTURA‚Äù, ‚ÄúCOTIZACI√ìN‚Äù u otro especificable), el n√∫mero de la factura, el n√∫mero de control (cuando aplica), las nota final y los espacios para las firmas; todas estas partes del documento est√°n fijas en posiciones arbitrarias fuera de los m√°rgenes dejados por |geometry|. Estos textos son fijos para darles posiciones que no dependan del contenido particular de cada factura sino del dise√±o del talonario que ya tenemos impreso, que siempre ser√° igual, y para el cual estamos adaptando esta clase |factura|.
%
% Las ubicaciones de los textos fijos tambi√©n tienen valores predefinidos dentro de |factura.def|. Cualquiera de esos valores puede cambiarse mediante comandos, tal como se fijan los valores predeterminados en dicho archivo |.def|; esto significa que se puede personalizar a cualquier dise√±o del talonario entregado por la imprenta, basta con entender qu√© hace cada comando (explicado en este documento), consultar el |.def| o ver los ejemplos.
%
% En algunos casos las formas libres tienen impreso el n√∫mero de la factura y no es controlable esto por el emisor (como ocurre con el n√∫mero de control que la legislaci√≥n obliga a que siempre venga impreso en cada hoja del talonario). En otros casos el emisor tiene la libertad de escribir el n√∫mero de la factura y controlarlo √©l mismo. Se puede hacer funcionar la clase seg√∫n cualquiera de estas dos formas con una opci√≥n en |\documentclass|, es decir, podemos imprimir el n√∫mero de la factura donde queramos, o tambi√©n podemos asumirlo impreso en el talonario, seg√∫n sea el caso del talonario que tengamos.
%
% Al usarse esta clase se deben primero hacer medidas en las facturas que la imprenta nos entrega para fijar los m√°rgenes y determinar d√≥nde poner los textos fijos que se deseen cambiar de la posici√≥n que viene predeterminada.
%
% El archivo |factura.def| tiene todas aquellas definiciones y valores que pueden ser ajustados; basta usarlos en nuestros documentos de la misma forma como est√°n predefinidos all√≠; eso aplica no s√≥lo para los de la geometr√≠a de la hoja sino para cualquier ajuste que est√© en ese archivo o cualquier campo que tenga alg√∫n texto o palabra predefinida para la legislaci√≥n venezolana.
%
%
% \section{Uso de la clase}
%
% El documento debe comenzarse con |\documentclass{factura}| con las opciones necesarias, que se explicar√°n en la secci√≥n \ref{sec:opciones}. Despu√©s se definen a trav√©s de macros {\bfseries en el pre√°mbulo} todas las variables y dimensiones para personalizar el documento, esto es las posiciones de los textos fijos, tipos de letra (opcional), datos del cliente, un resumen (opcional), fecha y dem√°s. Despues de |\begin{document}| va el cuadro de la factura propiamente, para lo cual la clase define un entorno llamado |factura|
% \DescribeEnv{factura}
% (|\begin{factura}...\end{factura}|), en cuyo interior se escriben √∫nicamente los elementos a facturar a trav√©s de comandos del tipo |\Item|\footnote{Es posible incluir elementos gravados en IVA con al√≠cuota general (12\%), al√≠cuota reducida (8\%), al√≠cuota adicional (27\%), as√≠ como tambi√©n elementos exentos de impuesto al valor agregado, con \cs{Item}, \cs{ItemR}, \cs{ItemA} e \cs{ItemE} respectivamente.}, especificando su cantidad, descripci√≥n y precio unitario como argumentos, en ese orden.
%
% Finalizado el entorno se puede escribir (opcionalmente) una descripci√≥n larga o una aclaratoria de lo que se factura; esto se hace con el comando |\Descripcion|.
%
% Algunas de las posibilidades de cambio de estilo de esta clase consisten en que puede cambiarse la forma como es presentado cualquiera de los textos, se pueden suprimir las l√≠neas verticales y horizontales del cuadro de la factura, se pueden agregar l√≠neas horizontales separando cada √≠tem, tambi√©n se puede dibujar una l√≠nea oblicua que proteja el cuadro de la factura de adiciones posteriores de texto, entre otras prestaciones m√°s.
%
% Si el emisor lo desea puede digitalizar su firma personal y colocarla en el espacio ya dispuesto para firmar, con un ajuste m√≠nimo para que salga correctamente sobre la l√≠nea.
%
% Tambi√©n el usuario tiene la posibilidad de producir una {\slshape ‚Äúprefactura‚Äù}; as√≠ le llamamos a un documento sin validez legal pero que puede ser enviado por fax o por correo electr√≥nico. Este documento tiene el mismo aspecto de la factura fiscal si se digitaliza la forma libre vac√≠a\footnote{Quit√°ndole las numeraciones obviamente. Tambi√©n puede dise√±arse en un |.tex| una forma libre vac√≠a id√©ntica a la que se tiene, as√≠ como se hace en el ejemplo inclu√≠do.}, se incluye la imagen como fondo de la p√°gina y se definen las posiciones fijas de las numeraciones impresas en el talonario, es decir el n√∫mero de factura y el n√∫mero de control, de los que hablamos previamente.
%
% Con esta misma clase tiene se la posibilidad de imprimir un informaci√≥n en el reverso de la hoja de la factura que saldr√° escrita utilizando toda la hoja (los m√°rgenes son ajustables). Esa informaci√≥n se encierra en un ambiente destinado para ese fin (|\begin{reverso}...\end{reverso}|),
% \DescribeEnv{reverso}
% y al momento de la compilaci√≥n puede decidirse si se imprime esa parte o no.
%
% Otra posibilidad que da esta clase es la de escribir un reporte largo asociado a la factura\footnote{Si lo hubiera, as√≠ como tambi√©n se puede usar estar clase para elaborar un reporte sin asociarlo a una factura en particular.}. Tal reporte se escribe dentro de un ambiente en el mismo documento en el que se escribe la factura asociada a √©l (|\begin{reporte}...\end{reporte}|),
% \DescribeEnv{reporte}
% y con dar una opci√≥n al inicio se puede hacer que se impirma el reporte en las p√°ginas siguientes a la factura, o tambi√©n se puede hacer que se imprima s√≥lo el reporte ignorando todo lo que no constituye el reporte, de la misma manera como tambi√©n se puede hacer que se imprima s√≥lo la factura ignorando el entorno |reporte|. Esto permite tener todo en un mismo documento e imprimir lo que se desee en el momento, o todo a la vez.
%
%
% \section{Compilaci√≥n de un documento\label{sec:compila}}
%
% Para compilar una |factura| puede usar cualquiera de los motores \LaTeX, pdf\LaTeX, \XeLaTeX{} o \LuaLaTeX, naturalmente con las restricciones que impone cada uno.
%
% Hay casos en los que hace falta compilar m√°s de una vez el documento. Dos veces necesita ser compilado un documento cuando alguna descripci√≥n en el cuadro de la factura ocupa m√°s que una l√≠nea; tambi√©n dos veces cuando se incluye una firma en el reporte, y tres o cuatro veces cuando se pide que se dibuje una l√≠nea oblicua que inutilice el espacio restante en el cuadro de la factura o cuando se usan etiquetas (secci√≥n \ref{sec:etiquetas}).
%
% Todo documento |.pdf| compilado con la clase |factura| escribe en la {\slshape metadata} del |.pdf| un texto con la versi√≥n y la fecha de la clase con la que se compil√≥; ese texto va en el campo |Subject| de dicha {\slshape metadata}.
%
%
% \section{Opciones al cargar la clase\label{sec:opciones}}
%
%  Al cargar la clase con |\documentclass| podemos dar distintas opciones seg√∫n el comportamiento que queramos; dichas opciones est√°n descritas en esta secci√≥n y cualquier opci√≥n cargada se ver√° como comentario en el archivo |.log| de la compilaci√≥n bajo el texto ‚Äú{\ttfamily Opci√≥n cargada: }‚Äù con el nombre de la opci√≥n pedida.
%
%
% \subsection{Sobre el tipo de documento a producir}
%
% {\setlength{\parindent}{0pt}
%
% \DescribeOption{prefactura}
%  La {\slshape ‚Äúprefactura‚Äù} es un documento no legal, preliminar, que no se imprime sobre papel de factura sino que est√° concebido para enviarse por correo o fax. Para eso se define la imagen que contiene el dise√±o de la factura con el comando |\FondoFactura|, luego la clase escribe la denominaci√≥n ‚ÄúFACTURA‚Äù con su n√∫mero\footnote{Lo predeterminado cuando no es una {\slshape ‚Äúprefactura‚Äù} sino una factura final es no escribir la denominaci√≥n ni el n√∫mero, ya que eso generalmente viene impreso en cada hoja del talonario.}. Esta opci√≥n implica la opci√≥n |sinfirmas|, ya que si es un documento preliminar sin validez legal, las firmas no son necesarias; sin embargo se puede cambiar este comportamiento con las opciones |dosfirmas| y |unafirma|.
%
% \DescribeOption{cotizacion}
%  La cotizaci√≥n es un documento similar a una factura pero no es un documento legal en el sentido de que no se imprime sobre talonario fiscal alguno, as√≠ que no lleva n√∫mero de control y puede o no tener su propia numeraci√≥n, que es cosa del emisor de la cotizaci√≥n. Esta opci√≥n implica la opci√≥n |unafirma|, para que firme el emisor de la factura, y si su nombre no se especifica saldr√° ‚ÄúPor el emisor‚Äù debajo de la l√≠nea para firmar. Tambi√©n puede cambiarse esto con la opci√≥n |dosfirmas| o con |sinfirmas|.
%
% \DescribeOption{sinreverso}
%  No escribe la informaci√≥n -opcional- que se escribi√≥ dentro del entorno |reverso| a salir en el reverso de la factura.
%
% \DescribeOption{conreporte}
%  Genera la factura (prefactura o cotizaci√≥n) y luego el reporte.
%
% \DescribeOption{soloreporte}
%  Genera solamente el reporte, ignorando lo relacionado con la factura. Si no se especifica |conreporte| ni |soloreporte| se va a imprimir √∫nicamente la factura.
%
%
% \subsection{Relativo a las columnas que puede tener el cuadro de la factura\label{subsec:columnas}}
%
% \DescribeOption{numitem}
%  Con la opci√≥n |numitem| una nueva columna aparece en el cuadro de la factura donde se enumera cada √≠tem en el √≥rden en el que se escriben dentro del entorno para la factura. Esto es √∫til por ejemplo cuando se hace referencia al n√∫mero del √≠tem con el comando |\itemref|. V√©ase la secci√≥n \ref{sec:etiquetas}.
%
% \DescribeOption{sincantidad}
%  El ambiente |factura| tiene tambi√©n la posibilidad de no mostrar el campo de la cantidad, ni aceptarlo como argumento de cada √≠tem; en ese caso los comandos |\Item| -de los que hablaremos en la secci√≥n \ref{sec:factura}- aceptan como argumentos solamente la descripci√≥n del elemento y su precio, en ese orden.
%
% \DescribeOption{descuentos}
%  Permite agregar un descuento en porcentaje en cada elemento de la factura, siendo dicho porcentaje el √∫ltimo argumento de los comandos |\Item|. Si no aplica descuento para un √≠tem, puede este dejarse sin ese argumento, dando el mismo resultado que indicar ‚Äú0‚Äù como argumento para ese descuento. (Explicado tambi√©n en la secci√≥n \ref{subsec:descuentos}).
%
% \DescribeOption{subtotal}
%  Agrega una columna extra en la factura; s√≥lo aplica cuando tambi√©n se usa la opci√≥n |descuentos|. La nueva columna escribe el subtotal que cada √≠tem produce, es decir, el precio unitario multiplicado por la cantidad sin aplicar el descuento. Esta opci√≥n sobrecarga la factura (precio unitario, descuento, subtotal y precio total), y su uso es recomendable cuando tambi√©n se usa |sincantidad|, porque de esta forma se tiene el subtotal, el descuento, y el total.
%
% \DescribeOption{iva}
%  Agrega una nueva columna donde se expresa el porcentaje del IVA para cada elemento en la factura. Sin especificar esta opci√≥n queda claro seg√∫n lo establecido por nuestra legislaci√≥n cu√°l ser√° el gravamen que aplica para cada elemento por una letra que lo denota al lado del precio o de la descripci√≥n.
%
% \DescribeOption{duc}
%  Cambia el orden de los campos en el documento impreso a: descripci√≥n, precio unitario, cantidad y precio total. {\itshape Esto no cambia la forma como deben especificarse los argumentos de |\Item| sino solamente cambiar√° c√≥mo ser√°n mostrados}.
%
% \DescribeOption{dcu}
%  Cambia el orden de los campos en el documento impreso a: descripci√≥n, cantidad, precio unitario y precio total\footnote{Sin \texttt{duc} ni \texttt{dcu}, el modo predeterminado es \texttt{cdu}: cantidad, descripci√≥n, precio unitario.}.
%
%
% \subsection{Relativo al IVA}
%
% \DescribeOption{siniva}
%  No se cobra IVA, para los casos en los que eso aplique.
%
% \DescribeOption{sinivaexpresado}
%  Al no cobrar IVA, tampoco aparece en la totalizaci√≥n los IVA ni las bases imponibles.
%
% \DescribeOption{todosiva}
%  Agrega el monto exento y todos los tipos de IVA en los totales as√≠ no se hayan inclu√≠do elementos gravados con los distintos tipos de impuesto.
%
% \DescribeOption{electro}
%  {\bfseries Esta opci√≥n ya no est√° vigente en la legislaci√≥n y se quit√≥ de esta clase.} Se agreg√≥ en su momento esta opci√≥n para dar cumplimiento con las Gacetas Oficiales n√∫meros 41239, 41242 y 41244\footnote{De fecha 19, 21 y 26 de septiembre del a√±o 2017, respectivamente. En la √∫ltima de estas gacetas est√° la Providencia Administrativa PA0048 del SENIAT.} donde se establece que las operaciones de compra (salvo excepciones establecidas en la Gaceta) gravadas con IVA general gozar√°n de un descuento cuando son pagadas mediante medios electr√≥nicos. El descuento es del 3\% cuando la factura es de un monto menor a Bs.F 2.000.000 y del 5\% cuando el monto de la factura es de Bs.F 2.000.000 o m√°s. Al dar esta opci√≥n el descuento queda establecido seg√∫n el Decreto Presidencial n√∫mero 3085.
%
% {\itshape Esta opci√≥n no es compatible con el modo de totalizaci√≥n en filas.}
%
% \DescribeOption{G}
%  Agrega una ‚Äú|G|‚Äù al lado de todos los items gravados con IVA general as√≠ sea el general el √∫nico IVA existente en la factura.
%
% \DescribeOption{impdesc}
%  Con esta opci√≥n, la letra que indica la denominaci√≥n del impuesto aplicado a cada elemento, en lugar de escribirse en el precio unitario y en el total, que es la forma predeterminada, sale escrito al final de la descripci√≥n. Puede preferirse de esta forma, y ahorra un poco de espacio usable en la descripci√≥n porque ya no sale en dos lugares dicha letra sino en uno solo.
%
%
% \subsection{Sobre las l√≠neas en el cuadro de la factura}
%
% \DescribeOption{sinlineasve}
% \DescribeOption{sinlineasvi}
% \DescribeOption{sinlineasv}
% \DescribeOption{sinlineashe}
% \DescribeOption{sinlineashi}
% \DescribeOption{sinlineash}
%  La clase provee varias opciones para no dibujar las l√≠neas del cuadro de la factura. La clase diferencia entre las l√≠neas internas y las l√≠neas externas. Las l√≠neas externas son las que conforman el contorno externo del cuadro de la factura. Las l√≠neas internas en el caso de las horizontales son la l√≠nea que va despu√©s del t√≠tulo de las columnas (cantidad, descripci√≥n, ...), la l√≠nea que separa los √≠tems de los totales y la l√≠nea que separa los totales de la nota interna; en el caso de las verticales, las l√≠neas internas son las que separan las columnas.
%
%  Podemos apagar cada conjunto de l√≠nea; ya explicado qu√© es interno y qu√© es externo, queda aclarar que ‚Äúve‚Äù significa vertical externa, ‚Äúvi‚Äù vertical interna, ‚Äúhe‚Äù horizontal externa y ‚Äúhi‚Äù horizontal interna. Usando |sinlineasv| o |sinlineash| apagamos todas las l√≠neas verticales u horizontales.
%
% \DescribeOption{sinlineahtit}
% \DescribeOption{sinlineahtot}
% \DescribeOption{sinlineahni}
%  Adicionalmente podemos apagar las l√≠neas horizontales internas por separado, es decir, la l√≠nea que va despu√©s del t√≠tulo de las columnas la podemos quitar con \texttt{sinlineahtit}, la l√≠nea que separa los elementos a facturar de los totales generales se puede quitar con \texttt{sinlineahtot} y la l√≠nea que separa los totales de la -opcional- nota interna la podemos quitar con \texttt{sinlineahni}. 
% 
% \DescribeOption{conlineasha}
%  Agrega una l√≠nea horizontal separando cada art√≠culo o √≠tem de los dem√°s dentro del cuadro de la factura, como las facturas hechas a mano que tienen un espacio determinado para cada art√≠culo.
%
%  Si no se especifica nada sobre las l√≠neas, saldr√°n todas ellas (verticales y horizontales) salvo las que separan  los √≠tems a facturar entre s√≠.
%
%
% \subsection{Elementos a mostrar o no mostrar en la factura}
%
% \DescribeOption{sinmarcas}
%  Con |sinmarcas| evitamos que el car√°cter de fin de l√≠nea aparezca cuando la descripci√≥n ocupa m√°s que una l√≠nea; ese car√°cter indica que la l√≠nea contin√∫a abajo, y predeterminadamente es la flecha ‚Äú\flechaCR‚Äù. Tambi√©n con esta opci√≥n no aparece el car√°cter ‚Äú$\cdot$‚Äù en las celdas vac√≠as en este mismo caso.
%
% \DescribeOption{sinmonedatotales}
%  Esta opci√≥n |sinmonedatotales| permite quitar el signo monetario de los totales, que antes nunca sal√≠a y ahora sale de manera predeterminada.
%
% \DescribeOption{unafirma}
%  No pone el espacio para que firme quien recibe el documento sino s√≥lo el emisor; esto es lo predeterminado en las cotizaciones.
%
% \DescribeOption{sinfirmas}
%  No pone ninguna l√≠nea ni espacio para firmar; esto es lo predeterminado para las prefacturas.
%
% \DescribeOption{dosfirmas}
% Coloca las dos l√≠neas para que firme quien emite y quien recibe. Esta opci√≥n es la predeterminada salvo en las prefacturas y en las cotizaciones.
%
% \DescribeOption{vencimiento}
%  Cuando establecemos los d√≠as del cr√©dito de la factura, se imprime una l√≠nea tambi√©n con la fecha de vencimiento de la factura. Con esta opci√≥n podemos pedir que la fecha de vencimiento salga siempre en la facturas, inclusive cuando no sean facturas a cr√©dito.
%
% \DescribeOption{denom}
%  Con esta opci√≥n escribimos tambi√©n el texto ‚ÄúFACTURA‚Äù con el n√∫mero. La raz√≥n de esta opci√≥n es que hay formas libres que tienen la numeraci√≥n de la factura y otras que solamente tienen el n√∫mero de control; para las que tienen s√≥lo el n√∫mero de control existe esta opci√≥n que tambi√©n escribe el n√∫mero en cada factura impresa, en la posici√≥n que se defina.
%
% \DescribeOption{sinnumero}
%  Escribe el texto de la denominaci√≥n del documento en su posici√≥n (e.g. ‚ÄúCOTIZACI√ìN‚Äù) pero sin escribir el n√∫mero; por ejemplo para las cotizaciones que no son documentos que legalmente lleven n√∫mero, aunque el n√∫mero puede ser para control interno. Esta opci√≥n implica la opci√≥n anterior |denom|.
%
% \DescribeOption{sintotales}
%  Con esta opci√≥n evitamos que se totalicen los elementos en la factura; s√≥lo se presenta el cuadro sin los totales. La utilidad de esto no es en las facturas sino en las cotizaciones para casos donde se muestran variantes del mismo producto para que el cliente elija entre ellos. No tendr√≠a sentido totalizar all√≠ sino que funcione como un listado de precios. {\itshape Debe usarse en las cotizaciones porque una factura sin totales no es v√°lida.}
%
% \DescribeOption{linea}
%  Agrega una l√≠nea diagonal que inutiliza el espacio vac√≠o en el cuadro de la factura, para evitar posibles futuras adiciones de texto. Esta opci√≥n requiere de la opci√≥n |expandecuadro|, explicada a continuaci√≥n.
%
%
% \subsection{Disposici√≥n de algunos elementos en la factura}
%
% \DescribeOption{expandecuadro}
%  Expande el cuadro de la factura con espacio en blanco, es decir, rellena el espacio restante del cuadro de la factura con espacio en blanco. Lo predeterminado es expandir la parte de la descripci√≥n larga cuando la hay.
%
% \DescribeOption{sinexpandir}
%  No expande ninguna parte en la factura, es decir, deja tanto el cuadro de la factura como la descripci√≥n en su tama√±o m√≠nimo seg√∫n el contenido que tenga.
%
% \DescribeOption{centradesc}
%  Podemos centrar el texto de la descripci√≥n de cada √≠tem en la factura con este comando en lugar de justificarlo.
%
% \DescribeOption{filas}
%  Muesta los totales finales en modo de filas; esto los presenta uno al lado del otro en lugar de uno debajo del otro. Esta opci√≥n tiene limitaciones, por ejemplo no es compatible con la opci√≥n |sintotales|, |sinivaexpresado|, y por razones de espacio tampoco es compatible con los comandos de descuentos en los totales (subsecci√≥n \ref{subsec:dctototales}).
%
% \DescribeOption{centrado}
%  Centra los totales finales ({\itshape s√≥lo para el modo de totalizaci√≥n en filas}), que sin esta opci√≥n salen alineados al margen derecho.
%
% \DescribeOption{agrupado}
%  No agrupa los totales finales de los items por gravamen sino por tipo ({\itshape s√≥lo para el modo de totalizaci√≥n en columnas}). Con esta opci√≥n la agrupaci√≥n es primero todos los subtotales y los descuentos (cuando aplica), luego las bases imponibles y despu√©s los IVA. Sin |agrupado| se ordena por porcentaje del gravamen.
%
%
% \subsection{Otras opciones}
%
% \DescribeOption{nospanish}
%  No carga |babel| en castellano\footnote{Por ejemplo para cargar {\ttfamily polyglossia} en su lugar.}, ni la codificaci√≥n |T1| de las letras en el caso de compilar con pdf\LaTeX. Si no se especifica esta opci√≥n se cargan ambos paquetes.
%
% \DescribeOption{twoside}
%  Establece que el reporte se imprime por los dos lados del papel. (Obviamente se ignora esta opci√≥n cuando el motor no va a generar un reporte puesto que las facturas ocupan una hoja solamente).
%
% \DescribeOption{csv}
%  Escribe un archivo csv con la informaci√≥n num√©rica de la factura.
%
% \subsection{Activaci√≥n y desactivaci√≥n de opciones desde comandos\label{subsec:condicionales}}
%
% Cualquiera de estas opciones tambi√©n se puede activar o desactivar en el pre√°mbulo y as√≠ poder incluirlas dentro de archivos que vayan a ser cargados con |\input| o |\include| como se explicar√° en la subsecci√≥n \ref{subsec:aux}. Esto significa que podremos desactivar una opci√≥n que hayamos dado en |\documentclass| o activar alguna que no hayamos activado all√≠.
%
% Para hacer eso debemos usar el condicional que cada opci√≥n maneja y activarlo o desactivarlo de la forma como se hace en \TeX{}. El condicional de cada opci√≥n tiene el mismo nombre de la opci√≥n. Por ejemplo, para quitar las l√≠neas verticales (|sinlineasv|) usar√≠amos |\sinlineasvtrue| en el pre√°mbulo, o para desactivar la creaci√≥n del archivo |.csv|, previamente activada en |\documentclass|, usar√≠amos |\csvfalse|.
%
% }
%
%
% \section{Comandos que la clase provee\label{sec:comandos}}
%
% A continuaci√≥n descriremos los principales comandos de esta clase; en rojo aparecen aquellos pocos comandos que son de obligatorio uso. Los que no son de obligatorio uso es porque tienen alg√∫n valor predeterminado en |factura.def| o porque controlan alg√∫n aspecto opcional.
%
%
% \subsection{Estableciendo los m√°rgenes de la hoja y el fondo}
%
%  Como explicamos en la secci√≥n \ref{sec:geohoja}, a la hoja de la factura se le deben establecer los m√°rgenes apropiadamente, y esos m√°rgenes no tienen en cuanta ciertos textos que llamamos ‚Äúfijos‚Äù, para los cuales tambi√©n debemos establecer sus posiciones en la hoja, y eso lo veremos en esta parte.
%
%
% {\setlength{\parindent}{0pt}
%
% \DescribeMacro{\GeometriaFactura}{\macrooptcolor|\GeometriaFactura|\marg{geometr√≠a}}
%
%  En el argumento de este comando van los par√°metros relativos al paquete |geometry| que van a afectar la manera como la factura es generada. Como dijimos al principio, deber√° especificarse el tipo de papel (e.g. |letterpaper|, |legalpaper|, |executive|, |a4paper|, ...) y los m√°rgenes verticales y horizontales.
%
%  Para especificar el margen superior debe medirse desde el inicio del papel hasta donde se quiera establecer que empiece el recuadro de los datos del cliente, y el margen inferior debe medirse desde el final del papel hasta donde terminar√≠a la opcional descripci√≥n. Como ya dijimos, hay textos que est√°n fuera de estos m√°rgenes por haberlos considerado fijos en la implementaci√≥n de la clase |factura|.
%
% \DescribeMacro{\GeometriaReverso}{\macrooptcolor|\GeometriaReverso|\marg{geometr√≠a}}
%
%  Define los m√°rgenes del reverso de la hoja de la factura para escribir informaci√≥n extra.
%
% \DescribeMacro{\FondoFactura}{\macrooptcolor|\FondoFactura|\marg{nombre del archivo de la imagen}}
%
%  Nombre del archivo de la imagen a cargar como dise√±o, especialmente para las {\slshape prefacturas}, aunque tambi√©n puede usarse como una ‚Äúmarca de agua‚Äù para las facturas.
%
%  Lo que recomendamos es digitalizar la forma libre o pedir a la imprenta un archivo digital con el dise√±o y as√≠ incluir esa imagen con este comando cuando se vayan a producir ‚Äúprefacturas‚Äù o cotizaciones, as√≠ las prefacturas tienen el mismo dise√±o que las facturas. Si se puede lograr el dise√±o en un c√≥digo como se hace con el ejemplo del fondo, pues mejor a√∫n.
%
%
% }
%
%
% \subsubsection{Elementos fijos y sus ubicaciones}
%
% Los elementos cuyas posiciones van fijas en la hoja disponen de macros para establecer sus ubicaciones. Todas estas macros empiezan por |\Pos|, y son las siguientes: |\PosFecha|, |\PosDenom|, |\PosControl|, |\PosNotaFinal| y |\PosFirmas|.
%
% Todos estos comandos aceptan como argumentos dimensiones de \LaTeX{}, y son las posiciones |(x,y)| en la p√°gina de los elementos a imprimir, siendo ‚Äú|x|‚Äù la coordenada a lo ancho del papel y ‚Äú|y|‚Äù la coordenada a lo largo del papel, es decir, horizontal y vertical respectivamente. El origen est√° fijado arriba a la izquierda. Se pueden especificar tambi√©n valores negativos para denotar que estamos contando desde el extremo derecho o inferior, para el caso de ‚Äú|x|‚Äù o ‚Äú|y|‚Äù, respectivamente\footnote{Varias de estas variables est√°n definidas de esta forma negativa en el archivo de definiciones.}; salvo el caso de la nota final y las firmas en su coordenada |x|, todos los dem√°s elementos fijos aceptan valores negativos en su posicionamiento, ya que estos dos elementos cuentan con un intervalo |x-inicial,x-final| para posicionar.
%
% Por ejemplo, si queremos que la fecha aparezca desde el margen izquierdo y |5cm| contados desde arriba hacia abajo, har√≠amos: |\PosFecha{0cm}{5cm},| y si queremos que salga |1cm| desde la derecha y |4cm| contados desde abajo har√≠amos |\PosFecha{-1cm}{-4cm}|. A continuaci√≥n todas las macros para fijar las posiciones en el papel:
%
% {\setlength{\parindent}{0pt}
%
% \DescribeMacro{\PosFecha}{\macrooptcolor|\PosFecha|\marg{pos. x}\marg{pos. y}}
%
%  Con |\PosFecha| controlamos d√≥nde se ubica la caja que imprime la fecha en la hoja.
%
% \DescribeMacro{\PosFecha*}{\macrooptcolor|\PosFecha*|\marg{pos. x}\marg{pos. y}}
%
%  Con esta variante con ‚Äú*‚Äù, es decir, |\PosFecha*|, logramos que la caja de la fecha abra hacia arriba desde la posici√≥n especificada en el eje vertical, de manera que estar√≠amos especificando una coordenada ‚Äú|y|‚Äù final del texto y no una posici√≥n inicial, esto significa que el texto se despliega hacia arriba desde la posici√≥n dada y no hacia abajo. Por ejemplo, sin ‚Äú*‚Äù, si especificamos |\PosFecha{-0cm}{5cm}|, las fechas empiezan 5cm desde el tope superior de la hoja, y si especificamos |\PosFecha*{-0cm}{5cm}| ellas terminar√°n en los 5cm de la hoja. Esto es √∫til cuando se especifica tambi√©n |\Credito| que produce una fecha de vencimiento que aparecer√° abajo de la fecha de emisi√≥n; al ocupar las fechas m√°s de una l√≠nea podemos querer que la √∫ltima fecha (la de vencimiento) quede alineada en cierta posici√≥n vertical, la misma posici√≥n donde saldr√≠a la fecha de emisi√≥n en el caso en el que no haya fecha de vencimiento por no especificar la factura a cr√©dito.
%
% \DescribeMacro{\PosDenom}{\macrooptcolor|\PosDenom|\marg{pos. x}\marg{pos. y}}
%
%  Con |\PosDenom| controlamos d√≥nde se ubica la caja que imprime la denominaci√≥n del documento (e.g. ‚ÄúFACTURA‚Äù, ‚ÄúCOTIZACI√ìN‚Äù) y su -opcional- n√∫mero.
%
% \DescribeMacro{\PosDenom*}{\macrooptcolor|\PosDenom*|\marg{pos. x}\marg{pos. y}}
%
%  Al igual que con |\PosFecha*| podemos especificar la posici√≥n final en ‚Äú|y|‚Äù de la caja para la denominaci√≥n, as√≠ el texto se despliega hacia arriba y no hacia abajo.
%
% \DescribeMacro{\PosControl}{\macrooptcolor|\PosControl|\marg{pos. x}\marg{pos. y}}
%
%  Con |\PosControl| controlamos d√≥nde se ubica la caja que imprime el n√∫mero de control con la serie.
%
% \DescribeMacro{\PosControl*}{\macrooptcolor|\PosControl*|\marg{pos. x}\marg{pos. y}}
%
%  Tambi√©n podemos pedir que la caja del n√∫mero de control abra hacia arriba, es decir que la posici√≥n vertical sea tomada como la posici√≥n vertical final; para eso |\PosControl*|, igual que con |\PosFecha*| y |\PosDenom*|. 
%
% \DescribeMacro{\PosNotaFinal}{\macrooptcolor|\PosNotaFinal|\marg{pos. x-inicial}\marg{pos x-final}\marg{pos. y}}
%
%  Con |\PosNotaFinal| controlamos d√≥nde se ubica el texto de la nota final\footnote{La nota final es lo que en versiones previas llam√°bamos ‚Äúcondiciones‚Äù de la factura} (est√° hecho con |\parbox|, acepta un p√°rrafo como argumento) en la hoja.
%
% {\itshape Aqu√≠ delimitamos el intervalo en |X| donde va la nota final, por eso hay una coordenada |X-inicial| y una coordenada |X-final|.} La coordenada |X| inicial va medida desde el margen establecido como el izquierdo, y la |X| final va medida desde el margen establecido como el derecho. Por ejemplo, estableciendo |X-inicial| como |0pt| y |X-final| como |0pt| queda en los mismos m√°rgenes que todos los dem√°s elementos de la factura, y esto es lo predeterminado, pero estableciendo ambas coordenadas como |1cm|, la nota final quedar√° con |1cm| de margen hacia adentro que la factura, tanto por la izquierda como por la derecha.
%
% Debido a que este comando acepta valor inicial y valor final en |X|, entonces no acepta valores negativos.
%
% \DescribeMacro{\PosNotaFinal*}{\macrooptcolor|\PosNotaFinal*|\marg{pos. x-inicial}\marg{pos x-final}\marg{pos. y}}
%
%  De la misma manera como con los comandos precedentes, podemos especificar que la caja del p√°rrafo para la nota final abra hacia arriba, fijando una posici√≥n vertical final y no una posici√≥n inicial de la nota final.
%
% \DescribeMacro{\PosFirmas}{\macrooptcolor|\PosFirmas|\marg{pos. x-inicial}\marg{pos. x-final}\marg{pos. y}}
%
%  Con |\PosFirmas| controlamos d√≥nde se ubica la caja que dibuja las l√≠neas para firmar en la factura. {\itshape Aqu√≠ aplica el mismo comentario que en \cs{PosNotaFinal} sobre las coordenadas |X| inicial y final}. La coordenada |X-inicial| indica d√≥nde empieza la primera linea (para que firme quien recibe), y la coordenada |X-final| establece d√≥nde termina la segunda linea para firmar (para que firme el emisor de la factura), que va a estar al lado de la primera.
%
% En este caso, las coordenadas |X| tampoco aceptan valores negativos ni versi√≥n con asterisco |*|.
%
% }
%
%
% \subsubsection{Espaciado entre distintas partes. Estilo de los recuadros\label{subsec:espacioslineas}}
%
% Podemos cambiar distintos valores del espaciado interno en la factura, as√≠ como tambi√©n la est√©tica de la l√≠nea para firmar y los recuadros que encierran los datos del cliente, la descripci√≥n, las ‚Äúnotas‚Äù, pudiendo ajustarle estos recuadros o cajas el grosor de la l√≠nea, la curvatura y la sombra. Los argumentos de todos estos comandos son dimensiones de \LaTeX{}:
%
% {\setlength{\parindent}{0pt}
%
% \DescribeMacro{\SepVertical}{\macrooptcolor|\SepVertical|\marg{sep. vertical entre elementos}}
%
%  Las distintas partes de la factura (a saber: el encabezado con los datos, la -opcional- nota previa, el cuadro de la factura, la -opcional- nota externa y la -opcional- descripci√≥n) tambi√©n est√°n separadas entre s√≠ una distancia que puede ser cambiada.
%
%  La separaci√≥n que se fija con este comando es la separaci√≥n vertical m√≠nima que queremos garantizar entre cada elemento a escribir en la factura, y puede ser ajustada autom√°ticamente por la clase aument√°ndola cuando no hay relleno autom√°tico de espacios sobrantes (es decir, sin usar la opci√≥n |sinexpandir|). Cuando la descripci√≥n larga o el cuadro de la factura (usando la opci√≥n |expandecuadro|) toman su tama√±o m√°ximo, entonces la separaci√≥n vertical entre cada elemento de la hoja es la dada con |\SepVertical|, o sea, la que queremos garantizar como la m√≠nima separaci√≥n entre esas partes.
%
% \DescribeMacro{\SepDatosResumen}{\macrooptcolor|\SepDatosResumen|\marg{sep. horizontal}}
%
%  Esta macro nos proporciona una forma de cambiar la separaci√≥n entre los recuadros o cajas donde van los datos del cliente y el resumen que sale a su lado. Naturalmente, si no se escribe un resumen saldr√≠a √∫nicamente la caja de los datos del cliente, y esta separaci√≥n no tendr√≠a efecto.
%
% \DescribeMacro{\SepEncabezado}
% \DescribeMacro{\SepNotaPrevia}
% \DescribeMacro{\SepDescripcion}
% \DescribeMacro{\SepNotaFinal}
% {\macrooptcolor|\SepEncabezado|\marg{sep. interna texto}}\newline
% {\macrooptcolor|\SepNotaPrevia|\marg{sep. interna texto}}\newline
% {\macrooptcolor|\SepDescripcion|\marg{sep. interna texto}}\newline
% {\macrooptcolor|\SepNotaFinal|\marg{sep. interna texto}}
%
%  Con estas macros podemos controlar la distancia entre la l√≠nea del recuadro y el texto que hay en el recuadro, es decir, un margen interno entre el contorno de la caja y el texto para que no salga pegado a la l√≠nea que lo encierra. Esto es parte del dise√±o de \tikz de estos recuadros. Como puede verse, dicho margen para los datos del cliente y para el resumen se cambia con |\SepEncabezado|, los de la nota previa con |\SepNotaPrevia|, los de la descripci√≥n larga con |\SepDescripcion|, y los de la nota final con |\SepNotaFinal|.
%
% Predeterminadamente no hay l√≠nea ni dise√±o de \tikz para la nota final del documento, as√≠ que el valor fijado aqu√≠ no tiene efecto a menos de que se le especifiquen valores a dicho recuadro con la opci√≥n |\LineaNotaFinal|, explicada m√°s abajo.
%
% \DescribeMacro{\SepItemsExtra}{\macrooptcolor|\SepItemsExtra|\marg{sep. extra entre items}}
%
%  Agrega una separaci√≥n extra entre los elementos o √≠tems en el cuadro de la factura. La separaci√≥n entre √≠tems est√° dada por el |\baselineskip| que se puede establecer con el comando |\LetraItems|, el cual se explicar√° m√°s adelante en esta misma secci√≥n.
%
% \DescribeMacro{\SepFilas}{\macrooptcolor|\SepFilas|\marg{sep. en x}\marg{sep. en y}}
%
%  Cuando se usa el modo de totalizaci√≥n en filas tenemos tambi√©n la posibilidad de cambiar la separaci√≥n entre los totales que salen uno al lado del otro, y la separaci√≥n entre las distintas l√≠neas.
%
%  El primer argumento de |\SepFilas| es la separaci√≥n horizontal {\itshape m√≠nima} entre los distintos totales que se presentan en el modo de totalizaci√≥n en filas. La clase |factura| expande esa distancia para que queden todos los totales separados igual, y tambi√©n separados igual de los m√°rgenes del papel.
%
%  El segundo argumento de |\SepFilas| es la separaci√≥n vertical entre las distintas l√≠neas de la totalizaci√≥n en filas.
%
% \DescribeMacro{\LineaEncabezado}
% \DescribeMacro{\LineaNotaPrevia}
% \DescribeMacro{\LineaDescripcion}
% \DescribeMacro{\LineaNotaFinal}
% {\macrooptcolor|\LineaEncabezado|\marg{grosor}\marg{curvatura esquinas}\marg{tama√±o sombra}}\newline
% {\macrooptcolor|\LineaNotaPrevia|\marg{grosor}\marg{curvatura esquinas}\marg{tama√±o sombra}}\newline
% {\macrooptcolor|\LineaDescripcion|\marg{grosor}\marg{curvatura esquinas}\marg{tama√±o sombra}}\newline
% {\macrooptcolor|\LineaNotaFinal|\marg{grosor}\marg{curvatura esquinas}\marg{tama√±o sombra}}
%
%  La informaci√≥n del encabezado (datos del cliente y resumen), as√≠ como la nota previa, la descripci√≥n y la nota final puede o no tener el dise√±o \tikz, el cual viene prehecho en el archivo |.def| y consiste en una l√≠nea curva, en algunos casos sombreada a la derecha y abajo, y en otros casos no. Esa l√≠nea puede ser alterada en su grosor, el tama√±o de la sombra, y la distancia entre la l√≠nea y la informaci√≥n, es decir un margen interno. Para eso estos comandos, que se comportan igual todos ellos.
%
%  Con el primer argumento de estos comandos cambiamos el grosor de la l√≠nea\footnote{Si se especifica una dimensi√≥n nula, desaparece el dise√±o \tikz y la l√≠nea, quedando solamente un \cs{parbox}, y es as√≠ como se estableci√≥ en el archivo \texttt{.def} para el caso de la nota final.} con la que las cajas del encabezado, la nota previa, la descripci√≥n y la nota final se dibujan. Con el segundo argumento cambiamos el radio de curvatura de las esquinas, y con el tercero el tama√±o de la sombra\footnote{Todas las sombras salen hacia abajo a la derecha.}.
%
%  Se puede modificar el dise√±o de este nodo de \tikz; est√° alojado en las macros internas |\@DatosTIKZ|, |\@NotaPreviaTIKZ|, |\@DescripcionTIKZ| y |\@NotaFinalTIKZ|.
%
%  Lo predeterminado es que la nota final se escriban sin dise√±o de \tikz, es decir, el primer argumento de este comando est√° fijado en cero para que no salga l√≠nea ni dise√±o de \tikz.
%
% \DescribeMacro{\LineaFirmas}{\macrooptcolor|\LineaFirmas|\marg{long. l√≠nea}\marg{grosor}}
%
%  La longitud de las l√≠neas para firmar y el grosor son tambi√©n ajustables por medio del primer y segundo argumento, respectivamente, de la macro |\LineaFirmas|.
%
%
% \subsection{Sobre la informaci√≥n del cliente\label{subsec:cliente}}
%
% \DescribeMacro{\RazonSocial}{\macromandcolor|\RazonSocial|\marg{texto}}
%
%  Define la raz√≥n social, o sea, el nombre del cliente.
%
% \DescribeMacro{\Nombre}{\macromandcolor|\Nombre|\marg{texto}}
%
%  Similar a |\RazonSocial| pero usable m√°s bien para personas naturales, donde no existe una ‚Äúpersona de contacto‚Äù y por tanto la clase no advierte de su ausencia si no se ha especificado con |\Contacto|. Naturalmente se especifica un solo nombre del cliente, es decir que si se especifica con |\RazonSocial| no hace falta usar este comando. {\itshape Es preferible usar |\RazonSocial|.}
%
% \DescribeMacro{\RIF}{\macromandcolor|\RIF|\marg{texto}}
%
%  Define el R.I.F. del cliente.
%
% \DescribeMacro{\CI}{\macromandcolor|\CI|\marg{texto}}
%
%  Especifica la c√©dula de identidad del cliente al ser persona natural. {\itshape Es preferible usar siempre |\RIF|.}
%
% \DescribeMacro{\Contacto}{\macrooptcolor|\Contacto|\marg{texto}}
%
%  Define una persona de contacto (e.g. nombre de una persona cuando el cliente no es personal).
%
% \DescribeMacro{\Direccion}{\macromandcolor|\Direccion|\marg{texto}}
%
%  Define la direcci√≥n fiscal del cliente.
%
% \DescribeMacro{\Telefono}{\macrooptcolor|\Telefono|\marg{texto}}
%
%  Especifica el (o los) tel√©fonos del cliente.
%
% \DescribeMacro{\Email}{\macrooptcolor|\Email|\marg{texto}}
%
%  Establece el e-mail del cliente.
%
% \DescribeMacro{\Conforme}{\macrooptcolor|\Conforme|\marg{texto}}
%
%  Especifica el texto que aparecer√° debajo de la l√≠nea para que firme el cliente; si no se especifica tomar√° el texto por omisi√≥n, que es ‚ÄúRecib√≠ conforme‚Äù, indicando que el cliente le firma una copia al emisor de la factura donde acepta haber recibido y estar conforme. Este texto puede cambiarse a otro que puede ser el nombre del cliente o la persona de contacto, o tambi√©n ‚ÄúPor el cliente‚Äù.
%
%
% \subsection{Sobre la informaci√≥n del emisor del documento}
%
% \DescribeMacro{\Emisor}{\macrooptcolor|\Emisor|\marg{texto}}
%
%  Define el nombre del emisor de la factura. Si no se especifica saldr√° el texto ‚ÄúPAGADO‚Äù\footnote{El texto ‚ÄúPAGADO‚Äù es lo que la legislaci√≥n venezolana del SENIAT exige escribir cuando una factura ha sido pagada.} debajo de la l√≠nea para firmar, ya que la factura se firma cuando haya sido pagada. Si se especifica un texto con este comando saldr√° ese texto debajo de la l√≠nea donde va la firma, pero el prop√≥sito es que quede constancia para el cliente que ya pag√≥ la factura, raz√≥n por la cual el texto predeterminado es ‚ÄúPAGADO‚Äù.
%
% \DescribeMacro{\Proveedor}{\macrooptcolor|\Proveedor|\marg{texto}}
%
%  Establece el nombre del emisor, para los efectos del reporte. Si no se define mediante esta macro, ser√° tomado del establecido con |\Emisor|.
%
% \DescribeMacro{\FirmaFactura}{\macrooptcolor|\FirmaFactura|\marg{inclusi√≥n de la imagen}\oarg{corrimiento en x}\oarg{corrimiento en y}}
%
%  Incluye el archivo de la firma digitalizada en el espacio donde firma el emisor del documento. Los argumentos son:
%  \begin{enumerate}
%   \item inclusi√≥n de la imagen (e.g. |\includegraphics|). {\bfseries Aqu√≠ el primer argumento no es el archivo de la imagen sino el comando que la inserta en el documento}, as√≠ el usuario tiene m√°s control sobre c√≥mo saldr√° la imagen si altera las opciones de |\includegraphics|.
%   \item corrimiento en |X| de la imagen, para un ajuste m√°s fino de la posici√≥n de la firma,
%   \item corrimiento en |Y|.
%   \end{enumerate}
%  {\itshape (Sin especificar los corrimientos, la firma quedar√° centrada horizontalmente en la l√≠nea, dejando hacia la izquierda y hacia la derecha la misma cantidad de la l√≠nea. Tambi√©n quedar√° toda la firma encima de la l√≠nea, lo cual muy probablemente haya que corregirlo porque las firmas tienen ‚Äúprofundidad‚Äù de texto, que significa que hay parte de algunas letras que sobresalen hacia abajo respecto a la l√≠nea base del texto. Por todo esto es muy probable el uso de los corrimientos. Pueden verse los ejemplos, que all√≠ se usan los corrimientos.)}
%
%  {\bfseries Las facturas no llevan firma porque se supone que el documento es aut√©ntico ya que viene avalado por una imprenta registrada y tiene los n√∫meros correlativos impresos desde la imprenta, de manera que la factura no necesita la firma de quien la emite; raz√≥n por la cual el texto debajo de la l√≠nea del emisor en la factura dice ‚ÄúPAGADO‚Äù, porque el emisor firma la factura una vez que haya sido pagada como constancia para el cliente.} Entonces agregar la firma escaneada es una posibilidad que debe contemplarse solamente con las cotizaciones, usando tambi√©n el comando |\Emisor|, ya que no nos interesar√≠a que apareciera ‚ÄúPAGADO‚Äù en ese caso sino alg√∫n nombre de quien est√° emitiendo la cotizaci√≥n.
%
%
% \subsection{Relativos a la moneda y a la numeraci√≥n del documento factura}
%
% \DescribeMacro{\Moneda}{\macrooptcolor|\Moneda|\marg{signo monetario}}
%
%  Cambia el signo monetario, por defecto ‚ÄúBs.‚Äù.
%
% \DescribeMacro{\Num}{\macrooptcolor|\Num|\marg{n√∫m}}
%
%  Define el n√∫mero de la factura. Es opcional porque el talonario de las facturas puede ya tener la numeraci√≥n. Es de obligatorio uso cuando se define |denom|, o |prefactura| sin usar |sinnumero|.
%
% \DescribeMacro{\NumControl}{\macrooptcolor|\NumControl|\marg{n√∫m}}
%
%  Define el n√∫mero de control de la factura. Esta opci√≥n s√≥lo aplica con |prefactura| puesto que una factura fiscal siempre tiene el n√∫mero de control impreso desde la imprenta. Si se usa |prefactura| y no se define el n√∫mero de control, √©ste tomar√° el mismo n√∫mero de la factura.
%
% \DescribeMacro{\NumSerieControl}{\macrooptcolor|\NumSerieControl|\marg{n√∫m}}
%
%  Define el n√∫mero de serie del n√∫mero de control, tambi√©n aplica solamente con |prefactura|. Si no se especifica, toma |00|.
%
% \DescribeMacro{\Denom}{\macrooptcolor|\Denom|\marg{texto}}
%
%  Cambia el nombre del documento a algo distinto de ‚ÄúFACTURA‚Äù o ‚ÄúCOTIZACI√ìN‚Äù.
%
%
% \subsection{Estableciendo la fecha del documento}
%
% \DescribeMacro{\Fecha}{\macrooptcolor|\Fecha|\marg{fecha}}
%
%  Especifica la fecha de emisi√≥n del documento, en un formato que puede cambiarse con el comando |\FormatoFecha| pero predeterminadamente es el formato venezolano |dd-mm-aaaa|.
%
%  La fecha de emisi√≥n se guardar√° en el identificador ‚Äú\texttt{FechaEmision}‚Äù perteneciente al paquete \texttt{datetime2} y podr√° ser usado en cualquier parte del documento seg√∫n las formas que provee dicho paquete.
%
%  {\itshape Si el usuario no provee la fecha, ser√° tomada la fecha actual como la fecha de emisi√≥n y se producir√° una advertencia indicando que no se especific√≥ la fecha y que la fecha del documento es la fecha del d√≠a.}
% 
% \DescribeMacro{\Fecha*}{\macrooptcolor|\Fecha*|\marg{aaaa}\marg{mm}\marg{dd}}
%
%  Esta variante del comando se incorpor√≥ para suministrar la fecha en formato ISO, es decir, primero el a√±o, luego y mes y finalmente el d√≠a, cada uno como un par√°metro separado del otro (como se hace en \texttt{datetime2}. Esto es independiente de la forma como la fecha ser√° mostrada, o sea que puede la fecha suministrarse de esta forma e igual saldr√° en el formato deseado, cambiable con la macro |\FormatoFecha|, explicado a continuaci√≥n.
%
% \DescribeMacro{\FormatoFecha}{\macrooptcolor|\FormatoFecha|\oarg{formato entrada}\marg{formato salida}\marg{separador}}
%
%  El comando |\FormatoFecha| le permite al usuario cambiar el formato de entrada de la fecha suministrada y el formato de salida de las fechas (c√≥mo √©stas salen escritas en la factura).
%
%  Con el primer argumento (opcional, dado entre corchetes) el usuario le puede decir a la clase c√∫al es el formato seg√∫n el cual le suministrar√° la fecha con |\Fecha|; las posibilidades son: \begin{inparaenum}[\bfseries i)]\item |dd-mm-aaaa| (predeterminada), \item |dd.mm.aaaa|, \item |ddmmaaaa|, \item |aaaa-mm-dd|, \item |aaaa.mm.dd|, \item |aaaammdd| y \item |mm-dd-aaaa| \end{inparaenum}. Esto con el fin de establecer la fecha reconocida debidamente por |datetime2| y que sea posible su manejo como fecha y el posible c√°lculo de la fecha de vencimiento, si aplicara.
%
%  El segundo argumento (opcional tambi√©n, dado entre llaves) le permite al usuario especificar el formato seg√∫n el cual quiere que las fechas (emisi√≥n y vencimiento si aplica) salgan impresas en la factura. Estos son los formatos dados por \texttt{datetime2} y debe consultarse su documentaci√≥n para m√°s informaci√≥n. Entre ellos tenemos por ejemplo \begin{inparaenum}[\bfseries i)]\item |ddmmyyyy| (predeterminado), \item |default|, \item |iso|, \item |mmddyyyy| \end{inparaenum}.
%
%  El tercer argumento (opcional tambi√©n, dado entre llaves) sirve para cambiar el separador, cuyo car√°cter predeterminado es el gui√≥n (‚Äú-‚Äù).
%
%  Con |\FormatoFecha|, al tener todos sus argumentos opcionales, el usuario podr√° especificar solamente el primero (que va entre corchetes), solamente el segundo (entre llaves), pero para especificar el tercero que tambi√©n est√° entre llaves debe especificar el segundo, ya que ambos son opcionales pero se dan igualmente entre llaves. Naturalmente podr√° especificar dos de estos argumentos o los tres.
%
%  Por ejemplo: |\FormatoFecha[mm-dd-aaaa]{mmddyyyy}{.}| servir√≠a para que el usuario pueda dar la fecha as√≠: |\Fecha{12-31-2019}| y que salga igualmente seg√∫n el formato |mm-dd-aaaa| pero separado por puntos. Tambi√©n puede usarse |\FormatoFecha[aaaa-mm-dd]| para dar luego la fecha de esta forma: |\Fecha{2019-12-31}| pero esta saldr√° igual impresa en la factura as√≠: ‚Äú|31-12-2019|‚Äù, ya que no cambiamos el formato de salida. Tambi√©n puede hacer |\FormatoFecha{mmddyyyy}{/}| y dar la fecha por ejemplo as√≠: |\Fecha*{2019}{12}{31}| y saldr√° impresa as√≠: ‚Äú|12/31/2019|‚Äù.
%
%  Los valores predeterminados cambiables con |\FormatoFecha| est√°n definidos, como siempre, en el archivo |factura.def|.
%
% \DescribeMacro{\Credito}{\macrooptcolor|\Credito|\marg{d√≠as}}
%
%  Este comando, cuyo argumento es la cantidad de d√≠as, nos permite emitir una factura a cr√©dito. La fecha de vencimiento ser√° calculada autom√°ticamente y ser√° colocada debajo de la fecha de emisi√≥n, especificada por el usuario.
%
%  La fecha calculada autom√°ticamente se guarda en el identificador ‚Äú\texttt{FechaVencimiento}‚Äù perteneciente al paquete \texttt{datetime2}, de manera que el usuario podr√° hacer uso de esta fecha con los comandos que este paquete provee.
%
% }
%
% 
% \subsection{Descuentos en la totalizaci√≥n\label{subsec:dctototales}}
%
%  Podemos efectuar un descuento\footnote{Estas opciones de descuento en el subtotal no son compatibles con la opci√≥n de totalizaci√≥n en modo de |filas|, explicada en la secci√≥n \ref{sec:opciones}, y muy probablemente m√°s adelante seguir√°n sin serlo.} sobre cualquiera de los subtotales; ese descuento puede ser porcentual (versi√≥n sin *) o dado en un monto fijo a sustraer del subtotal (variante con *). Podemos aplicar un descuento que aplique por igual a cualquier tipo de √≠tem con cualquier gravamen, o discriminado dependiendo del tipo de impuesto se aplica un descuento u otro.
%
% {\setlength{\parindent}{0pt}
%
% \DescribeMacro{\Descuento}{\macrooptcolor|\Descuento|\marg{porcentaje}}\\
% \DescribeMacro{\Descuento*}{\macrooptcolor|\Descuento*|\marg{monto}}
%
% Con este comando el descuento aplicar√≠a por igual a cualquier subtotal presente, es decir, para elementos con cualquier gravamen y tambi√©n exentos. Dichos descuentos son aplicados y mostrados al totalizar. Puede usarse inclusive cuando se aplican descuentos individuales que se incluyen con la opci√≥n de la clase |descuentos|.
%
% \DescribeMacro{\DescuentoG}{\macrooptcolor|\DescuentoG|\marg{porcentaje}}\\
% \DescribeMacro{\DescuentoG*}{\macrooptcolor|\DescuentoG*|\marg{monto}}
%
%  Descuento espec√≠fico para los elementos gravados con IVA general.
%
% \DescribeMacro{\DescuentoR}{\macrooptcolor|\DescuentoR|\marg{porcentaje}}\\
% \DescribeMacro{\DescuentoR*}{\macrooptcolor|\DescuentoR*|\marg{monto}}
%
%  Descuento espec√≠fico para los elementos gravados con IVA reducido.
%
% \DescribeMacro{\DescuentoA}{\macrooptcolor|\DescuentoA|\marg{porcentaje}}\\
% \DescribeMacro{\DescuentoA*}{\macrooptcolor|\DescuentoA*|\marg{monto}}
%
%  Descuento espec√≠fico para los elementos gravados con IVA adicional.
%
% \DescribeMacro{\DescuentoE}{\macrooptcolor|\DescuentoE|\marg{porcentaje}}\\
% \DescribeMacro{\DescuentoE*}{\macrooptcolor|\DescuentoE*|\marg{monto}}
%
%  Descuento espec√≠fico para los elementos exentos de IVA.
%
%
% \subsection{Textos explicativos en la factura\label{subsec:textos}}
%
% \DescribeMacro{\Resumen}{\macrooptcolor|\Resumen|\marg{texto}}
%
%  Pone un resumen que va en una caja a la derecha de los datos del cliente, separado de esta en una distancia ajustable con el comando |\SepEncabezado|, que se describir√° m√°s adelante. Este resumen es opcional.
%
% \DescribeMacro{\NotaPrevia}{\macrooptcolor|\NotaPrevia|\marg{texto}}
%
%  La nota previa es una nota que puede ponerse antes del cuadro de la factura. Sin especificarla no sale nota alguna. Dicha nota va en un recuadro \tikz cuyo aspecto puede cambiarse, como ya se mencion√≥ en la secci√≥n \ref{subsec:espacioslineas} donde se explican las l√≠neas o contornos.
%
% \DescribeMacro{\NotaInterna}{\macrooptcolor|\NotaInterna|\marg{texto}}
%
%  La nota interna es una coletilla que aparece dentro del cuadro de la factura, por eso la llamamos interna (es interna al cuadro), por ejemplo si aplicamos un descuento podemos decir all√≠ cerca de los totales a qu√© corresponde tal descuento, o para hacer alguna aclaratoria sobre lo que precede inmediatamente como alg√∫n √≠tem de la factura.
%
% \DescribeMacro{\NotaExterna}{\macrooptcolor|\NotaExterna|\marg{texto}}
%
%  La nota externa es otro texto opcional que el usuario puede introducir y saldr√° al terminar el cuadro de la factura, antes de la opcional descripci√≥n larga (comando |\Descripcion|). {\itshape La nota externa no tiene formato \tikz.}
%
% \DescribeMacro{\NotaFinal}{\macrooptcolor|\NotaFinal|\marg{texto}}
%
%  Con este comando se establece el texto para la nota final\footnote{Antiguas condiciones de la factura, por ejemplo, para las condiciones de pago si se trata de una factura, o para las condiciones de una cotizaci√≥n.}. Es opcional; si no se define no sale texto alguno. Tambi√©n se puede destinar este espacio para un dise√±o (que har√≠a el usuario) en el que se agreguen tambi√©n algunas casillas para especificar la forma de pago.
%
%
% \subsection{Estableciendo los par√°metros relativos al reporte}
%
% \DescribeMacro{\GeometriaReporte}{\macrooptcolor|\GeometriaReporte|\marg{geometr√≠a}}
%
%  Aqu√≠ van los par√°metros relativos al paquete |geometry| que van a afectar la manera como el reporte es generado, de la misma manera como se definieron los m√°rgenes para la factura.
%
%  Puesto que el reporte no se imprime en hojas de facturas sino en hojas en blanco, el usuario podr√° cambiar la geometr√≠a del papel completamente a su gusto sin las restricciones impuestas por el dise√±o que tengan sus facturas. En |factura.def| se definen unos m√°rgenes razonables para un reporte. Si el reporte y la factura usaran un tama√±o distinto de papel, entonces al imprimirse ambos juntos (opci√≥n |conreporte|), el reporte tomar√° el tama√±o f√≠sico del papel especificado para la factura ya que con el paquete |geometry| no podemos cambiar el tama√±o del papel en el medio del documento, aunque s√≠ sus m√°rgenes. Entonces, si se quiere imprimir el reporte en un papel de otro tama√±o, tendr√°n que imprimirse ambos documentos por separado, o sea, primero uno y despu√©s el otro.
%
% \DescribeMacro{\FondoReporte}{\macrooptcolor|\FondoReporte|\marg{nombre del archivo de la imagen}}
%
%  Imagen a cargar {\bfseries solamente en la primera p√°gina del reporte} (e.g. un membrete). Cuando se usa este comando puede necesitarse usar tambi√©n |\InicioReporte| para fijar el inicio de la primera p√°gina del reporte m√°s abajo que las dem√°s p√°ginas cuyos m√°rgenes est√°n establecidos con |\GeometriaReporte|; esto porque la primera p√°gina tendr√≠a un ‚Äúmargen superior‚Äù distinto por la existencia del membrete.
%
% \DescribeMacro{\FondoReporte*}{\macrooptcolor|\FondoReporte*|\marg{nombre del archivo de la imagen}}
%
%  Esta variante de |\FondoReporte| es para que la imagen est√© visible {\bfseries en todas las p√°ginas} y no solamente en la primera como con el comando anterior. Usando esta variante del fondo del reporte no es necesario usar |\InicioReporte| sino solamente establecer los m√°rgenes del reporte de acuerdo a dicho fondo.
%
% \DescribeMacro{\EstiloPagReporte}{\macrooptcolor|\EstiloPagReporte|\oarg{estilo primera p√°gina}\marg{estilo p√°ginas restantes}}
%
%  Con este comando definimos el estilo de p√°gina para el reporte (v√©ase el comando |\InfoPagina| y la subsecci√≥n \ref{subsec:pagestyle}). El estilo de p√°gina es lo que cambiamos en \LaTeX{} con |\pagestyle|, o sea, lo relativo a las cabeceras y pies de p√°gina.
%
%  Con este comando podemos asignar un estilo de p√°gina para la primera p√°gina del reporte y otro estilo de p√°gina para el resto de las p√°ginas. La primera p√°gina del reporte pudiera tener un estilo de p√°gina distinto por la presencia del membrete si se usa el comando |\FondoReporte| sin ‚Äú|*|‚Äù, por lo cual se puede querer no poner cabeceras en la primera p√°gina pero s√≠ en las dem√°s.
%
%  Como vemos de la sintaxis de esta macro, el argumento obligatorio es el del resto de las p√°ginas y el opcional es el que aplica a la primera p√°gina. El opcional se pone entre corchetes antes del otro, pero si se omite, todas las p√°ginas toman el estilo especificado entre llaves.
%
%  Si no se usa esta macro la clase asume un comportamiento apropiado teniendo en cuenta si se especifica |\FondoReporte| o |\FondoReporte*| para evitar solapamiento de textos, como se explica tambi√©n en la subsecci√≥n \ref{subsec:pagestyle}.
%
%  La informaci√≥n que aparece como cabecera o como pie de p√°gina es la que damos con el comando |\InfoPagina|, explicado m√°s adelante.
%
%  La clase provee varios estilos de p√°gina, que tambi√©n se explicar√°n en la subsecci√≥n \ref{subsec:pagestyle}. En los ejemplos de reportes se puede ver el comportamiento del comando |\EstiloPagReporte|.
%
% \DescribeMacro{\InicioReporte}{\macrooptcolor|\InicioReporte|\marg{longitud}}
%
%  Con este comando -cuyo argumento es una longitud de \LaTeX{}- se agrega una distancia extra donde inicia el texto en la primera p√°gina del reporte cuando se usa |\FondoReporte| sin ‚Äú|*|‚Äù. Este comando s√≥lo aplica cuando en el reporte se fija un fondo para que salga solamente en la primera p√°gina (comando |\FondoReporte| en su versi√≥n sin ‚Äú|*|‚Äù). La motivaci√≥n de esto es corregir la alteraci√≥n que produce un membrete que va a salir solamente en la primera p√°gina; si el membrete estuviera en todas las p√°ginas no es necesario hacer esto sino fijar los m√°rgenes adecuadamente con |\GeometriaReporte|. Si en el reporte no se fija un fondo o se fija el fondo para todas las p√°ginas (comando |\FondoReporte*|), lo que se establezca con |\InicioReporte| es ignorado. En estos dos casos los m√°rgenes deben establecerse con |\GeometriaReporte|.
%
% \DescribeMacro{\FirmaReporte}{\macrooptcolor|\FirmaReporte|\oarg{inclusi√≥n la imagen}\oarg{corr. en x}\oarg{corr. en y}\marg{texto}\oarg{pos. x}\oarg{long. l√≠nea}}
%
%  Incluye la firma para el final del reporte. Los argumentos son:
%  \begin{enumerate}
%   \item inclusi√≥n de la imagen (e.g. |\includegraphics|),
%   \item corrimiento en |X| de la imagen, para un ajuste m√°s fino de la posici√≥n de la firma,
%   \item corrimiento en |Y|,
%   \item texto debajo de la l√≠nea ({\itshape va entre llaves y no entre corchetes como los dem√°s}). El predeterminado es el dado mediante el comando |\Proveedor|, o en su defecto, |\Emisor|),
%   \item posici√≥n en |X| del final de la l√≠nea, medida desde la derecha (predeterminado: 2cm),
%   \item tama√±o extra de la l√≠nea de la firma. La clase mide el tama√±o del texto y de la imagen (si se especific√≥), y al que sea mayor le agrega este extra de l√≠nea para que sobresalga a los dos lados. (Predeterminado: tama√±o de la imagen o del nombre + 1.5cm extra).
%  \end{enumerate}
%  {\itshape {\bfseries Este comando es de los pocos que no es del pre√°mbulo}; debe incluirse en el sitio en el reporte donde se quiera que la firma salga, generalmente al final del reporte y todos sus argumentos son opcionales, incluyendo el texto que va debajo de la l√≠nea, que se incluye entre llaves |{}| a pesar de ser opcional. Cuando no se especifica ning√∫n argumento, s√≥lo dibuja la l√≠nea para firmar y le escribe abajo el nombre dado con |\Proveedor| o en su defecto el dado con |\Emisor|.}
%
% \DescribeMacro{\TituloReporte}{\macrooptcolor|\TituloReporte|\marg{texto}}
%
%  Especificamos un t√≠tulo para el reporte. Este t√≠tulo saldr√° centrado al principio del reporte.
%
% \DescribeMacro{\TituloReporte*}{\macrooptcolor|\TituloReporte*|\marg{texto}}
%
%  Usando |\TituloReporte| u omitiendo su uso, la informaci√≥n que sale en las cabeceras o pies de p√°gina tiene que ver con el n√∫mero de la factura que est√° asociada a ese reporte. Con esta variante con ‚Äú|*|‚Äù de |\TituloReporte|, el t√≠tulo del reporte -especificado con este comando- saldr√° escrito tambi√©n en estas partes de la p√°gina en lugar del texto que indica que el reporte corresponde a determinada factura.
%
% Puede usarse esta opci√≥n tambi√©n en aquellos casos en los que se hace un reporte sin asociarlo a una factura, entonces el t√≠tulo del reporte es la informaci√≥n que sale en la cabecera o pie de cada p√°gina.
%
% \DescribeMacro{\InfoPagina}{\macrooptcolor|\InfoPagina|\marg{texto}}
%
%  Establece el texto que aparece en la cabecera o pie de p√°gina del reporte.
%
% {\itshape Si se quiere usar esta opci√≥n debe hacerse luego de definir el t√≠tulo del reporte porque si no el comando |\TituloReporte*| establece de nuevo la variable que |\InfoPagina| cambia.}
%
%  En |factura.def| hay dos definiciones relativas a la informaci√≥n que aparece en las cabeceras o pies de p√°gina: aquella que escribe el t√≠tulo y aquella que no, es decir, la que aplica con |\TituloReporte*| y la que aplica con |\TituloReporte|, que tambi√©n el usuario podr√° redefinir si lo necesita, pero lo m√°s pr√°ctico ser√≠a usar esta macro para fijar el texto que se desee, y |\EstiloPagReporte| para fijarlo donde se quiera.
%
%
% \subsection{Definiciones en archivos separados \label{subsec:aux}}
%
% \DescribeMacro{\Cliente}{\macrooptcolor|\Cliente|\marg{archivo \LaTeX}}
%
%  {\bfseries Todos los comandos definibles en el pre√°mbulo que alteren la forma como el reporte o la factura es presentada, as√≠ como cualquier variable definida en |factura.def| se puede redefinir y agregar a otro archivo |.tex| o |.def| que el usuario cargue en el pre√°mbulo con |\input|, |\include| o con el comando |\Cliente|; el comando para el cliente existe para que el usuario pueda definir archivos |.tex| o |.def| con los valores espec√≠ficos que aplican para cada cliente.}
%
%  La macro |\Cliente| incluye un archivo cuya extensi√≥n debe ser |.def| o |.tex|, de la misma forma como se hace con |\input|; es simplemente un atajo que adem√°s lee archivos |.def|.
%
% }
%
%
% \section{La factura\label{sec:factura}}
%
% \DescribeEnv{factura}
% La parte del documento donde se agregan los elementos a facturar se escribe dentro de un entorno especial para su tratamiento, llamado |factura|, que produce el cuadro de la factura:
%
% \iffalse
%<*literal>
% \fi
{\VERBATIM
\begin{verbatim}
    \begin{factura}
     [...]
    \end{factura}
\end{verbatim}
}
% \iffalse
%</literal>
% \fi
%
% Dentro de dicho ambiente podemos usar √∫nicamente los comandos que incluyen los elementos a facturar y las posibles etiquetas; esos comandos son, para distintos grav√°menes, los siguientes:
%
%
% \subsection{Agregando elementos a la factura}
%
% \noindent
% {\macromandcolor|\Item|\marg{cantidad}\marg{descripci√≥n}\oarg{descripci√≥n para csv}\marg{precio unitario}\oarg{descripci√≥n s√≥lo para \\ \mbox{}\hfill referencias}}
% \DescribeMacro{\Item}
% \DescribeMacro{\ItemR}
% \DescribeMacro{\ItemA}
% \DescribeMacro{\ItemE}
%
% Con estos comandos agregamos elementos a la factura propiamente dicha. Con |\Item| agregamos un elemento gravado con IVA general (actualmente 12\%); con |\ItemR| agregamos uno con IVA reducido (8\%), con |\ItemA| uno con IVA adicional (27\%), y con |\ItemE| agregamos un elemento exento de impuesto al valor agregado.
%
% Como podemos ver, se especifica la cantidad, luego la descripci√≥n y al final el precio unitario, todos entre llaves, pudiendo intercalar entre estos dos √∫ltimos un par√°metro adicional entre corchetes que sirve para escribir otro texto al archivo |.csv| en sustituci√≥n de la descripci√≥n, ya que a veces la descripci√≥n puede tener macros o caracteres no imprimibles. Si se declara una descripci√≥n y otra descripci√≥n para el |.csv|, la factura impresa manejar√° la descripci√≥n dada primero (entre llaves) y en el archivo |.csv| se escribir√° la descripci√≥n dada despu√©s (entre corchetes).
%
% El √∫ltimo par√°metro opcional (entre corchetes) es otro campo de descripci√≥n pero que no se imprime en el cuadro de la factura sino que se guarda bajo una etiqueta para luego poder usarse en cualquier parte del documento con el comando |\ldescref| (v√©ase la secci√≥n \ref{sec:etiquetas} de las etiquetas). Dicha descripci√≥n puede tener formato de p√°rrafos largos con saltos de l√≠nea.
%
% Tambi√©n tenemos la posibilidad de agregar un √≠tem al que no le ponemos precio, por ejemplo por ser parte de un total, y sus argumentos son la cantidad y la descripci√≥n nada m√°s.
%
% \noindent
% \DescribeMacro{\ItemX}{\macrooptcolor|\ItemX|\marg{cantidad}\marg{descripci√≥n}\oarg{descripci√≥n para csv}\oarg{descripci√≥n s√≥lo para referencias}}
%
%
% \subsubsection{Opci√≥n `{\ttfamily descuentos}'\label{subsec:descuentos}}
%
% \noindent
% {\macromandcolor|\Item|\marg{cantidad}\marg{descripci√≥n}\oarg{descripci√≥n para csv}\marg{precio unitario}\marg{\% descuento} \\ \mbox{}\hfill \oarg{descripci√≥n s√≥lo para referencias}}
% \DescribeMacro{\Item}
% \DescribeMacro{\ItemR}
% \DescribeMacro{\ItemA}
% \DescribeMacro{\ItemE}
%
% Cuando pedimos descuentos individuales (opci√≥n |descuentos| al cargar la clase), todas las macros |\Item| tienen un posible\footnote{Es un argumento opcional, aunque va entre llaves como todos los dem√°s.} argumento m√°s al final que es el descuento porcentual. No especificarlo da el mismo resultado que un descuento de 0\% sobre ese √≠tem:
%
%
% \subsubsection{Opci√≥n `{\ttfamily sincantidad}'\label{subsec:sincantidad}}
%
% \noindent
% \DescribeMacro{\Item}
% \DescribeMacro{\ItemR}
% \DescribeMacro{\ItemA}
% \DescribeMacro{\ItemE}
% {\macromandcolor|\Item|\marg{descripci√≥n}\oarg{descripci√≥n para csv}\marg{precio unitario}\oarg{descripci√≥n s√≥lo para referencias}}
%
% \noindent {\macromandcolor|\Item|\marg{descripci√≥n}\oarg{descripci√≥n para csv}\marg{precio unitario}\marg{\% descuento} \\ \mbox{}\hfill \oarg{descripci√≥n s√≥lo para referencias}}
%
% Por otra parte, si se usa la opci√≥n |sincantidad| al cargar la clase, todos los comandos |\Item| aceptan un argumento menos, que es el de la cantidad; eso significa que sin usar la opci√≥n |descuentos|, la sintaxis de |\Item| queda como lo indica la primera l√≠nea, y usando |descuentos|, queda como lo indica la segunda l√≠nea.
%
% \noindent
% \DescribeMacro{\ItemX}{\macrooptcolor|\ItemX|\marg{descripci√≥n}\oarg{descripci√≥n para csv}\oarg{descripci√≥n s√≥lo para referencias}}
% 
% Puesto que |\ItemX| se usa para elementos sin precio, al usar |sincantidad| quedar√° aceptando s√≥lo un argumento obligatorio que es la descripci√≥n y dos opcionales para la descripci√≥n en el archivo |.csv| y la descripci√≥n larga para referenciar luego. Cuando se activa la opci√≥n |descuentos|, |\ItemX| queda igual puesto que esta macro no lleva precio, entonces tampoco acepta descuentos.
%
% {\itshape Todas las variaciones de estos comandos |\Item| pueden apreciarse en los ejemplos.}
%
%
% \subsection{Descripci√≥n larga al final de la factura}
%
% Una vez terminado el entorno de la factura se puede escribir una descripci√≥n larga que saldr√° en una caja -cuyo estilo puede cambiarse-\footnote{El dise√±o de esta descripci√≥n consiste en su linea de contorno, cambiable como ya explicamos en la subsecci√≥n \ref{subsec:espacioslineas}, espec√≠ficamente con la macro \cs{LineaDescripcion}.} debajo del cuadro de la factura, esto va dentro de un |\parbox| en la implementaci√≥n de la caja. Si esta descripci√≥n no se escribe, simplemente no va a aparecer nada debajo del cuadro de la factura.
%
% \noindent \DescribeMacro{\Descripcion}
% {\macrooptcolor|\Descripcion|\marg{texto en formato de p√°rrafos}}
%
% {\itshape Como podemos ver, |\Descripcion| es otro de los pocos comandos que no se usan en el pre√°mbulo sino dentro del documento, j√∫stamente al terminar el ambiente} |factura|.
%
%
% \section{Reverso de la factura}
%
% \DescribeEnv{reverso}
%  La factura puede tener informaci√≥n escrita en su reverso, por ejemplo para ciertas condiciones cuando estas necesitan mucho espacio. Ese texto se escribe dentro de un entorno llamado |reverso|, que puede o no incluirse seg√∫n el requerimiento del usuario. si est√° escrito en el documento fuente tambi√©n podr√° decidirse si se incluye o no en el documento compilado.
%
% \iffalse
%<*literal>
% \fi
{\VERBATIM
\begin{verbatim}
    \begin{reverso}
     (Aqu√≠ va toda la informaci√≥n que ir√° escrita
      en el reverso de la hoja de la factura.)
    \end{reverso}
\end{verbatim}
}
% \iffalse
%</literal>
% \fi
%
% El reverso de la factura va escrito con la tipograf√≠a que el usuario elije con el comando |\LetraReverso|, como se explicar√° en la secci√≥n \ref{sec:tipografia}, y las dimensiones de la p√°gina se establecen con el comando |\GeometriaReverso| (secci√≥n \ref{sec:comandos}). Dicha geometr√≠a viene con un valor predeterminado en el |.def|.
%
% Si se compila con la opci√≥n |sinreverso|, lo escrito dentro del ambiente |reverso| no saldr√° como reverso en la hoja de la factura.
%
%
% \section{El reporte}
%
% \DescribeEnv{reporte}
%  Para elaborar un reporte, lo √∫nico que se debe hacer es escribir el texto del reporte dentro del ambiente para ese fin, que se llama |reporte|, de manera que en el documento tenemos un ambiente para la factura y otro para el reporte, y elegimos al momento de compilar qu√© es lo que queremos obtener.
%
% \iffalse
%<*literal>
% \fi
{\VERBATIM
\begin{verbatim}
    \begin{reporte}
     (Aqu√≠ va el reporte, sin l√≠mite la extensi√≥n del texto.)
    \end{reporte}
\end{verbatim}
}
% \iffalse
%</literal>
% \fi
%
% Cuando se compila con |conreporte|, el reporte sale desde la segunda p√°gina, o desde la tercera si se usa |twoside|.
%
% Cuando se compila con |soloreporte|, el motor de compilaci√≥n no procesa la factura en favor del reporte, y sin especificar ninguna de estas dos opciones, el reporte es ignorado y sale √∫nicamente la factura (o la prefactura o cotizaci√≥n).
%
% El reporte empieza con un encabezado y luego un t√≠tulo especificable; el encabezado consiste en el nombre del proveedor, el nombre del cliente y la persona de contacto. Luego de ese encabezado viene el t√≠tulo del reporte y despu√©s empieza lo que el usuario escriba dentro del entorno del reporte.
%
% Hay que tener en cuenta que, como se explic√≥ en la secci√≥n \ref{sec:comandos}, el reporte puede tener una imagen de fondo, que puede ser un membrete. Ese membrete, si se quiere en todas las p√°ginas deber√° incluirse con |\FondoReporte*|, y si se quiere s√≥lo en la primera p√°gina del reporte deber√° usarse |\FondoReporte|. Ahora, si se usa la versi√≥n sin |*|, ser√° necesario tambi√©n usar |\InicioReporte| con una distancia para empezar a escribir un poco m√°s abajo en la primera p√°gina, ya que es la √∫nica que tiene el membrete. Pero si se usa la versi√≥n con |*|, entonces basta fijar los m√°rgenes para todas las p√°ginas con |\GeometriaReporte|, tal como se adelant√≥ en la secci√≥n \ref{sec:comandos}.
%
% El reporte estar√° escrito con la tipograf√≠a especificable con |\LetraReporte|, como se explicar√° m√°s adelante en la secci√≥n \ref{sec:tipografia}.
%
% Por otra parte, al reporte se le asigna un t√≠tulo, que puede aparecer o no en la cabecera de p√°gina o en el pie de p√°gina. Si se quiere que aparezca el t√≠tulo en esos lugares, debe usarse |\TituloReporte*|, de lo contrario, |\TituloReporte|. Si no se especifica el t√≠tulo, entonces la informaci√≥n mostrada all√≠ es la referencia a la factura asociada a este reporte, como se coment√≥ antes cuando se introdujeron estos comandos.
%
%
% \subsection{Estilos de p√°gina para el reporte\label{subsec:pagestyle}}
%
% La clase define varios estilos de p√°gina\footnote{Usables en el reporte √∫nicamente.} de \LaTeX{}, cambiables con los comandos usuales: |\pagestyle| y |\thispagestyle| dentro del entorno del reporte, pero es mejor definir el estilo de p√°gina en el pre√°mbulo del documento, con |\EstiloPagReporte|.
%
% Estos estilos de p√°gina est√°n definidos con el paquete |fancyhdr|, y son: \begin{inparaenum}[\bfseries i)]\item |plain|, \item |empty|, \item |soloarriba|, \item |soloabajo|, y \item |solonumpag|\end{inparaenum}.
%
% Con |plain|\footnote{Por razones de compatibilidad usamos dos estilos de p√°gina conocidos en \LaTeX, que son |plain| y |empty|, siendo |plain| uno de nuestros predeterminados.}, en la cabecera saldr√° la informaci√≥n sobre el reporte y en el pie de p√°gina saldr√° el n√∫mero de p√°gina; con |empty| no sale nada en ninguna parte; con |soloarriba| y |soloabajo|, toda esa informaci√≥n anterior sale en la cabecera o en el pie de p√°gina, respectivamente, y con |solonumpag|, lo √∫nico que aparece es el n√∫mero de p√°gina centrado en el pie de p√°gina.
%
% El formato con la informaci√≥n a poner en estas partes de las p√°ginas del reporte es cambiable con |\InfoPagina|, descrito anteriormente.
%
% Cuando se usa |\FondoReporte*|, como se supone que se usa para un membrete en todas las p√°ginas, el estilo de p√°gina predeterminado del reporte ser√° |soloabajo|, para todas las p√°ginas, porque no tendr√≠a sentido tener un membrete en todas las p√°ginas y una cabecera como la descrita anteriormente. Si el comando |\FondoReporte*| se est√° usando para algo distinto de un membrete, por ejemplo una marca de agua, entonces es probable querer cambiar los estilos de p√°gina con |\EstiloPagReporte|.
%
% Si se usa |\FondoReporte|, el estilo predeterminado para la primera p√°gina ser√° |solonumpag|, y |plain| para el resto de las p√°ginas, y si se no se especifica fondo alguno, entonces el estilo de p√°gina predeterminado para todas las p√°ginas ser√° |plain|.
%
% El usuario podr√° definir m√°s estilos de p√°gina adicionales para colocar el texto que se quiera en el lugar que se quiera, y usar esos estilos de p√°gina con |\EstiloPagReporte|. Para eso puede leer la documentaci√≥n del paquete |fancyhdr|, que es lo que esta clase usa para los estilos de p√°gina. Tambi√©n puede consultar |factura.def|, que es donde est√°n predefinidos los estilos que trae la clase.
%
% El grosor de la l√≠nea decorativa que coloca el paquete |fancyhdr| est√° definido en el archivo |.def|, y es cambiable en la macro |\@GrosorLineaInfoPag| como podr√° verse en dicho archivo; no definimos un comando para ello por no ser algo relevante pero igual podr√° cambiarse con |\renewcommand| por ejemplo, como se hace en dicho |.def|.
%
%
% \section{Tipograf√≠as para cada elemento a escribir\label{sec:tipografia}}
%
% Cada elemento escrito en la factura o reporte es sujeto a ser mostrado con una tipograf√≠a distinta, para lo cual existen comandos con los que se asigna el tipo de letra o estilo para cada cosa que sale escrita en el documento, por ejemplo, se puede cambiar el tipo de letra con el que se escribe la fecha, el tipo de letra con el que salen los elementos dentro del cuadro de la factura, el tipo de letra de los totales, de los t√≠tulos, de las cabeceras o pies de p√°gina en el reporte, etc.
%
% Cuando en lo sucesivo nos referiremos a tipograf√≠a, tipo de letra, o letra, nos estaremos refiriendo a cualquier cambio en la tipograf√≠a que pueda significar el nombre de la letra, su tama√±o o atributos como negritas, es decir, mediante cualquiera de estos comandos podemos cambiar cualquier aspecto de la tipograf√≠a. Mirando el archivo |.def| pueden verse todos los valores predeterminados, que la mayor√≠a de ellos son simplemente cambios en el tama√±o (macro |\fontsize| de \LaTeX{}), y en algunos casos negritas.
%
% {\setlength{\parindent}{0pt}
% \DescribeMacro{\LetraItems}{\macrooptcolor|\LetraItems|\marg{tipo de letra}}
%
%  Con este comando cambiamos la tipograf√≠a utilizada en los √≠tems o elementos que est√°n en el cuadro de la factura, de manera que {\itshape cambiar la longitud \cs{baselineskip} con el segundo argumento de \cs{fontsize} har√° que la tabla tenga una altura distinta de las celdas.}
%
%  Lo anterior significa que {\bfseries para cambiar la altura de las celdas, la forma correcta es a trav√©s de cambiar el tama√±o de la letra de sus elementos con este comando. (V√©ase el archivo |.def|)}.
%
% \DescribeMacro{\LetraNumeros}{\macrooptcolor|\LetraNumeros|\marg{tipo de letra}}
%
%  Este comando sirve para cambiar el tipo de letra de tota la informaci√≥n num√©rica que aparece en las distintas columnas del cuadro de la factura, sin contar los totales, para los cuales hay otros comandos.
%
% \DescribeMacro{\LetraTipoIVA}{\macrooptcolor|\LetraTipoIVA|\marg{tipo de letra}}
%
%  El tipo del IVA es la letra que indica qu√© IVA est√° siendo gravado, por ejemplo, la ‚Äú|G|‚Äù, ‚Äú|R|‚Äù y ‚Äú|A|‚Äù que puede salir al lado de los elementos con IVA general, reducido y adicional respectivamente, y ‚Äú|(E)|‚Äù al lado de los elementos exentos. Con esta macro cambiamos la letra con la que eso sale.
%
% \DescribeMacro{\LetraTitColumnas}{\macrooptcolor|\LetraTitColumnas|\marg{tipo de letra}}
%
%  Con |\LetraTitColumnas| podemos cambiar la tipograf√≠a de los t√≠tulos de los campos que hay en el cuadro de la factura, es decir, los textos ‚ÄúCantidad‚Äù, ‚ÄúDescripci√≥n‚Äù, ‚ÄúPrecio U.‚Äù, etc.
%
% \DescribeMacro{\LetraTitTotales}{\macrooptcolor|\LetraTitTotales|\marg{tipo de letra}}
%
%  Con este comando cambiamos la tipograf√≠a de los nombres de los totales, es decir, ‚ÄúIVA G.‚Äù, ‚ÄúBI G.‚Äù, salvo el total general que se cambia con |\LetraTitTotal|.
%
% \DescribeMacro{\LetraNumTotales}{\macrooptcolor|\LetraNumTotales|\marg{tipo de letra}}
%
%  Con esta macro se cambia la tipograf√≠a utilizada en los totales num√©ricos de la factura, exceptuando el total general que se cambia con |\LetraNumTotal|.
%
% \DescribeMacro{\LetraTitTotal}{\macrooptcolor|\LetraTitTotal|\marg{tipo de letra}}
%
%  Para cambiar la tipograf√≠a de la palabra que indica el total general, e.g. ‚ÄúTOTAL‚Äù, lo hacemos con |\LetraTitTotal|.
%
% \DescribeMacro{\LetraNumTotal}{\macrooptcolor|\LetraNumTotal|\marg{tipo de letra}}
%
%  Para la tipograf√≠a del total general (la celda con el n√∫mero del total final), utilizamos este comando.
%
% \DescribeMacro{\LetraTitEnc}{\macrooptcolor|\LetraTitEnc|\marg{tipo de letra}}
%
%  Con este comando cambiamos el tipo de letra de la informaci√≥n en el t√≠tulo de las cajas del encabezado de la factura, por ejemplo los textos: ‚ÄúResumen‚Äù y ‚ÄúDatos del cliente‚Äù.
%
% \DescribeMacro{\LetraEncFactura}{\macrooptcolor|\LetraEncFactura|\marg{tipo de letra}}
%
%  Podemos tambi√©n cambiar el tipo de letra de la informaci√≥n del encabezado de la factura, es decir, el tipo de letra del texto que escribe el usuario en el resumen o de toda la identificaci√≥n del cliente en la factura. El resumen naturalmente acepta m√°s cambios de tipograf√≠a escribi√©ndolos dentro del p√°rrafo que se escribe con el comando |\Resumen|.
%
% \DescribeMacro{\LetraEncReporte}{\macrooptcolor|\LetraEncReporte|\marg{tipo de letra}}
%
%  Para cambiar la tipograf√≠a de la informaci√≥n del encabezado del reporte usamos |\LetraEncReporte|.
%
% \DescribeMacro{\LetraNotaPrevia}{\macrooptcolor|\LetraNotaPrevia|\marg{tipo de letra}}
%
%  Con |\LetraNotaPrevia| podemos cambiar la tipograf√≠a con la que se escribe la -opcional- nota previa al cuadro de la factura.
%
% \DescribeMacro{\LetraNotaInterna}{\macrooptcolor|\LetraNotaInterna|\marg{tipo de letra}}
%
%  Con |\LetraNotaInterna| cambiamos el formato de la nota opcional que aparece como coletilla de la factura (nota interna).
%
% \DescribeMacro{\LetraNotaExterna}{\macrooptcolor|\LetraNotaExterna|\marg{tipo de letra}}
%
%  Tambi√©n podemos cambiar la tipograf√≠a de la nota externa a la factura, es decir, la -opcional- nota que va al terminar el cuadro de la factura antes de la -opcional tambi√©n- descripci√≥n larga.
%
% \DescribeMacro{\LetraDescripcion}{\macrooptcolor|\LetraDescripcion|\marg{tipo de letra}}
%
%  Con este comando cambiamos la tipograf√≠a de la descripci√≥n larga; naturalmente cualquier cambio puede hacerse luego dentro del texto de la descripci√≥n, igual que con el resumen.
%
% \DescribeMacro{\LetraFirmas}{\macrooptcolor|\LetraFirmas|\marg{tipo de letra}}
%
%  Con |\LetraFirmas| podemos cambiar la letra usada para escribir el nombre debajo de la l√≠nea para firmar en la factura.
%
% \DescribeMacro{\LetraNotaFinal}{\macrooptcolor|\LetraNotaFinal|\marg{tipo de letra}}
%
%  Para cambiar la tipograf√≠a de la nota final se hace con este comando. (Aplica el mismo comentario que para la descripci√≥n y el resumen).
%
% \DescribeMacro{\LetraDenom}{\macrooptcolor|\LetraDenom|\marg{tipo de letra}}
%
%  La tipograf√≠a asociada a la denominaci√≥n del documento, es decir, al lado del n√∫mero (e.g. ‚ÄúFACTURA‚Äù o ‚ÄúCOTIZACI√ìN‚Äù), y la asociada al texto ‚ÄúNo. CONTROL‚Äù se cambia con |\LetraDenom|.
%
% \DescribeMacro{\LetraNumeracion}{\macrooptcolor|\LetraNumeracion|\marg{tipo de letra}}
%
%  Con |\LetraNumeracion| cambiamos la tipograf√≠a de las numeraciones como la del n√∫mero de la factura y el n√∫mero de control.
%
% \DescribeMacro{\LetraFecha}{\macrooptcolor|\LetraFecha|\marg{tipo de letra}}
%
%  La tipograf√≠a para la fecha de emisi√≥n y la fecha de vencimiento la podemos cambiar con este comando.
%
% \DescribeMacro{\LetraTitReporte}{\macrooptcolor|\LetraTitReporte|\marg{tipo de letra}}
%
%  La letra del t√≠tulo que aparece al principio del reporte se puede cambiar con |\LetraTitReporte|.
%
% \DescribeMacro{\LetraInfoPagina}{\macrooptcolor|\LetraInfoPagina|\marg{tipo de letra}}
%
%  Las cabeceras o pies de p√°gina del reporte tambi√©n tienen un comando para su tipo de letra, y es |\LetraInfoPagina|.
%
% \DescribeMacro{\LetraReverso}{\macrooptcolor|\LetraReverso|\marg{tipo de letra}}
%
%  Con |\LetraReverso| cambiamos la tipograf√≠a de la informaci√≥n que escribamos en el reverso de la hoja de la factura.
%
% \DescribeMacro{\LetraReporte}{\macrooptcolor|\LetraReporte|\marg{tipo de letra}}
%
%  Finalmente, para cambiar la tipograf√≠a con la que se inicia el reporte tenemos este comando. Obviamente tambi√©n luego se puede hacer cualquier cambio dentro del ambiente |reporte|.
%
% }
%
%
% \section{Etiquetas y referencias a √≠tems de la factura\label{sec:etiquetas}}
%
% Esta clase |factura| soporta agregar etiquetas a cada elemento de la factura que luego en el reporte o en casi cualquier otra parte queramos referenciar; {\slshape no se pueden referenciar etiquetas solamente en la nota previa ni en el resumen.}
%
% \noindent \DescribeMacro{\label}{\macrooptcolor|\label|\marg{etiqueta}}
%
%  Para ello usamos la conocida macro |\label| de \LaTeX{} justamente despu√©s del √≠tem que nos interese luego referenciar, por ejemplo (usando descuentos individuales):
%
% \iffalse
%<*literal>
% \fi
{\VERBATIM
\begin{verbatim}
    \begin{factura}
     \Item{1}{Art√≠culo gravado con IVA general}{1000}
     \Item{3}{Otro art√≠culo gravado con IVA general}{1500}{10}[Descripci√≥n larga 
      para referenciar el reporte u otro fin.

      Con formato de p√°rrafo con saltos de l√≠nea si se desea.]\label{el-otro}
    \end{factura}
\end{verbatim}
}
% \iffalse
%</literal>
% \fi
%
% De esta forma creamos una etiqueta llamada ‚Äúel-otro‚Äù para el segundo elemento, que luego podremos citar por ejemplo en la descripci√≥n larga o en el reporte con comandos similares a los que \LaTeX{} provee para referenciar etiquetas.
%
% \noindent \DescribeMacro{\itemref}{\macrooptcolor|\itemref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\cantref}{\macrooptcolor|\cantref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\descref}{\macrooptcolor|\descref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\puref}{\macrooptcolor|\puref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\subtref}{\macrooptcolor|\subtref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\dctoref}{\macrooptcolor|\dctoref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\ivaref}{\macrooptcolor|\ivaref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\ptref}{\macrooptcolor|\ptref|\marg{etiqueta}}\\
% \noindent \DescribeMacro{\ldescref}{\macrooptcolor|\ldescref|\marg{etiqueta}}\par
%
% Si se quiere mostrar el n√∫mero de la l√≠nea que ocupa el √≠tem en la lista lo hacemos con |\itemref|, que en el ejemplo aparecer√≠a el n√∫mero ‚Äú|2|‚Äù indicando que es el segundo √≠tem de la factura\footnote{Cuando se usa \cs{itemref} conviene enumerar los √≠tems en la factura con la opci√≥n \texttt{numitem}.}. Con |\cantref| escribimos la cantidad del elemento citado mediante la etiqueta, en nuestro ejemplo ser√≠a ‚Äú|3|‚Äù. Para la descripci√≥n del √≠tem usamos |\descref|, que en el caso del ejemplo ser√≠a el texto ‚Äú|Otro art√≠culo gravado con IVA general|‚Äù. Para el precio unitario usamos |\puref|, en el ejemplo ‚Äú|1.500,00|‚Äù. El subtotal lo mostrar√≠amos con |\subtref|; en nuestro caso ‚Äú|4.500,00|‚Äù. Si se quiere mostrar el porcentaje del descuento del √≠tem citado usamos |\dctoref|, que para el ejemplo ser√≠a ‚Äú|10|‚Äù. Para el porcentaje del IVA, usamos |\ivaref|, en nuestro caso escribir√≠a ‚Äú|12|‚Äù. Por √∫ltimo, para mostrar el precio total usamos |\ptref|, y en nuestro ejemplo eso escribir√≠a ‚Äú|4.050,00|‚Äù puesto que aplicamos un descuento del 10\%.
%
% Podemos ver que el uso de los comandos |\puref|, |\subtref| y |\ptref| nos muestra el precio en el mismo formato con el que lo vemos en la presentaci√≥n de la factura, en cuanto al redondeo y al separador de miles y decimal.
%
% Tambi√©n podemos referenciar la -opcional- descripci√≥n larga que podemos usar por ejemplo en el reporte; esa descripci√≥n que va entre corchetes la podremos citar con |\ldescref|, y en nuestro ejemplo ser√≠a:
% ‚ÄúDescripci√≥n larga para referenciar el reporte u otro fin. Con formato de p√°rrafo con saltos de l√≠nea si se desea.‚Äù\footnote{Aqu√≠ suprimimos los saltos de l√≠nea.}
%
% Con la asignaci√≥n de estas etiquetas y su uso mediante las referencias podemos de manera conveniente citar cualquier √≠tem que se haya facturado, de manera din√°mica sin tener que reescribir en la descripci√≥n larga o en el reporte aquello que ya se escribi√≥ en el cuadro de la factura. Para estas referencias se escogieron nombres de las macros que terminan en ‚Äú\texttt{ref}‚Äù por compatibilidad con comandos de \LaTeX{} como |\pageref|.
%
%
%
% \section{Referenciar los valores establecidos en el pre√°mbulo y los totales\label{sec:ref}}
%
%  En el pre√°mbulo el usuario defini√≥ distintas macros, es decir, estableci√≥ la raz√≥n social del cliente, el R.I.F. y la direcci√≥n, entre otras cosas. Cualquiera de esas definiciones hechas en el pre√°mbulo puede usarse luego en otra parte del documento con el mismo comando que se us√≥ para su definici√≥n. Lo anterior significa que tenemos las siguientes macros posibles para usar dentro del cuerpo del documento (factura, reporte o reverso): |\Moneda|, |\RazonSocial|, |\RIF|, |\Direccion|, |\Telefono|, |\Email|, |\Contacto|, |\Emisor|, |\Conforme|, |\Proveedor|, |\Fecha|, |\FechaVencimiento|\footnote{La fecha de vencimiento no se establece en el pre√°mbulo expl√≠citamente sino a trav√©s de \cs{Credito} pero la clase dispone de esta interfaz para acceder a ella as√≠ como tambi√©n con la interfaz dada por \texttt{datetime2}.}, |\Credito|, |\Num|, |\NumControl|, |\NumSerieControl|, |\Resumen|, |\NotaPrevia|, |\NotaInterna|, |\NotaExterna|, |\NotaFinal|, |\TituloReporte|.
%
% Esas macros, en el pre√°mbulo funcionan para definir valores y textos, pero si ya no estamos en el pre√°mbulos sino dentro del cuerpo del documento y escribimos una de esas macros\footnote{Dentro del cuerpo del documento estas macros obviamente no aceptan argumentos.}, lo que nos va a escribir ser√° lo que est√° definido bajo esa macro, as√≠ sea con macros que no llegamos a utilizar expl√≠citamente pero que tienen un valor predefinido como |\Moneda|.
%
% Por otra parte, en el documento el usuario tambi√©n podr√° referirse a cualquiera de los totales de la siguiente tabla\footnote{Las macros de la tabla, para representarlas en el mismo formato que en la factura, debemos usar la macro \cs{numprint}.}:
%
% \noindent \begin{tabular}{rl}
% \hline
% Total & Comando \\ \hline
% Bases imponibles & |\BIG|, |\BIR|, |\BIA|, |\BIE|\footnote{Lo llamamos \cs{BIE} para mantener la nomenclatura pero no es una base imponible ya que es un monto exento de impuesto.} \\
% IVA & |\AlicuotaG|, |\AlicuotaR|, |\AlicuotaA| \\
% Descuento en IVA & |\AlicuotaGDesc| \\
% Subtotales\footnote{El subtotal es el monto sin aplicar descuentos generales (los que se hacen con los comandos \cs{Descuento***}, es decir, los descuentos que no son individuales a cada item sino al totalizar), que coincide con la base imponible cuando no hay esos descuentos.} & |\SubtG|, |\SubtE|, |\SubtR|, |\SubtA| \\
% Descuentos & |\DescG|, |\DescE|, |\DescR|, |\DescA| \\
% Total final & |\Total| \\
% \hline
% \end{tabular}
%
% Tambi√©n ya mencionamos que la fecha de emisi√≥n y vencimiento se pueden acceder con la interfaz dada por el paquete |datetime2|, por ejemplo, para mostrar la fecha de emisi√≥n, podremos usar tanto |\Fecha| como |\DTMusedate{FechaEmision}|, y para la fecha de vencimiento, tanto |\FechaVencimiento| como |\DTMusedate{FechaVencimiento}|.
%
% La cantidad de √≠tems en la factura la podemos acceder via el contador |NumItem|, por ejemplo as√≠ |\arabic{NumItem}|.
%
% En los ejemplos hay casos con todas estas funciones de esta secci√≥n.
%
%
% \section{M√°s personalizaciones}
%
% \DescribeMacro{\@BeforeEndPreamble}
% La clase provee de un ‚Äúgancho‚Äù llamado \cs{BeforeEndPreamble}. Lo que all√≠ se agregue (es acumulativo, se puede ejecutar mas de una vez) ser√° ejecutado por la clase |factura| luego de que hayan sido evaluadas las opciones de la clase y tomadas todas las decisiones en cuanto a opciones que impliquen otras opciones o que sean incompatibles con otras opciones; una vez que todas esas decisiones fueron tomadas y todo queda establecido, se ejecuta \cs{BeforeEndPreamble}, esto con el prop√≥sito de que el usuario pueda personalizar m√°s el comportamiento de sus archivos |.tex|. Por ejemplo si el usuario hace lo siguiente, no funcionar√°:
%
% \iffalse
%<*literal>
% \fi
{\VERBATIM
\begin{verbatim}
    \documentclass[cotizacion]{factura}
    [...]
    \ifcotizacion\FondoFactura{Fondo}\fi
    \begin{document}
     \begin{factura}
      [...]
     \end{factura}
    \end{document}
\end{verbatim}
}
% \iffalse
%</literal>
% \fi
%
% No funcionar√° porque el condicional \cs{ifcotizacion} a√∫n no se ha establecido (eso lo hace la clase con el gancho \cs{AtEndPreamble} de |etoolbox| luego de que todo el pre√°mbulo haya sido analizado), por lo que se evaluar√° como falso; tendr√≠a el usuario que agregarlo dentro de un gancho \cs{AtEndPreamble} pero tampoco funcionar√° del todo, para eso esta clase provee del gancho \cs{BeforeEndPreamble}, y se escribir√≠a este ejemplo as√≠:
%
% \iffalse
%<*literal>
% \fi
{\VERBATIM
\begin{verbatim}
    \documentclass[cotizacion]{factura}
    [...]
    \BeforeEndPreamble{\ifcotizacion\FondoFactura{Fondo}\fi}
    \begin{document}
     \begin{factura}
      [...]
     \end{factura}
    \end{document}
\end{verbatim}
} 
% \iffalse
%</literal>
% \fi
%
% De esta forma, el condicional se evaluar√° despu√©s de que se hayan establecido todas las opciones (en este caso, |cotizacion|) y el usuario podr√° inclusive apagar opciones y encenderlas nuevamente usando los condicionales (como se explic√≥ en la subsecci√≥n \ref{subsec:condicionales} porque despu√©s de ejecutar este gancho, autom√°ticamente se volver√°n a evaluar las opciones y a tomar todas las decisiones de implicaciones y compatibilidades.
%
% \newpage
% \DescribeMacro{\@PosicionaFechas}
% \DescribeMacro{\@PosicionaDenom}
% \DescribeMacro{\@PosicionaNumControl}
% \DescribeMacro{\@PosicionaNotaFinal}
% \DescribeMacro{\@PosicionaFirmas}
% \DescribeMacro{\@EscribeDatos}
% \DescribeMacro{\@EscribeDatosResumen}
% \DescribeMacro{\@EscribeDatosReporte}
% \DescribeMacro{\@EscribeNotaFinal}
% \DescribeMacro{\@EscribeNotaPrevia}
% \DescribeMacro{\@DibujaLinea}
% \DescribeMacro{\@EscribeItemsEnCSV}
% \DescribeMacro{\@EscribeTotalesEnCSV}
% \DescribeMacro{\@EncabezadoFactura}
% \DescribeMacro{\@EncabezadoReporte}
% Tambi√©n es posible darle aspecto distinto a muchas de las partes que conforman la factura. Internamente en la clase, cada parte es ubicada en la hoja con un comando y su contenido es escrito en el papel con otro comando. Los comandos que m√°s probablemente son sujetos a ser cambiados por el usuario son los comandos que escriben el texto m√°s que aquellos que lo ubican en la hoja, por tal raz√≥n, los comandos que posicionan aquello que va a escribirse lo definimos dentro del archivo |.cls|, y los que propiamente escriben cada parte de la hoja est√°n definidos en el |.def|. Ambas fuentes las podr√°n consultar los usuarios para mayor comprensi√≥n, y para la total personalizaci√≥n. Recomendamos empezar por el archivo de definiciones |factura.def|.
%
% Estas macros son internas y sirven para, como dijimos antes, que \LaTeX{} se prepare para escribir el texto en la hoja; todas empiezan con |\@Posiciona| y no debe ser com√∫n necesitar cambiarlas.
%
% Todas estas macros llaman a su correspondiente macro con el estilo del elemento a escribir, que comienza con |\@Estilo|, y con cambiar su contenido podemos cambiar la forma como es escrita esa parte de la factura en la hoja.
%
% \DescribeMacro{\@EstiloFechas}
% \DescribeMacro{\@EstiloDenom}
% \DescribeMacro{\@EstiloNumControl}
% \DescribeMacro{\@EstiloNotaPrevia}
% \DescribeMacro{\@EstiloNotaFinal}
% \DescribeMacro{\@EstiloFirmas}
% \DescribeMacro{\@DatosTIKZ}
% \DescribeMacro{\@NotaPreviaTIKZ}
% \DescribeMacro{\@DescripcionTIKZ}
% \DescribeMacro{\@NotaFinalTIKZ}
% Estas √∫ltimas son las que est√°n definidas dentro de |factura.def|, y que eventualmente puede desearse cambiarlas.
%
% Adicionalmente est√°n las macros que se encargan de distintas partes de la factura y del reporte como los datos del cliente, el resumen, la nota previa, la nota final, los encabezados, la informaci√≥n en el archivo |.csv|, y la macro que dibuja la l√≠nea que inutiliza el espacio en blanco. Todas estas son macros internas que no deben ser llamadas por el usuario, y no consideramos que pueda sea necesario cambiarlas.
%
% Por √∫ltimo, las macros que alojan el dise√±o \tikz de los datos del cliente, la nota previa, la descripci√≥n larga y la nota final son |\@DatosTIKZ|, |\@NotaPreviaTIKZ|, |\@DescripcionTIKZ| y |\@NotaFinalTIKZ|; est√°n definidas en el archivo |factura.def|.
%
% Cualquiera de estas macros que se quiera redefinir habr√≠a que hacerlo en el pre√°mbulo del |.tex| y encerr√°ndolas entre |\makeatletter| y |\makeatother| para poder redefinir una macro que contiene un s√≠mbolo ‚Äú|@|‚Äù.
%
% {\bfseries \itshape Finalmente, como dijimos en la secci√≥n \ref{subsec:aux}, una vez adecuada la clase al dise√±o que se quiere, se podr√°n escribir todos los comandos que hacen estos ajustes en un} |.tex| {\itshape o} |.def| {\itshape y cargarlo con} |\input|, |\include| {\itshape o con} |\Cliente|, pudiendo discriminar por clientes dicha personalizaci√≥n.
%
%
%
% \newpage
% \setstretch{1}
% \section{Tabla con todas las opciones}
%
% \noindent La tabla que sigue muestra una lista de las opciones posibles al momento de cargar la clase:
%
% \noindent \begin{tabular}{>{\ttfamily}ll}
%  \rmfamily \bfseries Opci√≥n & \bfseries Significado \\ \hline
%  agrupado & Agrupa los totales por tipo en el modo de columnas. \\
%  centradesc & Centra la descripci√≥n de los √≠tems. \\
%  centrado & Centra los totales en el modo de filas. \\
%  conlineasha & Dibuja una l√≠nea separando los art√≠culos entre s√≠. \\
%  conreporte & Produce la factura y el reporte. \\
%  cotizaci√≥n & Imprime una cotizaci√≥n. \\
%  csv & Genera un archivo |.csv| con la informaci√≥n num√©rica de la factura. \\
%  dcu & Descripci√≥n, cantidad, precio unitario. \\
%  denom & Explicita la denominaci√≥n del documento. \\
%  descuentos & A cada art√≠culo se le puede asignar un descuento individual. \\
%  dosfirmas & Incluye los dos espacios para firmar. \\
%  duc & Descripci√≥n, precio unitario, cantidad. \\
%  electro\footnote{Ya no sirve esta opci√≥n.} & Calcula los descuentos para el IVA para pagos por medios electr√≥nicos. \\
%  expandecuadro & Llena con espacio extra el cuadro de la factura. \\
%  filas & Escribe los totales en filas. \\
%  G & Agrega una ‚Äú|G|‚Äù en los √≠tems con IVA general. \\
%  impdesc & Escribe la denominaci√≥n del IVA en la descripci√≥n. \\
%  iva & Expresa en otra columna el porcentaje de IVA para cada elemento a facturar. \\
%  linea & Dibuja una l√≠nea que inutiliza el espacio en blanco en el cuadro de la factura. \\
%  nospanish & No carga |babel| ni |fontenc|. \\
%  numitem & Enumera los √≠tems en la factura en otra columna extra al principio. \\
%  prefactura & Imprime una prefactura. \\
%  sincantidad & Los art√≠culos van sin expresar su cantidad. \\
%  sinexpandir & No expande elementos en la factura. \\
%  sinfirmas & No incluye espacios para firmar. \\
%  siniva & No incluye IVA, pero lo deja expresado. \\
%  sinivaexpresado & No incluye IVA ni lo expresa. \\
%  sinlineahni & No dibuja la l√≠nea horizontal entre totales y nota interna. \\
%  sinlineahtit & No dibuja la l√≠nea horizontal del t√≠tulo de las columnas. \\
%  sinlineahtot & No dibuja la l√≠nea horizontal entre √≠tems y totales. \\
%  sinlineashi & No dibuja las l√≠neas horizontales internas. \\
%  sinlineashe & No dibuja las l√≠neas horizontales externas. \\
%  sinlineash & No dibuja ninguna l√≠nea horizontal. \\
%  sinlineasvi & No dibuja las l√≠neas verticales internas. \\
%  sinlineasve & No dibuja las l√≠neas verticales externas. \\
%  sinlineasv & No dibuja ninguna l√≠nea vertical. \\
%  sinmarcas & No escribe el car√°cter de fin de l√≠nea ni el car√°cter en las celdas vac√≠as \\
%            & cuando la descripci√≥n ocupa m√°s que una l√≠nea. \\
%  sinmonedatotales & Quita el signo monetario de las totalizaciones. \\
%  sinnumero & No pone el n√∫mero cuando se usa |denom|. \\
%  sintotales & No escribe los totales al final del cuadro; para cotizaciones. \\
%  sinreverso & No compila el reverso de la factura as√≠ se haya escrito. \\
%  soloreporte & Produce √∫nicamente el reporte. \\
%  subtotal & En otra columna muestra el subtotal de cada √≠tem antes aplicar descuento. \\
%  todosiva & Expresa todos los tipos de IVA. \\
%  twoside & Imprime el reporte a dos caras. \\
%  unafirma & S√≥lo incluye la firma del emisor. \\
%  vencimiento & Escribe la fecha de vencimiento as√≠ no haya cr√©dito en la factura. \\
% \end{tabular}
%
%
% \newpage
% \section{Tabla con todos los comandos}
%
% A continuaci√≥n presentamos una tabla con todos los comandos, que salvo |\FirmaReporte|, los |\Item| y |\Descripcion|, se poner todos en el pre√°mbulo.
%
% \noindent \begin{tabular}{>{\ttfamily}ll}
% \rmfamily \bfseries Comando & \bfseries Significado \\ \hline
%  |\cantref| & Muestra la cantidad del √≠tem referenciado. \\
%  |\CI| & C√©dula de identidad del cliente. \\
%  |\Cliente| & Carga un archivo |.def| o |.tex| con personalizaciones. \\
%  |\NotaFinal| & Establece la nota final. \\
%  |\Conforme| & Nombre de quien recibe la factura, para el espacio de la firma. \\
%  |\Contacto| & Persona de contacto. \\
%  |\Credito| & Establece la cantidad de d√≠as para el cr√©dito de la factura. \\
%  |\dctoref| & Muestra al descuento del √≠tem referenciado. \\
%  |\Denom| & Nombre de la denominaci√≥n de documento. \\
%  |\descref| & Muestra a la descripci√≥n del √≠tem referenciado. \\
%  |\Descripcion| & Descripci√≥n larga de la factura\footnote{El comando \cs{Descripcion} se escribe dentro del documento, luego del ambiente \texttt{factura}, y no en el pre√°mbulo.}. \\
%  |\Descuento| & Porcentaje de descuento para todos los elementos. \\
%  |\Descuento*| & Descuento neto en el subtotal, para todos los elementos. \\
%  |\Descuento[GRAE]| & Descuento en porcentaje, discriminado seg√∫n el tipo de √≠tem. \\
%  |\Descuento[GRAE]*| & Descuento en el subtotal, discriminado seg√∫n el tipo de √≠tem. \\
%  |\Direccion| & Direcci√≥n del cliente. \\
%  |\Email| & E-mail del cliente. \\
%  |\Emisor| & Nombre de quien emite la factura, para el espacio de la firma. \\
%  |\EstiloPagReporte| & Establece el estilo de p√°gina del reporte. \\
%  |\Fecha| & Establece la fecha de emisi√≥n de la factura en formato predeterminado. \\
%  |\Fecha*| & Establece la fecha de emisi√≥n de la factura en formato ISO. \\
%  |\FirmaFactura| & Carga la imagen de la firma en la factura. \\
%  |\FirmaReporte| & Carga la imagen de la firma en el reporte\footnote{El comando \cs{FirmaReporte} se escribe dentro del ambiente \texttt{reporte} y no en el pre√°mbulo.}. \\
%  |\FondoFactura| & Carga la imagen del fondo de la factura. \\
%  |\FondoReporte| & Carga la imagen del fondo del reporte para la primera p√°gina. \\
%  |\FondoReporte*| & Carga la imagen del fondo del reporte para todas las p√°ginas. \\
%  |\FormatoFecha| & Establece lo relacionado con el formato de las fechas. \\
%  |\GeometriaFactura| & Establece los par√°metros de la geometr√≠a de la factura. \\
%  |\GeometriaReporte| & Establece los par√°metros de la geometr√≠a del reporte. \\
%  |\InfoPagina| & Cambia la informaci√≥n de las cabeceras o pies de p√°gina del reporte. \\
%  |\InicioReporte| & Distancia hasta el inicio del texto en la primera hoja del reporte. \\
%  |\Item[RAEX]| & Agrega un elemento a la factura\footnote{Estos comandos \cs{Item} se escriben dentro del ambiente \texttt{factura} y no en el pre√°mbulo.}. \\
%  |\itemref| & Muestra el n√∫mero de l√≠nea en la factura del √≠tem referenciado. \\
%  |\ivaref| & Muestra al IVA del √≠tem referenciado. \\
%  |\label| & Agrega una etiqueta a un √≠tem de la factura\footnote{Se mantiene el nombre ‚Äú\cs{label}‚Äù por compatibilidad con los comandos conocidos de \LaTeX. Este comando tambi√©n se escribe dentro del ambiente \texttt{factura}.}. \\
%  |\ldescref| & Muestra a la descripci√≥n larga del √≠tem referenciado. \\
% \end{tabular}
% \newpage
% \noindent \begin{tabular}{>{\ttfamily}ll}
% \rmfamily \bfseries Comando & \bfseries Significado \\ \hline
%  |\LetraNotaFinal| & Tipograf√≠a para la nota final. \\
%  |\LetraDenom| & Tipograf√≠a para la denominaci√≥n del documento. \\
%  |\LetraDescripcion| & Tipograf√≠a para la descripci√≥n en la factura. \\
%  |\LetraEncFactura| & Tipograf√≠a para la informaci√≥n en las cajas del encabezado. \\
%  |\LetraEncReporte| & Tipograf√≠a para la informaci√≥n del encabezado del reporte. \\
%  |\LetraFecha| & Tipograf√≠a para la fecha de emisi√≥n. \\
%  |\LetraFirmas| & Tipograf√≠a para los nombres de quienes firman la factura. \\
%  |\LetraInfoPagina| & Tipograf√≠a para las cabeceras o pies de p√°gina del reporte. \\
%  |\LetraItems| & Tipograf√≠a para los √≠tems en la factura. \\
%  |\LetraNotaExterna| & Tipograf√≠a para la nota externa al cuadro de la factura. \\
%  |\LetraNotaInterna| & Tipograf√≠a para la nota interna al cuadro de la factura. \\
%  |\LetraNotaPrevia| & Tipograf√≠a para la nota previa al cuadro de la factura. \\
%  |\LetraNumeracion| & Tipograf√≠a para las numeraciones. \\
%  |\LetraNumeros| & Tipograf√≠a para los n√∫meros en la factura. \\
%  |\LetraNumTotal| & Tipograf√≠a para el total final num√©rico. \\
%  |\LetraNumTotales| & Tipograf√≠a para los totales num√©ricos. \\
%  |\LetraReporte| & Tipograf√≠a para el texto del reporte. \\
%  |\LetraReverso| & Tipograf√≠a para el reverso de la factura. \\
%  |\LetraTipoIVA| & Tipograf√≠a para el tipo de IVA. \\
%  |\LetraTitColumnas| & Tipograf√≠a para los nombres de las columnas del cuadro de la factura. \\
%  |\LetraTitEnc| & Tipograf√≠a para los t√≠tulos en las cajas del encabezado de la factura. \\
%  |\LetraTitReporte| & Tipograf√≠a para el t√≠tulo del reporte. \\
%  |\LetraTitTotal| & Tipograf√≠a para el nombre del total final. \\
%  |\LetraTitTotales| & Tipograf√≠a para los nombres de los totales. \\
%  |\LineaNotaFinal| & Grosor de la l√≠nea de la caja de la nota final, \\
%                      & curvatura de la esquina y sombra. \\
%  |\LineaDescripcion| & Grosor de la l√≠nea de la caja de la descripci√≥n, \\
%                      & curvatura de la esquina y sombra. \\
%  |\LineaEncabezado| & Grosor de la l√≠nea de las cajas del encabezado de la factura, \\
%                     & curvatura de la esquina y sombra. \\
%  |\LineaNotaPrevia| & Grosor de la l√≠nea de la caja de la nota previa al cuadro, \\
%                     & curvatura de la esquina y sombra. \\
%  |\LineaFirmas| & Longitud y grosor de las l√≠neas para firmar. \\
% \end{tabular}
% \newpage
% \noindent \begin{tabular}{>{\ttfamily}ll}
% \rmfamily \bfseries Comando & \bfseries Significado \\ \hline
%  |\Moneda| & Cambia el signo monetario a mostrar. \\
%  |\Nombre| & Establece el nombre del cliente. \\
%  |\NotaInterna| & Escribe una nota interna al cuadro de la factura. \\
%  |\NotaExterna| & Escribe una nota extra externa al cuadro de la factura. \\
%  |\NotaPrevia| & Escribe una nota antes del cuadro de la factura. \\
%  |\Num| & N√∫mero de la factura. \\
%  |\NumControl| & N√∫mero de control de la factura. \\
%  |\NumSerieControl| & N√∫mero de serie de control de la factura. \\
%  |\PosNotaFinal| & Posici√≥n $(x_o,x_f,y)$ del p√°rrafo con la nota final. \\
%  |\PosNotaFinal*| & Posici√≥n $(x_o,x_f,y)$ del p√°rrafo con la nota final \\
%                     & (el texto se despliega hacia arriba). \\
%  |\PosControl| & Posici√≥n $(x,y)$ del n√∫mero de control. \\
%  |\PosControl*| & Posici√≥n $(x,y)$ del n√∫mero de control \\
%                 & (el texto se despliega hacia arriba). \\
%  |\PosDenom| & Posici√≥n $(x,y)$ del texto de la denominaci√≥n. \\
%  |\PosDenom*| & Posici√≥n $(x,y)$ del texto de la denominaci√≥n \\
%               & (el texto se despliega hacia arriba). \\
%  |\PosFecha| & Posici√≥n $(x,y)$ de las fechas. \\
%  |\PosFecha*| & Posici√≥n $(x,y)$ de las fechas \\
%               & (el texto se despliega hacia arriba). \\
%  |\PosFirmas| & Posici√≥n $(x_o,x_f,y)$ de las firmas. \\
%  |\Proveedor| & Nombre de quien firma el reporte. \\
%  |\ptref| & Muestra al precio total del √≠tem referenciado. \\
%  |\puref| & Muestra al precio unitario del √≠tem referenciado. \\
%  |\RazonSocial| & Establece la raz√≥n social. \\
%  |\Resumen| & Resumen. \\
%  |\RIF| & R.I.F. del cliente. \\
%  |\SepNotaFinal| & Separaci√≥n interna entre el borde y el texto en la nota final. \\
%  |\SepDatosResumen| & Separaci√≥n horizontal entre los datos del cliente y el resumen. \\
%  |\SepDescripcion| & Separaci√≥n interna entre el borde y el texto en la descripci√≥n. \\
%  |\SepEncabezado| & Separaci√≥n interna entre el borde y el texto en el encabezado. \\
%  |\SepNotaPrevia| & Separaci√≥n interna entre el borde y el texto en la nota previa. \\
%  |\SepFilas| & Separaci√≥n horizontal y vertical en los totales en el modo de filas. \\
%  |\SepItemsExtra| & Separaci√≥n vertical extra entre los elementos en la factura. \\
%  |\SepVertical| & Separaci√≥n vertical entre los distintos elementos de la factura. \\
%  |\subtref| & Muestra al subtotal del √≠tem referenciado. \\
%  |\Telefono| & Tel√©fono del cliente. \\
%  |\TituloReporte| & Establece el t√≠tulo del reporte. \\
%  |\TituloReporte*| & Establece el t√≠tulo del reporte a salir en las cabeceras o pies de p√°gina. \\
% \end{tabular}
%
%
% \ifejemplos
%  \section{Ejemplos inclu√≠dos\label{sec:ejemplos}}
%  \todo*{Hay que hacer que en la documentaci√≥n, toda opci√≥n y macro referencie al ejemplo donde se usa.}
%
%  Desde la p√°gina siguiente se muestran todos los ejemplos inclu√≠dos en la clase:
%
%  \newpage
%  \newgeometry{marginparsep=0pt,vmargin={1cm,1cm},hmargin={1cm,1cm}}
%  {
%   \pagestyle{empty}
%   \setlength{\parindent}{0pt}
%   \hbadness=10000
%
%   \Ejemplo{ejemplo-cotizacion}
%   \Ejemplo{ejemplo-prefactura}
%   \newpage
%   \Ejemplo{ejemplo-factura01}
%   \Ejemplo{ejemplo-factura02}[\small\parskip=2pt]
%   \newpage
%   \Ejemplo{ejemplo-factura03}
%   \Ejemplo{ejemplo-factura04}
%   \newpage
%   \Ejemplo{ejemplo-factura05}
%   \Ejemplo{ejemplo-factura06}[\small]
%   \newpage
%   \Ejemplo[0.4]{ejemplo-factura07}[\small]
%   \Ejemplo{ejemplo-factura08}
%   \newpage
%   \Ejemplo*[0.49]{ejemplo-factura09}
%   \Ejemplo[0.49]{ejemplo-factura09}*{2}
%   \Ejemplo*{ejemplo-factura09}*
%   \newpage
%   \Ejemplo*[0.49]{ejemplo-factura10}
%   \Ejemplo[0.49]{ejemplo-factura10}*{2}
%   \Ejemplo*{ejemplo-factura10}*
%   \newpage
%   \Ejemplo*[0.49]{ejemplo-reporte1}
%   \Ejemplo[0.49]{ejemplo-reporte1}*{2}
%   \Ejemplo[0.49]{ejemplo-reporte1}{4}[\slshape Por espacio se omiti√≥ la p√°gina 2 en esta representaci√≥n.]
%   \newpage
%   \Ejemplo*[0.49]{ejemplo-reporte2}
%   \Ejemplo[0.49]{ejemplo-reporte2}*{2}
%   \Ejemplo[0.49]{ejemplo-reporte2}{3}
%   \newpage
%   \Ejemplo*[0.49]{ejemplo-reporte3}
%   \Ejemplo[0.49]{ejemplo-reporte3}*{2}
%   \Ejemplo[0.49]{ejemplo-reporte3}{3}
%   \newpage
%   \Ejemplo{beispiel-rechnung}
%   \newpage
%  }
%  \hbadness=1000
%  \restoregeometry
% \else
%  \message{^^JLaTeX Warning: Compilacio'n ra'pida. No se incluyeron los ejemplos.^^J}
% \fi
%
% \StopEventually{\endorgo}
%
%    \begin{macrocode}
%<*class>
\RequirePackage{etoolbox}%  'etoolbox' para los condicionales binarios y para \AtEndPreamble.

%% Condicionales auxiliares que s√≥lo pueden ser usados dentro de un grupo.
\newbool{DCU}
\newbool{DUC}
\newbool{Descuentos}
%% (quitado por no vigente)
 % \newbool{Electro}
\newbool{ExpAbajo}\booltrue{ExpAbajo}
\newbool{IVA}
\newbool{NumItem}
\newbool{PrimeroDescripcion}
\newbool{SinCantidad}
\newbool{SinLineaHoriNI}
\newbool{SinLineaHoriTit}
\newbool{SinLineaHoriTot}
\newbool{SinLineasHoriExt}
\newbool{SinLineasVertExt}
\newbool{SinLineasVertInt}
\newbool{Subtotal}

%% Condicionales auxiliares para la posici√≥n de los objetos fijos cuando son medidos desde la derecha, o desde abajo.
\newbool{NotaFinalYarriba}
\newbool{NotaFinalYnegativo}% no hay NotaFinalXnegativo.
\newbool{ControlXnegativo}
\newbool{ControlYarriba}
\newbool{ControlYnegativo}
\newbool{DenomXnegativo}
\newbool{DenomYarriba}
\newbool{DenomYnegativo}
\newbool{FechaXnegativo}
\newbool{FechaYarriba}
\newbool{FechaYnegativo}
\newbool{FirmasYnegativo}% no hay FirmasXnegativo; hay X_inicial y X_final para las firmas.

%% Condicionales relativos a opciones de la clase.
\newif\ifagrupado
\newif\ifcentradesc
\newif\ifcentrado
\newif\ifconlineasha
\newif\ifconreporte
\newif\ifcotizacion
\newif\ifcsv
\newif\ifdcu
\newif\ifdenom
\newif\ifdescuentos
\newif\ifdosfirmas
\newif\ifduc
%% (quitado por no vigente)
 % \newif\ifelectro
\newif\ifexpandecuadro
\newif\iffilas
\newif\ifG
\newif\ifimpdesc
\newif\ifiva
\newif\iflinea
\newif\ifnospanish
\newif\ifnumitem
\newif\ifprefactura
\newif\ifsincantidad
\newif\ifsinexpandir
\newif\ifsinfirmas
\newif\ifsiniva
\newif\ifsinivaexpresado
\newif\ifsinlineahni
\newif\ifsinlineahtit
\newif\ifsinlineahtot
\newif\ifsinlineash
\newif\ifsinlineashe
\newif\ifsinlineashi
\newif\ifsinlineasv
\newif\ifsinlineasve
\newif\ifsinlineasvi
\newif\ifsinmarcas
\newif\ifsinmonedatotales
\newif\ifsinnumero
\newif\ifsinreverso
\newif\ifsintotales
\newif\ifsoloreporte
\newif\ifsubtotal
\newif\iftodosiva
\newif\iftwoside
\newif\ifunafirma
\newif\ifvencimiento

%% Condicionales auxiliares.
\newif\if@cdu \@cdutrue
\newif\if@factura \@facturatrue
\newif\if@reverso \@reversotrue
\newif\if@reporte
\newif\if@FondoFactura
\newif\if@FondoReporte
\newif\if@FondoReporteStar
\newif\if@Nombre
\newif\if@PruebaRef
\newif\if@ExpandeCuadro
\newif\if@LineaDesdeInicio
\newif\if@LineaHastaTotal
\newif\if@LineaHastaFinal
\newif\if@LineaDescripcion
\newif\if@BIR
\newif\if@BIA
\newif\if@Exento
\newif\if@DescG
\newif\if@DescR
\newif\if@DescA
\newif\if@DescE
\newif\if@DescGnum
\newif\if@DescRnum
\newif\if@DescAnum
\newif\if@DescEnum
\newif\if@DescuentoTotal

%% Longitudes para uso interno.
\newlength{\@TamDatos}
\newlength{\@TamResumen}
\newlength{\@TamFinalEncabezado}
\newlength{\@TamLineaFirmas}
\newlength{\@TamNumItem}
\newlength{\@TamCantidad}
\newlength{\@TamDescripcion}
\newlength{\@TamPrecioU}
\newlength{\@TamPrecioS}
\newlength{\@TamDescuento}
\newlength{\@TamIVA}
\newlength{\@TamPrecioT}
\newlength{\@GrosorLineaFirmas}
\newlength{\@GrosorLineaEncabezado}
\newlength{\@GrosorLineaNotaPrevia}
\newlength{\@GrosorLineaDescripcion}
\newlength{\@GrosorLineaNotaFinal}
\newlength{\@GrosorLineaInfoPag}
\newlength{\@EsquinaLineaEncabezado}
\newlength{\@EsquinaLineaNotaPrevia}
\newlength{\@EsquinaLineaDescripcion}
\newlength{\@EsquinaLineaNotaFinal}
\newlength{\@SombraEncabezado}
\newlength{\@SombraNotaPrevia}
\newlength{\@SombraDescripcion}
\newlength{\@SombraNotaFinal}
\newlength{\@LineaNodoXo}
\newlength{\@LineaNodoYo}
\newlength{\@LineaNodoXf}
\newlength{\@LineaNodoYf}
\newlength{\@SepTotales}
\newlength{\@PosFechaX}
\newlength{\@PosFechaY}
\newlength{\@PosDenomX}
\newlength{\@PosDenomY}
\newlength{\@PosFirmasXuno}
\newlength{\@PosFirmasXdos}
\newlength{\@PosFirmasY}
\newlength{\@PosNotaFinalXuno}
\newlength{\@PosNotaFinalXdos}
\newlength{\@PosNotaFinalY}
\newlength{\@PosControlX}
\newlength{\@PosControlY}
\newlength{\@EspacioVacioInicial}
\newlength{\@EspacioVacioFinal}
\newlength{\@EspacioSignoMonetario}
\newlength{\@SeparaItemsExtra}
\newlength{\@SeparaItemsExtraFinal}
\newlength{\@SeparaInternaEncabezado}
\newlength{\@SeparaInternaNotaPrevia}
\newlength{\@SeparaInternaDescripcion}
\newlength{\@SeparaInternaNotaFinal}
\newlength{\@SeparaDatosResumen}
\newlength{\@SeparaVertical}
\newlength{\@SeparaMinTotales}
\newlength{\@SeparaFilas}
\newlength{\@SeparaFinLineaDesc}
\newlength{\@SeparaTelefonoEmail}
\newlength{\@InicioReporte}
\newlength{\@FirmaFacturaXcorr}
\newlength{\@FirmaFacturaYcorr}
\newlength{\@FirmaReporteXcorr}
\newlength{\@FirmaReporteYcorr}
\newlength{\@FirmaReporteTextPos}
\newlength{\@FirmaReporteFirmaPos}
\newlength{\@FirmaReporteTamLinea}
\newlength{\@FirmaReportePosX}
\newlength{\@FirmaReporteExcesoLinea}
\newlength{\@TempDimen}
\newlength{\tabcolsep@@}
\newlength{\baselineskip@@}

%% Cajas para uso interno.
\newbox{\@CajaDatos}
\newbox{\@CajaResumen}
\newbox{\@CajaFirmaEmisor}
\newbox{\@CajaFirmas}
\newbox{\@CajaFecha}
\newbox{\@CajaDenom}
\newbox{\@CajaControl}
\newbox{\@CajaNotaFinal}
\newbox{\@CajaEspacioVacio}
\newbox{\@CajaPrueba}
\newbox{\@CajaCaracterCR}

%% Contadores.
\newcounter{@IVANoGeneral}%  '0' con s√≥lo IVA G, '1' cuando hay IVA R o IVA A, y '2' cuando hay ambos.
\newcounter{@Firmas}%  '0' para sinfirmas, '1' para unafirma, y '2' para dosfirmas.
\setcounter{@Firmas}{2}
\newcounter{NumItem}%  N√∫mero del √≠tem actual, para uso de algunas macros en el cuadro de la factura y para cuando se usa la opci√≥n 'numitem'.
\newcount\AuxFecha

%% Errores, advertencias e informaciones de LaTeX.
\newcommand{\CLASSERROR}[1]{\ClassError{factura}{** #1. **}{}}
\newcommand{\CLASSWARNING}[1]{\ClassWarning{factura}{** #1. **}{}}
\newcommand{\CLASSINFO}[1]{\ClassInfo{factura}{** #1. **}{}}

%% Opciones de la clase.
\DeclareOption{agrupado}{\agrupadotrue}%  Agrupados los elementos totalizadores en el modo en columnas.
\DeclareOption{centradesc}{\centradesctrue}%  Para centrar la descripci√≥n de cada √≠tem.
\DeclareOption{centrado}{\centradotrue}%  Total y exento 'centrado'; s√≥lo para estilo 'filas'
\DeclareOption{conlineasha}{\conlineashatrue}%  Una l√≠nea horizontal para cada √≠tem, como las facturas a mano.
\DeclareOption{conreporte}{\conreportetrue}%  Para imprimir factura y reporte.
\DeclareOption{cotizacion}{\cotizaciontrue}%  Cambia la denominaci√≥n a 'COTIZACI√ìN' y no 'FACTURA'.
\DeclareOption{csv}{\csvtrue}%  Para la salida en modo csv tambi√©n.
\DeclareOption{dcu}{\dcutrue}%  Descripci√≥n, luego cantidad y luego precio unitario.
\DeclareOption{denom}{\denomtrue}%  Agrega el texto con la denominaci√≥n del documento, para las formas libres que no tienen el n√∫mero de factura.
\DeclareOption{descuentos}{\descuentostrue}%  Para los descuentos individuales.
\DeclareOption{dosfirmas}{\dosfirmastrue}%  Pone las dos firmas para firmar.
\DeclareOption{duc}{\ductrue}%  Descripci√≥n, luego precio unitario y luego cantidad.
\DeclareOption{electro}{\CLASSERROR{Ya no esta' vigente el descuento en la ali'cuota general por pagos electro'nicos}}%  Parche por el Decreto 3.085 de Nikol√°i, ya no vigente.
\DeclareOption{expandecuadro}{\expandecuadrotrue}%  Para rellenar con l√≠neas en blanco de manera autom√°tica.
\DeclareOption{filas}{\filastrue}%  Estilo de totalizaci√≥n en filas.
\DeclareOption{G}{\Gtrue}%  Con esta opci√≥n sale la letra 'G' en los items con IVA general, y sale el porcentaje en la base imponible general.
\DeclareOption{impdesc}{\impdesctrue}%  Para el tipo de impuesto en la descripci√≥n y no en el precio unitario y total.
\DeclareOption{iva}{\ivatrue}%  Para la columna del IVA.
\DeclareOption{linea}{\lineatrue}%  Para la l√≠nea que inutiliza el espacio en blanco.
\DeclareOption{nospanish}{\nospanishtrue}%  No carga babel en castellano ni la codificaci√≥n T1 de las letras.
\DeclareOption{numitem}{\numitemtrue}%  Para poner una columna extra al principio con el n√∫mero del √≠tem.
\DeclareOption{prefactura}{\prefacturatrue}%  La prefactura; con el dise√±o de la forma libre... para enviar por correo electr√≥nico, fax o imprimir preliminarmente.
\DeclareOption{sincantidad}{\sincantidadtrue}%  Para no poner el campo de la cantidad.
\DeclareOption{sinexpandir}{\sinexpandirtrue}%  No expande ninguna de las dos partes de la factura.
\DeclareOption{sinfirmas}{\sinfirmastrue}%  No agrega los espacios para firmar.
\DeclareOption{sinivaexpresado}{\sinivaexpresadotrue}%  Cuando no se cobra IVA y tampoco se quiere que aparezca la totalizaci√≥n del IVA.
\DeclareOption{siniva}{\sinivatrue}%  No cobra IVA.
\DeclareOption{sinlineahni}{\sinlineahnitrue}%  Estilo 'sinlineahni'.
\DeclareOption{sinlineahtot}{\sinlineahtottrue}%  Estilo 'sinlineahtot'.
\DeclareOption{sinlineahtit}{\sinlineahtittrue}%  Estilo 'sinlineahtit'.
\DeclareOption{sinlineashe}{\sinlineashetrue}%  Estilo 'sinlineashe'.
\DeclareOption{sinlineashi}{\sinlineashitrue}%  Estilo 'sinlineashi'.
\DeclareOption{sinlineash}{\sinlineashtrue}%  Estilo 'sinlineash'.
\DeclareOption{sinlineasve}{\sinlineasvetrue}%  Estilo 'sinlineasve'.
\DeclareOption{sinlineasvi}{\sinlineasvitrue}%  Estilo 'sinlineasvi'.
\DeclareOption{sinlineasv}{\sinlineasvtrue}%  Estilo 'sinlineasv'.
\DeclareOption{sinmarcas}{\sinmarcastrue}%  Para evitar que aparezcan los caracteres especiales cuando la descripci√≥n es larga.
\DeclareOption{sinmonedatotales}{\sinmonedatotalestrue}%  Para que no ponga el signo monetario en los totales.
\DeclareOption{sinnumero}{\sinnumerotrue}%  Escribir el texto de la denominaci√≥n del documento pero sin escribir el n√∫mero.
\DeclareOption{sinreverso}{\sinreversotrue}%  Para no imprimir el reverso de la factura.
\DeclareOption{sintotales}{\sintotalestrue}%  No escribe los totales al final, por ejemplo para cotizaciones de productos similares.
\DeclareOption{soloreporte}{\soloreportetrue}%  Para imprimir s√≥lo el reporte.
\DeclareOption{subtotal}{\subtotaltrue}%  Para la columna extra del subtotal antes del descuento.
\DeclareOption{todosiva}{\todosivatrue}%  Con esta opci√≥n salen todos los IVA as√≠ valgan cero.
\DeclareOption{twoside}{\twosidetrue}%  Opci√≥n 'twoside' de article para los reportes.
\DeclareOption{unafirma}{\unafirmatrue}%  No agrega el espacio para que firme quien recibe.
\DeclareOption{vencimiento}{\vencimientotrue}%  Escribe fecha de vencimiento, a√∫n con facturas sin cr√©dito.

\ProcessOptions\relax

\LoadClass[12pt]{article}

%% Cargamos algunos paquetes siempre necesarios.
\RequirePackage{xparse}%  Algunos comandos los definimos con \NewDocumentCommand.
\RequirePackage[absolute]{textpos}%  Es necesario 'textpos' para colocar texto en ubicaciones arbitrarias.
\RequirePackage{eso-pic}%  Para el comando \AddToShipoutPicture.
\RequirePackage{xstring}%  Lo usamos s√≥lo para tomar el menos al principio de una longitud.
\RequirePackage{calc}%  'calc' para hacer aritm√©tica con las dimensiones.
\RequirePackage{fp-upn}%  Fundamental el paquete 'fp-upn' para todos los c√°lculos.
\RequirePackage{numprint}%  Con 'numprint' expresamos los totales en el formato requerido.
\RequirePackage{tikz}%  Para los recuadros del encabezado de la factura,
 \usetikzlibrary{shadows}%  y para el de la descripci√≥n.
\RequirePackage{tabularx}%  Con 'tabularx' hacemos la tabla.
\RequirePackage{environ}%  Con 'environ' podemos usar tabularx dentro del ambiente de la factura y escribir texto en el enddef.
\RequirePackage{fancyhdr}%  Las cabeceras fancy; as√≠ se use solamente en reporte, hay que cargarlo siempre.
\RequirePackage[calc]{datetime2}%  Para calcular la fecha del vencimiento del cr√©dito.
\RequirePackage{anyfontsize}%  Para las tipograf√≠as en tama√±os arbitrarios.
\RequirePackage{ifxetex}%  Para poder modificar correctamente la metadata del PDF y agregar la versi√≥n de la clase.
\RequirePackage{ifluatex}%  Ditto.
\RequirePackage{zref-savepos}[2016/05/21]%  Para guardar la posici√≥n en 'Y' expandiendo el cuadro, para la l√≠nea y para la firma en el reporte si la hubiera.
%% Hay que cargar siempre zref-savepos para poder compilar con LuaLaTeX porque este motor no tiene \pdfsavepos, \pdflastypos y zref-savepos las provee cuando no existen (motor LuaLaTex).

%% Gracias a Alan Munn y a wipet (Thanks to Alan Munn and wipet).
%% (https://tex.stackexchange.com/questions/396363/input-a-date-to-datetime2-in-a-format-different-than-iso)
\def\DTMsavedatex#1#2{%
 \expandafter \ifx \csname f=\DTMinformat\endcsname \relax
  \CLASSERROR{\string\DTMsavedatex: formato "\DTMinformat" desconocido}%
 \else
  \csname f=\DTMinformat\expandafter\endcsname#2&{#1}%
 \fi
}
\def\DTMfdef#1{\expandafter\def\csname f=#1\endcsname}
\def\DTMs#1#2{\DTMsavedate{#2}{#1}}
\DTMfdef{yyyy-mm-dd}#1-#2-#3&{\DTMs{#1-#2-#3}}
\DTMfdef{yyyy.mm.dd}#1.#2.#3&{\DTMs{#1-#2-#3}}
\DTMfdef{yyyymmdd}#1#2#3#4#5#6#7#8&{\DTMs{#1#2#3#4-#5#6-#7#8}}
\DTMfdef{dd-mm-yyyy}#1-#2-#3&{\DTMs{#3-#2-#1}}
\DTMfdef{dd.mm.yyyy}#1.#2.#3&{\DTMs{#3-#2-#1}}
\DTMfdef{ddmmyyyy}#1#2#3#4#5#6#7#8&{\DTMs{#5#6#7#8-#3#4-#1#2}}
\DTMfdef{mm-dd-yyyy}#1-#2-#3&{\DTMs{#3-#1-#2}}

%% Macros internas para el texto de la metadata que se va a escribir con el n√∫mero de la versi√≥n de la clase.
\edef\@factura@ver{\expandafter\csname ver@factura.cls\endcsname}
\ExplSyntaxOn
  \seq_set_split:NnV \l_tmpa_seq {~} {\@factura@ver}
  \tl_set:Nx \@factura@vernum {\seq_item:Nn \l_tmpa_seq {2}}

  \seq_set_split:NnV \l_tmpa_seq {~} {\@factura@ver}
  \tl_set:Nx \@factura@fecha {\seq_item:Nn \l_tmpa_seq {1}}
\ExplSyntaxOff
\def\@factura@ver{Hecho con la clase factura-\@factura@vernum\ (\@factura@fecha)}

%% Escribimos la versi√≥n de la clase en la metadata del PDF.
\ifxetex
 \special{pdf: docinfo << /Subject (\@factura@ver) >>}
\else
 \ifluatex
  \pdfextension info{/Subject (\@factura@ver)}
 \else
  \pdfinfo{/Subject (\@factura@ver)}
 \fi
\fi

\def\@EstableceOpciones{%
 % Establecemos los par√°metros y macros relativas a la fecha.
 \DTMsetstyle{\@FormatoFecha}\DTMsetup{datesep=\@FechaSeparadores}\gdef\DTMinformat{\@FormatoFechaEntrada}
 
 % Tomamos las acciones pertinentes dependiendo de las opciones de la clase (o condicionales activados en el pre√°mbulo que cambian las opciones de la clase)
 \ifprefactura
  \ifcotizacion
   \prefacturafalse
   \cotizacionfalse
   \CLASSWARNING{Las opciones 'prefactura' y 'cotizacion' no son compatibles. Sin efecto ambas opciones}
  \else
   \denomtrue\setcounter{@Firmas}{0}
  \fi
 \fi
 \ifcotizacion\denomtrue\setcounter{@Firmas}{1}\fi

 \ifsinlineasv\booltrue{SinLineasVertExt}\booltrue{SinLineasVertInt}\fi
 \ifsinlineasvi\booltrue{SinLineasVertInt}\fi
 \ifsinlineasve\booltrue{SinLineasVertExt}\fi
 \ifsinlineash\booltrue{SinLineasHoriExt}\booltrue{SinLineaHoriNI}\booltrue{SinLineaHoriTit}\booltrue{SinLineaHoriTot}\fi
 \ifsinlineashi\booltrue{SinLineaHoriNI}\booltrue{SinLineaHoriTit}\booltrue{SinLineaHoriTot}\fi
 \ifsinlineahni\booltrue{SinLineaHoriNI}\fi
 \ifsinlineahtit\booltrue{SinLineaHoriTit}\fi
 \ifsinlineahtot
  \iffilas
   \CLASSWARNING{Las opciones 'sinlineahtot' y 'filas' no son compatibles. Sin efecto opcio'n 'sinlineahtot'}
   \sinlineahtotfalse
  \else
   \booltrue{SinLineaHoriTot}
  \fi
 \fi
 \ifsinlineashe\booltrue{SinLineasHoriExt}\fi

 \ifdosfirmas
  \setcounter{@Firmas}{2}
  \ifunafirma
   \unafirmafalse
   \ifsinfirmas
    \sinfirmasfalse
    \CLASSWARNING{Las opciones para las firmas son excluyentes. Permanece activada 'dosfirmas'}
   \else
    \CLASSWARNING{Las opciones para las firmas son excluyentes. Permanece activada 'dosfirmas'}
   \fi
  \else
   \ifsinfirmas
    \sinfirmasfalse
    \CLASSWARNING{Las opciones para las firmas son excluyentes. Permanece activada 'dosfirmas'}
   \fi
  \fi
 \fi
 \ifunafirma
  \setcounter{@Firmas}{1}
  \ifsinfirmas
   \sinfirmasfalse
   \CLASSWARNING{Las opciones para las firmas son excluyentes. Permanece activada 'unafirma'}
  \fi
 \fi
 \ifsinfirmas\setcounter{@Firmas}{0}\fi 
 
 \ifdcu
  \@cdufalse\ducfalse
  \booltrue{DCU}\boolfalse{DUC}
  \booltrue{PrimeroDescripcion}
 \fi
 \ifduc
  \ifdcu
   \boolfalse{PrimeroDescripcion}\boolfalse{DCU}\dcufalse\ducfalse\@cdutrue
   \CLASSWARNING{Las opciones 'duc' y 'dcu' no son compatibles. Sin efecto ambas opciones}
  \else
   \ductrue\@cdufalse\dcufalse
   \booltrue{DUC}\boolfalse{DCU}
   \booltrue{PrimeroDescripcion}
  \fi
 \fi
 \ifnumitem\booltrue{NumItem}\fi
 \ifsincantidad
  \booltrue{SinCantidad}
  \ifdcu
   \dcufalse\@cdutrue\boolfalse{DCU}\boolfalse{PrimeroDescripcion}
   \CLASSWARNING{La opcio'n 'sincantidad' no es compatible con 'dcu'. Sin efecto opcio'n 'dcu'}
  \fi
  \ifduc
   \ducfalse\@cdutrue\boolfalse{DUC}\boolfalse{PrimeroDescripcion}
   \CLASSWARNING{La opcio'n 'sincantidad' no es compatible con 'duc'. Sin efecto opcio'n 'duc'}
  \fi
 \fi
 \ifdescuentos\booltrue{Descuentos}\fi
 \ifiva\impdesctrue\booltrue{IVA}\fi
 \ifsubtotal
  \ifdescuentos
   \booltrue{Subtotal}
  \else
   \CLASSWARNING{La opcio'n 'subtotal' no aplica sin descuentos individuales. Sin efecto opcio'n 'subtotal'}
  \fi
 \fi

 \ifsinnumero\denomtrue\fi
 \ifsintotales
  \iffilas
   \filasfalse
   \CLASSWARNING{La opcio'n 'sintotales' no aplica para el modo de totalizacio'n en filas. Sin efecto opcio'n 'filas'}
  \fi
  \ifcotizacion
  \else
   \CLASSWARNING{La opcio'n 'sintotales' no debe usarse en facturas sino en cotizaciones. No es va'lida una factura sin totales}
  \fi
 \fi

 \ifcentrado
  \iffilas
  \else
   \centradofalse
   \CLASSWARNING{La opcio'n 'centrado' no es compatible con el modo de totalizacio'n en columnas. Sin efecto opcio'n 'centrado'}
  \fi
 \fi
 \ifagrupado
  \iffilas
   \agrupadofalse
   \CLASSWARNING{La opcio'n 'agrupado' no es compatible con el modo de totalizacio'n en filas. Sin efecto opcio'n 'agrupado'}
  \fi
 \fi

%% (quitado por no vigente)
 % \ifelectro
 %  \boolfalse{Electro}
 %  \electrofalse
 %  \gdef\@NotaInterna{\@TextoDescuentoPresidencial}
 %  \CLASSWARNING{Se establecio' el texto aclaratorio del descuento presidencial como 'nota interna'}
 %  \iffilas
 %   \filasfalse
 %   \CLASSWARNING{La opcio'n 'electro' no es compatible con la opcio'n 'filas'. Sin efecto la opcio'n 'filas'}
 %  \fi
 % \fi

 \iftodosiva \@BIRtrue \@BIAtrue \@Exentotrue \Gtrue \fi
 \ifsiniva\AtBeginDocument{\gdef\@ImpuestoG{0}\gdef\@ImpuestoR{0}\gdef\@ImpuestoA{0}}\fi
 \ifsinivaexpresado
  \iffilas
   \filasfalse
   \CLASSWARNING{La opcio'n 'sinivaexpresado' no es compatible con la opcio'n 'filas'. Sin efecto la opcio'n 'filas'}
  \else
   \AtBeginDocument{\gdef\@ImpuestoG{0}\gdef\@ImpuestoR{0}\gdef\@ImpuestoA{0}}
  \fi
 \fi

 \iflinea
  \ifexpandecuadro
  \else
   \CLASSWARNING{La opcio'n 'linea' requiere la opcio'n 'expandecuadro'. Activando la opcio'n 'expandecuadro'}
   \expandecuadrotrue
  \fi
 \fi
 \ifsinmarcas \def\@CaracterCR{\mbox{}} \def\@CaracterCeldasVacias{\mbox{}} \fi
 \ifnospanish
 \else
  \RequirePackage[spanish]{babel}%  Babel en castellano.
  \ifxetex
  \else
   \ifluatex
   \else
    \RequirePackage[T1]{fontenc}%  Codificaci√≥n T1 para las tipograf√≠as; no aplica para XeLaTeX ni LuaLaTeX.
   \fi
  \fi
 \fi

 \ifexpandecuadro
  \ifsinexpandir
   \expandecuadrofalse
   \sinexpandirfalse
   \CLASSWARNING{Las opciones 'expandecuadro' y 'sinexpandir' no son compatibles. Sin efecto ambas opciones}
  \else
   \boolfalse{ExpAbajo}
  \fi
 \fi
 \ifsinexpandir\boolfalse{ExpAbajo}\expandecuadrofalse\fi

 \ifsinreverso\@reversofalse\fi
 \ifconreporte
  \@reportetrue
  \ifsoloreporte
   \soloreportefalse
   \CLASSWARNING{La opcio'n 'soloreporte' no es compatible con 'conreporte'. Sin efecto 'soloreporte'}
  \fi
 \fi
 \ifsoloreporte\@reportetrue\@facturafalse\@reversofalse\fi

 \ifcsv
  \if@factura
   \newwrite\csv \immediate\openout\csv=\jobname.csv
   \ifsintotales\else\AtEndDocument{\@EscribeTotalesEnCSV}\fi
  \else
   \csvfalse
   \CLASSWARNING{La opcio'n 'csv' require generar la factura. Sin efecto opcio'n 'csv'}
  \fi
 \fi
 
 \iftwoside
  \@twosidetrue\@mparswitchtrue
 \else
  \@twosidefalse\@mparswitchfalse
 \fi}
 
\NewDocumentCommand{\BeforeEndPreamble}{s s +m}{
 \IfBooleanTF{#2}
  {\gpreto{\@BeforeEndPreamble}{#3}}
  {\IfBooleanTF{#1}{\long\gdef\@BeforeEndPreamble{#3}}{\gappto{\@BeforeEndPreamble}{#3}}}}

\AtEndPreamble{
 \@EstableceOpciones
 \ifx\@undefined\@BeforeEndPreamble\else\@BeforeEndPreamble\@EstableceOpciones\fi

 % Escribimos en el .log las opciones cargadas:
 \ifagrupado \CLASSINFO{Opcio'n cargada: agrupado}\fi
 \ifcentradesc \CLASSINFO{Opcio'n cargada: centradesc}\fi
 \ifcentrado \CLASSINFO{Opcio'n cargada: centrado}\fi
 \ifconlineasha \CLASSINFO{Opcio'n cargada: conlineasha}\fi
 \ifconreporte \CLASSINFO{Opcio'n cargada: conreporte}\fi
 \ifcotizacion \CLASSINFO{Opcio'n cargada: cotizacion}\fi
 \ifcsv \CLASSINFO{Opcio'n cargada: csv}\fi
 \ifdcu \CLASSINFO{Opcio'n cargada: dcu}\fi
 \ifdenom \CLASSINFO{Opcio'n cargada: denom}\fi
 \ifdescuentos \CLASSINFO{Opcio'n cargada: descuentos}\fi
 \ifdosfirmas \CLASSINFO{Opcio'n cargada: dosfirmas}\fi
 \ifduc \CLASSINFO{Opcio'n cargada: duc}\fi
 %% (quitado por no vigente)
 % \ifelectro \CLASSINFO{Opcio'n cargada: electro}\fi
 \ifexpandecuadro \CLASSINFO{Opcio'n cargada: expandecuadro}\fi
 \iffilas \CLASSINFO{Opcio'n cargada: filas}\fi
 \ifG \CLASSINFO{Opcio'n cargada: G}\fi
 \ifimpdesc \CLASSINFO{Opcio'n cargada: impdesc}\fi
 \ifiva \CLASSINFO{Opcio'n cargada: iva}\fi
 \iflinea \CLASSINFO{Opcio'n cargada: linea}\fi
 \ifnospanish \CLASSINFO{Opcio'n cargada: nospanish}\fi
 \ifnumitem \CLASSINFO{Opcio'n cargada: numitem}\fi
 \ifprefactura \CLASSINFO{Opcio'n cargada: prefactura}\fi
 \ifsincantidad \CLASSINFO{Opcio'n cargada: sincantidad}\fi
 \ifsinexpandir \CLASSINFO{Opcio'n cargada: sinexpandir}\fi
 \ifsinfirmas \CLASSINFO{Opcio'n cargada: sinfirmas}\fi
 \ifsiniva \CLASSINFO{Opcio'n cargada: siniva}\fi
 \ifsinivaexpresado \CLASSINFO{Opcio'n cargada: sinivaexpresado}\fi
 \ifsinlineahni \CLASSINFO{Opcio'n cargada: sinlineahni}\fi
 \ifsinlineahtit \CLASSINFO{Opcio'n cargada: sinlineahtit}\fi
 \ifsinlineahtot \CLASSINFO{Opcio'n cargada: sinlineahtot}\fi
 \ifsinlineash \CLASSINFO{Opcio'n cargada: sinlineash}\fi
 \ifsinlineashe \CLASSINFO{Opcio'n cargada: sinlineashe}\fi
 \ifsinlineashi \CLASSINFO{Opcio'n cargada: sinlineashi}\fi
 \ifsinlineasv \CLASSINFO{Opcio'n cargada: sinlineasv}\fi
 \ifsinlineasve \CLASSINFO{Opcio'n cargada: sinlineasve}\fi
 \ifsinlineasvi \CLASSINFO{Opcio'n cargada: sinlineasvi}\fi
 \ifsinmarcas \CLASSINFO{Opcio'n cargada: sinmarcas}\fi
 \ifsinmonedatotales \CLASSINFO{Opcio'n cargada: sinmonedatotales}\fi
 \ifsinnumero \CLASSINFO{Opcio'n cargada: sinnumero}\fi
 \ifsinreverso \CLASSINFO{Opcio'n cargada: sinreverso}\fi
 \ifsintotales \CLASSINFO{Opcio'n cargada: sintotales}\fi
 \ifsoloreporte \CLASSINFO{Opcio'n cargada: soloreporte}\fi
 \ifsubtotal \CLASSINFO{Opcio'n cargada: subtotal}\fi
 \iftodosiva \CLASSINFO{Opcio'n cargada: todosiva}\fi
 \iftwoside \CLASSINFO{Opcio'n cargada: twoside}\fi
 \ifunafirma \CLASSINFO{Opcio'n cargada: unafirma}\fi
 \ifvencimiento \CLASSINFO{Opcio'n cargada: vencimiento}\fi

 % Cargamos aqu√≠ 'geometry' para que sea despu√©s de haber establecido 'twoside'.
 \RequirePackage{geometry}}

%% Escribimos el total como comentario en el .log.
\AtEndDocument{%
 \ifsintotales
 \else
  \if@factura\CLASSINFO{\@@Total: \space\space\space \Moneda \Total}\fi
 \fi}

%</class>
%<*class|def>
%% La geometr√≠a para la factura, su reverso, y el reporte.
%% Para la factura, el margen superior est√° definido desde el encabezado con los datos del cliente;
%%  el margen inferior est√° definido hasta el final de la descripci√≥n (o del cuadro de la factura si no hay descripci√≥n).
%%  Hay elementos que salen fuera de estos m√°rgenes, como las firmas, la nota final, la numeraci√≥n y la fecha.
%<class>\def\GeometriaFactura#1{\gdef\@GeometriaFactura{#1}}
%<class>\def\GeometriaReverso#1{\gdef\@GeometriaReverso{#1}}
%<class>\def\GeometriaReporte#1{\gdef\@GeometriaReporte{#1}}
%<def>\GeometriaFactura{letterpaper,vmargin={5.2cm,5.5cm},hmargin={1cm,1cm},footskip=0pt,  headsep=0pt,    headheight=0pt}
%<def>\GeometriaReverso{letterpaper,vmargin={1cm,1cm},    hmargin={1cm,1cm},footskip=0cm,  headsep=0pt,    headheight=0pt}
%<def>\GeometriaReporte{letterpaper,vmargin={2.8cm,2.5cm},hmargin={3cm,2cm},footskip=1.2cm,headsep=0.777cm,headheight=1.5cm}

%<class>%% Se utiliza '\@Impuesto' como el factor del impuesto, el cual viene predefinido en '\@Alicuota'.
%<class>\def\@ImpuestoG{\@AlicuotaG}
%<class>\def\@ImpuestoR{\@AlicuotaR}
%<class>\def\@ImpuestoA{\@AlicuotaA}
%<def>%% Factores para los distintos IVA:
%<def>\def\@AlicuotaG{0.16}
%<def>%% (quitado por no vigente)
%<def> % \def\@AlicuotaGDescBajo{0.03}
%<def> % \def\@AlicuotaGDescAlto{0.05}
%<def> % \def\@AlicuotaGDescLimite{2000000}
%<def>\def\@AlicuotaR{0.08}
%<def>\def\@AlicuotaA{0.27}
%<def>
%</class|def>
%<*def>
%% i) separador de miles, ii) separador decimal, iii) n√∫mero de decimales para la moneda iv) y para los porcentajes, v) n√∫mero de d√≠gitos de la numeraci√≥n de la factura, vi) formato de la fecha, vii) separadores para la fecha.
\npthousandsep{.}
\npdecimalsign{,}
\def\@DigitosMoneda{2}
\def\@DigitosPorc{2}
\def\@DigitosNumeracion{5}
\def\@FormatoFecha{ddmmyyyy}
\def\@FormatoFechaEntrada{dd-mm-yyyy}
\def\@FechaSeparadores{-}

%% La moneda:
\def\@Moneda{Bs.}
%% (quitado por no vigente)
 % \def\@MonedaBs{Bs.}
 % \def\@MonedaBsS{Bs.S}
 % \def\@MonedaBsF{Bs.F}
\setlength\@EspacioSignoMonetario{.666ex}

%% (quitado por no vigente)
%% Las fechas de la entrada de la reconversi√≥n monetaria:
 % \DTMsavedate{FechaBsS}{2018-08-20}
 % \DTMsavedate{FechaBs}{2019-02-15}

%% Al lado de cada √≠tem va la letra que designa el gravamen que aplica sobre √©l:
\def\@DenomAlicuotaG{G}
\def\@DenomAlicuotaR{R}
\def\@DenomAlicuotaA{A}
\def\@DenomAlicuotaE{(E)}

%% (quitado por no vigente)
%% Texto predeterminado para la nota interna por el descuento presidencial.
 % \def\@TextoDescuentoPresidencial{Se aplica un descuento del \@AlicuotaGDescPorc\% al IVA General seg\'un Decreto Presidencial 3.085 en Gaceta Oficial 41.239.}

%% Macros que guardan textos que corresponden a nombres de campos:
\def\@@Fecha{Fecha de emisi\'on:}
\def\@@FechaVencimiento{Fecha de vencimiento:}
\def\@@Control{N\textordmasculine\space CONTROL}
\def\@@Datos{Datos del cliente}
\def\@@Resumen{Resumen del servicio}
\def\@@DenomFactura{FACTURA}
\def\@@DenomCotiza{COTIZACI\'ON}
\def\@@RazonSocial{Raz\'on social:}
\def\@@Nombre{Nombre:}
\def\@@RIF{R.I.F.:}
\def\@@CI{C.I.:}
\def\@@Direccion{Direcci\'on fiscal:}
\def\@@Telefono{Tel\'efono:}
\def\@@Email{E-mail:}
\def\@@Contacto{Persona de contacto:}
\def\@@Proveedor{Proveedor:}
\def\@@Cliente{Cliente:}
\def\@@Emisor{Por el emisor}
\def\@@Conforme{Recib\'i conforme}
\def\@@Pagado{PAGADO}
\def\@@NumItem{\#}
\def\@@Cantidad{Cantidad}
\def\@@Descripcion{Descripci\'on}
\def\@@Precio{Precio}
\def\@@PrecioU{Precio U.}
\def\@@PrecioS{Subtotal}
\def\@@Descuento{Dcto.}
\def\@@IVA{IVA}
\def\@@PrecioT{Precio T.}
\def\@@AlicuotaG{IVA G}
%% (quitado por no vigente)
 % \def\@@AlicuotaGDesc{Descuento IVA G}
\def\@@AlicuotaR{IVA R}
\def\@@AlicuotaA{IVA A}
\def\@@BIG{BI G}
\def\@@BIR{BI R}
\def\@@BIA{BI A}
\def\@@BIE{Exento}% La base imponible exenta. ;)
\def\@@Total{TOTAL}
\def\@@DescuentoG{Descuento G}
\def\@@DescuentoR{Descuento R}
\def\@@DescuentoA{Descuento A}
\def\@@DescuentoE{Descuento E}
\def\@@SubtotalG{Subtotal G}
\def\@@SubtotalR{Subtotal R}
\def\@@SubtotalA{Subtotal A}
\def\@@SubtotalE{Subtotal E}

%% i) car√°cter para separar el tel√©fono del e-mail del cliente,
%% ii) car√°cter para los campos vac√≠os cuando se usa \ItemX,
%% iii) car√°cter para las celdas vac√≠as cuando la descripci√≥n del √≠tem ocupa m√°s que una l√≠nea.
%% iv) car√°cter de retorno de carro en el cuadro de la factura,
\def\@CaracterSeparaTelefonoEmail{$\diamond$}
\def\@CaracterItemXVacio{...}
\def\@CaracterCeldasVacias{\mbox{}\hfill$\cdot$\hfill\mbox{}}
\def\@CaracterCR{\flechaCR}
% \def\@CaracterCR{$\hookleftarrow$}
% \def\@CaracterCR{$\cwrightarcarrow$}% Usando el paquete 'fnsymbol'.
% \def\@CaracterCR{$\cwsearcarrow$}% Usando el paquete 'fnsymbol'.
\def\flechaCR{%
 \raisebox{-0.4ex}{%
  \begin{tikzpicture}
   \draw[line width=0.075ex] (0,0) arc (20:70:0.75ex) + (0,0) arc (-70:-20:0.75ex) ++ (0.8ex,0.55ex) arc (0:-100:1ex);
  \end{tikzpicture}}}

%% Separaci√≥n entre el inicio de una columna en la tabla y el inicio del texto.
\tabcolsep=0.15cm

%% Separaci√≥n entre la √∫ltima letra y el car√°cter que indica que se contin√∫a en la l√≠nea siguiente en la descripci√≥n cuando ocupa m√°s de una l√≠nea.
\setlength{\@SeparaFinLineaDesc}{0.15cm}

%% Separaci√≥n entre el tel√©fono y el car√°cter \@CaracterSeparaTelefonoEmail, y luego desde ese car√°cter hasta el email,
%% para cuando no hay resumen.
\setlength{\@SeparaTelefonoEmail}{0.666em}

%% Grosor de la l√≠nea de 'fancyhdr' para las cabeceras, en aquellas donde haya l√≠nea.
\setlength{\@GrosorLineaInfoPag}{0.4pt}

%% Posici√≥n en X desde la derecha y excedente en la l√≠nea de la firma.
\setlength{\@FirmaReportePosX}{2cm}
\setlength{\@FirmaReporteExcesoLinea}{1.5cm}
%</def>
%<class|def>
%<*class>
%% Fijamos en cero los descuentos totales (necesario).
\def\@DescuentoGporc{0}
\def\@DescuentoRporc{0}
\def\@DescuentoAporc{0}
\def\@DescuentoEporc{0}
\def\@DescuentoGnum{0}
\def\@DescuentoRnum{0}
\def\@DescuentoAnum{0}
\def\@DescuentoEnum{0}
\FPset\PrecioUtempx{1}

%% \Fecha, \FormatoFecha, \Credito, \Moneda, \RazonSocial, \Nombre, \RIF, \CI, \Contacto, \Direcci√≥n, \Telefono, \Email, \Conforme, \Emisor, \Proveedor.
\NewDocumentCommand{\Fecha}{s m g g}{%
 \IfBooleanTF{#1}
  {\AtEndPreamble{\DTMsavedate{FechaEmision}{#2-#3-#4}}}
  {\AtEndPreamble{\DTMsavedatex{FechaEmision}{#2}}}}
\def\@Fecha{\DTMusedate{FechaEmision}}

\NewDocumentCommand{\FormatoFecha}{o g g}{%
 \IfValueT{#1}{\gdef\@FormatoFechaEntrada{#1}}\IfValueT{#2}{\gdef\@FormatoFecha{#2}}\IfValueT{#3}{\gdef\@FechaSeparadores{#3}}}

\def\Credito#1{\gdef\@Credito{#1}\vencimientotrue}
\def\Moneda#1{\gdef\@Moneda{#1}}
\def\RazonSocial#1{\gdef\@RazonSocial{#1}}
\def\Nombre#1{\gdef\@RazonSocial{#1}\@Nombretrue}
\def\RIF#1{\gdef\@RIF{#1}}
\def\CI#1{\gdef\@RIF{#1}\let\@@RIF\@@CI\let\@CI\@RIF}
\def\Contacto#1{\gdef\@Contacto{#1}}
\def\Direccion#1{\gdef\@Direccion{#1}}
\def\Telefono#1{\gdef\@Telefono{#1}}
\def\Email#1{\gdef\@Email{#1}}
\def\Conforme#1{\gdef\@Conforme{#1}}
\def\Emisor#1{\gdef\@Emisor{#1}}
\def\Proveedor#1{\gdef\@Proveedor{#1}}

%% Los descuentos totales.
\NewDocumentCommand{\Descuento}{s m}{%
 \IfBooleanTF{#1}
  {\@DescGnumtrue\@DescRnumtrue\@DescAnumtrue\@DescEnumtrue
  \gdef\@DescuentoGnum{#2}\gdef\@DescuentoRnum{#2}\gdef\@DescuentoAnum{#2}\gdef\@DescuentoEnum{#2}}
  {\@DescGnumfalse\@DescRnumfalse\@DescAnumfalse\@DescEnumfalse
  \gdef\@DescuentoGporc{#2}\gdef\@DescuentoRporc{#2}\gdef\@DescuentoAporc{#2}\gdef\@DescuentoEporc{#2}}%
 \@DescGtrue\@DescRtrue\@DescAtrue\@DescEtrue\@DescuentoTotaltrue}

\NewDocumentCommand{\DescuentoG}{s m}{%
 \IfBooleanTF{#1}{\@DescGnumtrue\gdef\@DescuentoGnum{#2}}{\@DescGnumfalse\gdef\@DescuentoGporc{#2}}%
 \@DescGtrue\@DescuentoTotaltrue}

\NewDocumentCommand{\DescuentoR}{s m}{%
 \IfBooleanTF{#1}{\@DescRnumtrue\gdef\@DescuentoRnum{#2}}{\@DescRnumfalse\gdef\@DescuentoRporc{#2}}%
 \@DescRtrue\@DescuentoTotaltrue}

\NewDocumentCommand{\DescuentoA}{s m}{%
 \IfBooleanTF{#1}{\@DescAnumtrue\gdef\@DescuentoAnum{#2}}{\@DescAnumfalse\gdef\@DescuentoAporc{#2}}%
 \@DescAtrue\@DescuentoTotaltrue}

\NewDocumentCommand{\DescuentoE}{s m}{%
 \IfBooleanTF{#1}{\@DescEnumtrue\gdef\@DescuentoEnum{#2}}{\@DescEnumfalse\gdef\@DescuentoEporc{#2}}%
 \@DescEtrue\@DescuentoTotaltrue}

\def\Denom#1{\gdef\@Denominacion{#1}}%  La denominaci√≥n puede ser 'FACTURA', 'COTIZACI√ìN' u otra. Se predetermina una de estas dos seg√∫n las opciones de la clase.

%% N√∫mero de la factura con \Num, n√∫mero de control con \NumControl, y n√∫mero de serie de control \NumSerieControl.
\def\Num#1{\gdef\@Num{\nplpadding{\@DigitosNumeracion}\npthousandsep{}\numprint{#1}}}
\def\NumControl#1{\gdef\@NumControl{\nplpadding{\@DigitosNumeracion}\npthousandsep{}\numprint{#1}}}%  Si el n√∫mero de control no se especifica, toma el mismo que el de la factura
\def\NumSerieControl#1{\gdef\@NumSerieControl{#1}}%  Si el n√∫mero de serie de control no se especifica, toma '00'.

%% Informaci√≥n de p√°gina: cabeceras de p√°ginas o pies de p√°gina.
\def\InfoPagina#1{\gdef\@InfoPagina{#1}}

%% Texto para la nota final.
\NewDocumentCommand{\NotaFinal}{+m}{\gdef\@NotaFinal{#1}}
\NewDocumentCommand{\Condiciones}{+m}{\gdef\@NotaFinal{#1}\@ClassWarningCondiciones}

%% Advertencia para la migraci√≥n de cualquier comando para condiciones a nota final.
\def\@ClassWarningCondiciones{\CLASSWARNING{Ya no son condiciones sino nota final, debe hacerse la migraci√≥n a los nuevos comandos}}

%% Resumen opcional que va a la derecha de los datos del cliente.
\NewDocumentCommand{\Resumen}{+m}{\gdef\@Resumen{#1}}

\NewDocumentCommand{\NotaPrevia}{+m}{\gdef\@NotaPrevia{#1}}

%% Nota interna al cuadro de la factura y nota externa a √©l (que sale antes de \Descripcion).
\NewDocumentCommand{\NotaInterna}{+m}{%
 \ifdefvoid{\@NotaInterna}{}{\CLASSWARNING{Se sobreescribio' la nota interna previamente definida}}%
 \gdef\@NotaInterna{#1}}
\NewDocumentCommand{\NotaExterna}{+m}{\gdef\@NotaExterna{#1}}

\AtBeginDocument{%
 % Si no se especific√≥ fecha, tomamos la de hoy. Adem√°s, advertimos cuando el documento se est√° compilando en una fecha distinta de la fecha establecida en el encabezado.
 \DTMifsaveddate{FechaEmision}{}{%
  \CLASSWARNING{No se especifico' fecha. Asumiendo la fecha de hoy}%
  \DTMsavedate{FechaEmision}{\the\year-\the\month-\the\day}}%
 \DTMsavenow{Ahora}%
 \DTMsaveddatediff{FechaEmision}{Ahora}{\AuxFecha}%
 \ifnum\AuxFecha=0%
 \else
  \CLASSWARNING{Fecha del documento \@Fecha\space distinta de la fecha de hoy}%
 \fi

%% (quitado por no vigente)
 % Establecemos el signo monetario dependiendo de la fecha de emisi√≥n de la factura, para efectos de la Reconversi√≥n Monetaria:
 % \ifx\@undefined\@Moneda
 %  \DTMsaveddatediff{FechaEmision}{FechaBsS}{\AuxFecha}%
 %  \ifnum\AuxFecha<0%
 %   \Moneda{\@MonedaBs}%
 %   \LetraNotaInterna{\fontsize{14}{18}}%
 %   \NotaInterna{\FPupn\TotalBsS{\Total{} 100000 div \@DigitosMoneda{} round}Seg√∫n Decreto Presidencial 3.548, el total en Bol√≠vares Soberanos es de {\bfseries \@MonedaBsS~\numprint{\TotalBsS}}}%
 %   \CLASSWARNING{Se establecio' el texto aclaratorio sobre el total en Boli'vares Soberanos como una nota interna}%
 %  \else
 %   \DTMsaveddatediff{FechaEmision}{FechaBs}{\AuxFecha}%
 %   \ifnum\AuxFecha>-1%
 %    \Moneda{\@MonedaBs}%
 %   \else
 %    \Moneda{\@MonedaBsS}%
 %    \LetraNotaInterna{\fontsize{14}{18}}%
 %    \NotaInterna{\FPupn\TotalBsF{\Total{} 100000 * \@DigitosMoneda{} round}El total en Bol√≠vares Fuertes es de {\bfseries \@MonedaBsF~\numprint{\TotalBsF}}}%
 %    \CLASSWARNING{Se establecio' el texto aclaratorio sobre el total en Boli'vares Fuertes como una nota interna}%
 %   \fi
 %  \fi
 % \fi

 % Efectuamos distintos chequeos para dar errores o advertencias si falt√≥ algo.
 \ifdefvoid{\@RazonSocial}{\CLASSERROR{Hay que definir la razo'n social}}{}%
 \if@reporte
  \ifdefvoid{\@Num}{\CLASSWARNING{No se especifico' el nu'mero de la factura. Puede dar error si el ti'tulo del reporte no se especifica que aparezca en las cabeceras}}{}%
  \ifdefvoid{\@Proveedor}{%
   \ifdefvoid{\@Emisor}
    {\CLASSERROR{Hay que definir el nombre del proveedor cuando se emite un reporte}}%
    {\CLASSWARNING{Se toma el emisor como el proveedor por no haberse especificado este u'ltimo}%
    \let\@Proveedor=\@Emisor}}
   {}%
 \fi
 \if@factura
  \ifdefvoid{\@RIF}{\CLASSERROR{Hay que definir el R.I.F}}{}%
  \ifdefvoid{\@Direccion}{\CLASSERROR{Hay que definir la direccio'n fiscal}}{}%
  \ifdefvoid{\@Telefono}{\CLASSWARNING{Pudiera definirse un nu'mero telefo'nico}}{}%
  \ifdefvoid{\@Email}{\CLASSWARNING{Pudiera definirse una direccio'n de correo electro'nico}}{}%
  \ifdefvoid{\@NotaFinal}{\CLASSWARNING{Pudiera definirse una nota final}}{}%
  \ifcotizacion
   \ifdefvoid{\@FondoFactura}{\CLASSWARNING{En la opcio'n para cotizacion se recomienda agregar el fondo}}{}%
  \fi
  \ifprefactura
   \ifdefvoid{\@FondoFactura}{\CLASSWARNING{En la opcio'n para prefactura se recomienda agregar el fondo}}{}%
  \fi
  \ifsinnumero
   \ifcotizacion
   \else
    \CLASSERROR{La opcio'n para no poner el nu'mero so'lo es compatible con las cotizaciones}%
   \fi
  \fi
  \ifdenom
   \ifsinnumero
   \else
    \ifdefvoid{\@Num}{\CLASSERROR{Hay que definir el nu'mero de la factura}}{}%
   \fi
  \fi
 \fi
 \ifdefvoid{\@Contacto}{\if@Nombre\else\CLASSWARNING{Pudiera definirse una persona de contacto}\fi}{}%

 % El c√°lculo de la fecha de vencimiento para cuando haya cr√©dito o fecha de vencimiento expl√≠cita.
 \ifdefvoid{\@Credito}
  {\gdef\@FechaVencimiento{\DTMusedate{FechaEmision}}}
  {\DTMsaveddateoffsettojulianday{FechaEmision}{\@Credito}{\AuxFecha}%
   \DTMsavejulianday{FechaVencimiento}{\number\AuxFecha}%
   \gdef\@FechaVencimiento{\DTMusedate{FechaVencimiento}}}%
 \ifx\@undefined\@NumControl\let\@NumControl\@Num\fi
 \ifx\@undefined\@NumSerieControl\gdef\@NumSerieControl{00}\fi
 
 % Establecemos los porcentajes de las al√≠cuotas, y redondeamos los descuentos.
 \FPupn\@AlicuotaGporc{\@AlicuotaG{} 100 * \@DigitosPorc{} round clip}%
 \FPupn\@AlicuotaRporc{\@AlicuotaR{} 100 * \@DigitosPorc{} round clip}%
 \FPupn\@AlicuotaAporc{\@AlicuotaA{} 100 * \@DigitosPorc{} round clip}%
 \FPset\@AlicuotaEporc{0}%
 \FPupn\@DescuentoGporc{\@DescuentoGporc{} \@DigitosPorc{} round clip}%
 \FPupn\@DescuentoRporc{\@DescuentoRporc{} \@DigitosPorc{} round clip}%
 \FPupn\@DescuentoAporc{\@DescuentoAporc{} \@DigitosPorc{} round clip}%
 \FPupn\@DescuentoEporc{\@DescuentoEporc{} \@DigitosPorc{} round clip}%
 \FPupn\@DescuentoGfactor{100 \@DescuentoGporc{} /}%
 \FPupn\@DescuentoRfactor{100 \@DescuentoRporc{} /}%
 \FPupn\@DescuentoAfactor{100 \@DescuentoAporc{} /}%
 \FPupn\@DescuentoEfactor{100 \@DescuentoEporc{} /}

 % Una vez definido todo en el pre√°mbulo, los comandos usados para definir campos servir√°n para mostrar el campo que se defini√≥ con ese comando.
 \def\Moneda{\@Moneda}%
 \def\RazonSocial{\@RazonSocial}%
 \let\Nombre\RazonSocial
 \def\RIF{\@RIF}%
 \let\CI\RIF
 \def\Direccion{\@Direccion}%
 \def\Telefono{\@Telefono}%
 \def\Email{\@Email}%
 \def\Contacto{\@Contacto}%
 \def\Emisor{\@Emisor}%
 \def\Conforme{\@Conforme}%
 \def\Proveedor{\@Proveedor}%
 \def\Fecha{\@Fecha}%
 \def\FechaVencimiento{\@FechaVencimiento}%
 \def\Credito{\@Credito}%
 \def\Num{\@Num}%
 \def\NumSerieControl{\@NumSerieControl}%
 \def\NumControl{\@NumControl}%
 \def\NotaFinal{\@NotaFinal}%
 \def\Resumen{\@Resumen}%
 \def\NotaPrevia{\@NotaPrevia}%
 \def\NotaInterna{\@NotaInterna}%
 \def\NotaExterna{\@NotaExterna}%
 \def\TituloReporte{\@TituloReporte}}

%</class>
%<*class|def>
%% Posiciones (X,Y) de los objetos: i) fecha, ii) denominaci√≥n, iii) nota final, iv) n√∫mero de control, v) firmas.
%<*class>
\NewDocumentCommand{\PosFecha}{s m m}{
 \setlength{\@PosFechaX}{#2}
 \setlength{\@PosFechaY}{#3}
 \IfBooleanTF{#1}{\booltrue{FechaYarriba}}{\boolfalse{FechaYarriba}}
 \IfBeginWith{#2}{-}{\booltrue{FechaXnegativo}}{\boolfalse{FechaXnegativo}}
 \IfBeginWith{#3}{-}{\booltrue{FechaYnegativo}}{\boolfalse{FechaYnegativo}}}

%</class>
%<def>\PosFecha*{-0cm}{5cm}
%<*class>
\NewDocumentCommand{\PosDenom}{s m m}{
 \setlength{\@PosDenomX}{#2}
 \setlength{\@PosDenomY}{#3}
 \IfBooleanTF{#1}{\booltrue{DenomYarriba}}{\boolfalse{DenomYarriba}}
 \IfBeginWith{#2}{-}{\booltrue{DenomXnegativo}}{\boolfalse{DenomXnegativo}}
 \IfBeginWith{#3}{-}{\booltrue{DenomYnegativo}}{\boolfalse{DenomYnegativo}}}

%</class>
%<def>\PosDenom*{0cm}{5cm}
%<*class>
\NewDocumentCommand{\PosControl}{s m m}{
 \setlength{\@PosControlX}{#2}
 \setlength{\@PosControlY}{#3}
 \IfBooleanTF{#1}{\booltrue{ControlYarriba}}{\boolfalse{ControlYarriba}}
 \IfBeginWith{#2}{-}{\booltrue{ControlXnegativo}}{\boolfalse{ControlXnegativo}}
 \IfBeginWith{#3}{-}{\booltrue{ControlYnegativo}}{\boolfalse{ControlYnegativo}}}

%</class>
%<def>\PosControl*{0cm}{-2.4cm}
%<*class>
\NewDocumentCommand{\PosNotaFinal}{s m m m}{
 \setlength{\@PosNotaFinalXuno}{#2}
 \setlength{\@PosNotaFinalXdos}{#3}
 \setlength{\@PosNotaFinalY}{#4}
 \IfBooleanTF{#1}{\booltrue{NotaFinalYarriba}}{\boolfalse{NotaFinalYarriba}}
 \IfBeginWith{#4}{-}{\booltrue{NotaFinalYnegativo}}{\boolfalse{NotaFinalYnegativo}}}
\let\PosCondiciones\PosNotaFinal
%</class>
%<def>\PosNotaFinal{0cm}{0cm}{-5.3cm}
%% La nota final se define con un X_inicial, un X_final y un Y_inicial (Xo,Xf,Y)
%<*class>

\NewDocumentCommand{\PosFirmas}{m m m}{
 \setlength{\@PosFirmasXuno}{#1}
 \setlength{\@PosFirmasXdos}{#2}
 \setlength{\@PosFirmasY}{#3}
 \IfBeginWith{#3}{-}{\booltrue{FirmasYnegativo}}{\boolfalse{FirmasYnegativo}}}
%</class>
%<def>\PosFirmas{5cm}{1cm}{-2.4cm}
%% La firma se define con un X_inicial, un X_final y un Y_inicial (Xo,Xf,Y)

%% Tama√±o y grosor de la l√≠nea de las firmas.
%<*class>
\def\LineaFirmas#1#2{
 \setlength{\@TamLineaFirmas}{#1}
 \setlength{\@GrosorLineaFirmas}{#2}}
%</class>
%<def>\LineaFirmas{5.5cm}{0.7pt}

%% Separaci√≥n m√≠nima horizontal entre los totales en modo de filas y distancia vertical entre esas l√≠neas, fija.
%<class>\def\SepFilas#1#2{\setlength{\@SeparaMinTotales}{#1}\setlength{\@SeparaFilas}{#2}}
%<def>\SepFilas{0.8cm}{2.5pt}

%% Separaci√≥n vertical entre los elementos de la factura (entre el encabezado y el cuadro de la 'factura', luego desde dicho cuadro hasta la descripci√≥n, o hasta los totales en modo de filas).
%<class>\def\SepVertical#1{\setlength{\@SeparaVertical}{#1}}
%<def>\SepVertical{0.2cm}

%% Separaci√≥n horizontal entre la caja de los datos del cliente y la caja del resumen.
%<class>\def\SepDatosResumen#1{\setlength{\@SeparaDatosResumen}{#1}}
%<def>\SepDatosResumen{0.2cm}

%% Separaci√≥n horizontal interna entre la l√≠nea y el texto en los datos del cliente y en el resumen.
%<class>\def\SepEncabezado#1{\setlength{\@SeparaInternaEncabezado}{#1}}
%<def>\SepEncabezado{6pt}

%% Separaci√≥n interna entre la l√≠nea y el texto de la nota previa.
%<class>\def\SepNotaPrevia#1{\setlength{\@SeparaInternaNotaPrevia}{#1}}
%<def>\SepNotaPrevia{6pt}

%% Separaci√≥n extra entre los elementos en la factura.
%<class>\def\SepItemsExtra#1{\setlength{\@SeparaItemsExtra}{#1}}
%<def>\SepItemsExtra{0pt}

%% Separaci√≥n interna entre la l√≠nea y el texto de la descripci√≥n.
%<class>\def\SepDescripcion#1{\setlength{\@SeparaInternaDescripcion}{#1}}
%<def>\SepDescripcion{6pt}

%<class>\def\SepNotaFinal#1{\setlength{\@SeparaInternaNotaFinal}{#1}}
%<class>\let\SepCondiciones\SepNotaFinal
%<def>\SepNotaFinal{5pt}

%% Grosor de la l√≠nea de las cajas del encabezado, curvatura de la esquina y sombra.
%% (si pedimos linea de 0pt, todo queda en cero y no se abre el ambiente TikZ).
%<class>\NewDocumentCommand{\LineaEncabezado}{m g g}{
%<class> \setlength{\@GrosorLineaEncabezado}{#1}
%<class> \IfValueT{#2}{\setlength{\@EsquinaLineaEncabezado}{#2}}
%<class> \IfValueT{#3}{\setlength{\@SombraEncabezado}{#3}}}
%<def>\LineaEncabezado{0.4pt}{10pt}{0pt}

%% Grosor de la l√≠nea de la nota previa, curvatura de la esquina y sombra.
%% (si pedimos linea de 0pt, todo queda en cero y no se abre el ambiente TikZ).
%<class>\NewDocumentCommand{\LineaNotaPrevia}{m g g}{
%<class> \setlength{\@GrosorLineaNotaPrevia}{#1}
%<class> \IfValueT{#2}{\setlength{\@EsquinaLineaNotaPrevia}{#2}}
%<class> \IfValueT{#3}{\setlength{\@SombraNotaPrevia}{#3}}}
%<def>\LineaNotaPrevia{0.4pt}{7pt}{0pt}

%% Grosor de la l√≠nea de la descripci√≥n, curvatura de la esquina y sombra.
%% (si pedimos linea de 0pt, todo queda en cero y no se abre el ambiente TikZ).
%<class>\NewDocumentCommand{\LineaDescripcion}{m g g}{
%<class> \setlength{\@GrosorLineaDescripcion}{#1}
%<class> \IfValueT{#2}{\setlength{\@EsquinaLineaDescripcion}{#2}}
%<class> \IfValueT{#3}{\setlength{\@SombraDescripcion}{#3}}}
%<def>\LineaDescripcion{0.4pt}{0pt}{4pt}

%% Grosor de la l√≠nea de la nota final, curvatura de la esquina y sombra.
%% (si pedimos linea de 0pt, todo queda en cero y no se abre el ambiente TikZ).
%<class>\NewDocumentCommand{\LineaNotaFinal}{m g g}{
%<class> \setlength{\@GrosorLineaNotaFinal}{#1}
%<class> \IfValueT{#2}{\setlength{\@EsquinaLineaNotaFinal}{#2}}
%<class> \IfValueT{#3}{\setlength{\@SombraNotaFinal}{#3}}}
%<class>\let\LineaCondiciones\LineaNotaFinal
%<def>\LineaNotaFinal{0pt}{0pt}{0pt}

%% El espacio vertical que hay que avanzar s√≥lo en la primera p√°gina del reporte antes de empezar a escribir sobre √©l. Usable cuando la primera p√°gina tiene un membrete y las dem√°s no, es decir, cuando se usa \FondoReporte y no \FondoReporte*.
%<class>\def\InicioReporte#1{\setlength{\@InicioReporte}{#1}}
%<def>\InicioReporte{1.6cm}

%% Tipos de letra para cada elemento posible:
%% Esta es la letra de la descripci√≥n de los items; y el espacio \baselineskip de *toda* la tabla de la factura se fija en este comando √∫nicamente (se predetermin√≥ 18pt).
%<class>\def\LetraItems#1{\gdef\@LetraItems{#1\selectfont}}
%<def>\LetraItems{\fontsize{14}{18}}

%% Tipo de letra para la nota interna:
%<class>\def\LetraNotaInterna#1{\gdef\@LetraNotaInterna{#1\selectfont}}
%<def>\LetraNotaInterna{\fontsize{11}{13}\itshape}

%% Tipo de letra para la nota externa:
%<class>\def\LetraNotaExterna#1{\gdef\@LetraNotaExterna{#1\selectfont}}
%<def>\LetraNotaExterna{\fontsize{14}{16.8}}

%% Con este comando se cambia la etra del t√≠tulo de la tabla, es decir, los textos 'Cantidad, 'Descripci√≥n', etc...
%<class>\def\LetraTitColumnas#1{\gdef\@LetraTitColumnas{#1\selectfont}}
%<def>\LetraTitColumnas{\fontsize{10}{10}\bfseries}

%% Tipo de letra de los t√≠tulos de los totales, por ejemplo los textos: 'B.I. G', 'IVA G'.
%<class>\def\LetraTitTotales#1{\gdef\@LetraTitTotales{#1\selectfont}}
%<def>\LetraTitTotales{\fontsize{12}{12}\bfseries}

%% Letra con la que salen los totales parciales, es decir, los n√∫meros, exceptuando el total general.
%<class>\def\LetraNumTotales#1{\gdef\@LetraNumTotales{#1\selectfont}}
%<def>\LetraNumTotales{\fontsize{14}{12}}

%% Letra con la que sale la palabra 'TOTAL'.
%<class>\def\LetraTitTotal#1{\gdef\@LetraTitTotal{#1\selectfont}}
%<def>\LetraTitTotal{\fontsize{12}{12}\bfseries}

%% Letra para el total general, el monto.
%<class>\def\LetraNumTotal#1{\gdef\@LetraNumTotal{#1\selectfont}}
%<def>\LetraNumTotal{\fontsize{14}{14}\bfseries}

%% Tipo de letra para los t√≠tulos de las cajas del encabezado, por ejemplo: 'Datos del cliente'.
%<class>\def\LetraTitEnc#1{\gdef\@LetraTitEnc{#1\selectfont}}
%<def>\LetraTitEnc{\fontsize{11}{12.5}\slshape}

%% Tipo de letra para el texto en el encabezado de la factura.
%<class>\def\LetraEncFactura#1{\gdef\@LetraEncFactura{#1\selectfont}}
%<def>\LetraEncFactura{\fontsize{11}{12.5}}

%% Tipo de letra para el texto en el encabezado del reporte.
%<class>\def\LetraEncReporte#1{\gdef\@LetraEncReporte{#1\selectfont}}
%<def>\LetraEncReporte{\fontsize{13}{16}}

%% Letra para los montos individuales de la factura y las cantidades.
%<class>\def\LetraNumeros#1{\gdef\@LetraNumeros{#1\selectfont}}
%<def>\LetraNumeros{\fontsize{14}{14}}

%% El tipo de IVA ('G', 'R', 'A' o '(E)') tambi√©n tiene su tipo de letra.
%<class>\def\LetraTipoIVA#1{\gdef\@LetraTipoIVA{#1\selectfont}}
%<def>\LetraTipoIVA{\fontsize{12}{12}}

%% Letra para la descripci√≥n larga (comando \Descripcion).
%<class>\def\LetraDescripcion#1{\gdef\@LetraDescripcion{#1\selectfont}}
%<def>\LetraDescripcion{\fontsize{14}{16.8}}

%% Tipo de letra para el texto bajo las l√≠neas para firmar.
%<class>\def\LetraFirmas#1{\gdef\@LetraFirmas{#1\selectfont}}
%<def>\LetraFirmas{\fontsize{12}{12}}

%% Tipo de letra para la nota previa.
%<class>\def\LetraNotaPrevia#1{\gdef\@LetraNotaPrevia{#1\selectfont}}
%<def>\LetraNotaPrevia{\fontsize{11}{12.5}}

%% Tipo de letra para la nota final.
%<class>\def\LetraNotaFinal#1{\gdef\@LetraNotaFinal{#1\selectfont}}
%<class>\let\LetraCondiciones\LetraNotaFinal
%<def>\LetraNotaFinal{\fontsize{12}{12}}

%% Letra para la denominaci√≥n del documento ('FACTURA', 'COTIZACI√ìN',...).
%<class>\def\LetraDenom#1{\gdef\@LetraDenom{#1\selectfont}}
%<def>\LetraDenom{\fontsize{14}{14}\bfseries}

%% Letra para la numeraci√≥n de la factura.
%<class>\def\LetraNumeracion#1{\gdef\@LetraNumeracion{#1\selectfont}}
%<def>\LetraNumeracion{\fontsize{14}{14}\bfseries\color{red}}

%% Letra para las fechas (emisi√≥n y vencimiento).
%<class>\def\LetraFecha#1{\gdef\@LetraFecha{#1\selectfont}}
%<def>\LetraFecha{\fontsize{14}{15}}

%% Letra para el t√≠tulo del reporte.
%<class>\def\LetraTitReporte#1{\gdef\@LetraTitReporte{#1\selectfont}}
%<def>\LetraTitReporte{\fontsize{16}{22}\bfseries}

%% Letra para las cabeceras de las p√°ginas en el modo reporte.
%<class>\def\LetraInfoPagina#1{\gdef\@LetraInfoPagina{#1\selectfont}}
%<def>\LetraInfoPagina{\fontsize{12}{12}\slshape}

%% Letra para el reverso de la factura.
%<class>\def\LetraReverso#1{\gdef\@LetraReverso{#1\selectfont}}
%<def>\LetraReverso{\fontsize{10}{12}}

%% Letra para el reporte.
%<class>\def\LetraReporte#1{\gdef\@LetraReporte{#1\selectfont}}
%<def>\LetraReporte{\fontsize{12}{20}}

%</class|def>
%<*class>
%% Comando para incluir la firma escaneada en el sitio donde va la l√≠nea de la firma del emisor.
\NewDocumentCommand{\FirmaFactura}{m O{0pt} O{0pt}}{% \FirmaFactura{imagen}[x-corr][y-corr]
 \AtEndPreamble{
  \if@factura
   \RequirePackage{graphicx}
   \ifx&#2&\else\setlength{\@FirmaFacturaXcorr}{#2}\fi
   \ifx&#3&\else\setlength{\@FirmaFacturaYcorr}{#3}\fi
   \savebox{\@CajaFirmaEmisor}{#1}
   \AtBeginShipoutNext{%
    \begin{textblock*}{\@TamLineaFirmas}%
     (\textwidth+\oddsidemargin+1in-\@TamLineaFirmas/2-\wd\@CajaFirmaEmisor/2-\@PosFirmasXdos+\@FirmaFacturaXcorr,\@PosFirmasY-\ht\@CajaFirmaEmisor-\dp\@CajaFirmaEmisor+\@FirmaFacturaYcorr)%
     \usebox{\@CajaFirmaEmisor}%
    \end{textblock*}}%
  \fi}}

\NewDocumentCommand{\FirmaReporte}{O{} O{0pt} O{0pt} G{\@Proveedor} O{\@FirmaReportePosX} O{\@FirmaReporteExcesoLinea}}{% \Firma[imagen][x-corr][y-corr]{texto}[posici√≥n en X desde la derecha][tama√±o linea]
 \renewcommand{\baselinestretch}{1}\selectfont
 \newif\if@Firma@Dibujo
 \newbox{\TextoFirma}%
 \newbox{\DibujoFirma}%
 \ifx&#1&\else\savebox{\DibujoFirma}{#1}\@Firma@Dibujotrue\fi
 \setlength{\@FirmaReporteXcorr}{#2}%
 \setlength{\@FirmaReporteYcorr}{#3}%
 \savebox{\TextoFirma}{#4}%
 \setlength{\@FirmaReporteTextPos}{#5}%
 \setlength{\@FirmaReporteTamLinea}{#6}%
 \@LetraFirmas
 \if@Firma@Dibujo
  \newlength{\@FirmaReporteoddeven}%
  \setlength{\@FirmaReporteFirmaPos}{\zposy{Firma@zref@PosY}sp}%
 \fi
 \ifdim\wd\DibujoFirma>\wd\TextoFirma
  \setlength{\@FirmaReporteTamLinea}{\@FirmaReporteTamLinea+\wd\DibujoFirma}%
 \else
  \setlength{\@FirmaReporteTamLinea}{\@FirmaReporteTamLinea+\wd\TextoFirma}%
 \fi
 \par
 \vspace*{\ht\DibujoFirma}%
 \vspace*{\dp\DibujoFirma}%
 \hfill
 \parbox{\@FirmaReporteTamLinea}{%
  \if@Firma@Dibujo\zsaveposy{Firma@zref@PosY}\fi
  \rule{\@FirmaReporteTamLinea}{\@GrosorLineaFirmas}\\
  \centering{\usebox{\TextoFirma}}}%
 \hspace*{\@FirmaReporteTextPos}\par
 \if@Firma@Dibujo
  \mbox{}%
  \par
  \ifodd\c@page
   \setlength{\@FirmaReporteoddeven}{\oddsidemargin}%
  \else
   \setlength{\@FirmaReporteoddeven}{\evensidemargin}%
  \fi
  \begin{textblock*}{\@FirmaReporteTamLinea}
  (\textwidth+\@FirmaReporteoddeven+1in-0.5\@FirmaReporteTamLinea-0.5\wd\DibujoFirma-\@FirmaReporteTextPos+\@FirmaReporteXcorr,
   \paperheight-\@FirmaReporteFirmaPos-\ht\DibujoFirma-\dp\DibujoFirma+\@FirmaReporteYcorr)
   \noindent\usebox{\DibujoFirma}%
  \end{textblock*}
 \fi}

%% Con \FondoFactura le damos el nombre del archivo que contiene el formato de la factura, por ejemplo para compilaciones con 'prefactura', 'cotizacion' o para incluir una imagen de fondo como 'marca de agua'.
\newcommand{\FondoFactura}[1]{
 \AtEndPreamble{
  \if@factura
   \RequirePackage{graphicx}
   \@FondoFacturatrue
   \gdef\@FondoFactura{#1}
  \fi}}

%% Con \FondoReporte le damos el nombre del archivo que contiene el formato del reporte. Existen dos posibilidades: que dicho fondo salga en todas las p√°ginas o s√≥lo en la primera.
\NewDocumentCommand{\FondoReporte}{s m}{
 \AtEndPreamble{
  \if@reporte
   \@FondoReportetrue
   \RequirePackage{graphicx}
   \gdef\@FondoReporte{#2}
   \IfBooleanT{#1}{\@FondoReporteStartrue}% Con * sale en todas las p√°ginas; sin * sale s√≥lo en la primera p√°gina.
  \fi}}

%% Comando para establecer desde el pre√°mbulo el estilo de p√°gina (\pagestyle) del reporte, tanto para la primera p√°gina como para las siguientes.
\NewDocumentCommand{\EstiloPagReporte}{o m}{
 \gdef\@EstiloPagReporteResto{#2}
 \IfValueTF{#1}{\gdef\@EstiloPagReporteUno{#1}}{\gdef\@EstiloPagReporteUno{\@EstiloPagReporteResto}}}

%% El t√≠tulo para el reporte.
\NewDocumentCommand{\TituloReporte}{s m}{
 \gdef\@TituloReporte{#2}%
 \IfBooleanTF{#1}{% Con '*' sale el t√≠tulo en las cabeceras o pies. Sin '*' no.
  \gdef\@InfoPagina{\let\\\relax\@InfoPaginaTitulo}}%
 {\let\@InfoPagina\@InfoPaginaNoTitulo}}

%% Para cada cliente o para cada personalizaci√≥n se puede tener un archivo .def o .tex con su nombre y ciertas macros cargadas. Ese archivo lo ponemos incluir con '\Cliente' en lugar de usar \input, y la extensi√≥n deber√° ser .def o .tex.
\newcommand{\Cliente}[1]{%
 \IfFileExists{#1.def}{\input{#1.def}}{
  \IfFileExists{#1.tex}{\input{#1.tex}}{
   \CLASSERROR{No existe #1.def ni #1.tex}}}}

\input{factura.def}%  Cargamos los valores predeterminados.

%% Comando para escribir el encabezado en la factura.
\newcommand\@EncabezadoFactura{%
 \ifdefvoid{\@Resumen}{\@EscribeDatos}{\@EscribeDatosResumen}%
 \vspace*{\@SeparaVertical}%
 \ifexpandecuadro\else\vfill\fi}

%% Comando para escribir el encabezado en el reporte.
\newcommand\@EncabezadoReporte{%
 \vspace*{-\topskip}%
 \if@FondoReporte
  \if@FondoReporteStar
  \else
   \vspace*{\@InicioReporte}%
  \fi
 \fi
 \@EscribeDatosReporte
 \@LetraReporte}

%% El ambiente 'factura', usando el paquete 'environ' para su definici√≥n, y el comando auxiliar \@FacturaAuxCmd.
%% Gracias a Heiko Oberdiek y a David Carlisle (Thanks to Heiko Oberdiek and David Carlisle).
%% http://tex.stackexchange.com/questions/108565/know-the-cell-width-with-tabular-or-include-a-paragraph-box-without-specifying
\NewEnviron{factura}{%
 \expandafter\@FacturaAuxCmd\expandafter{\BODY}%
 \ifnum\value{page}=1\else\CLASSERROR{La factura ocupa mas que una pagina}\fi}

\NewEnviron{reverso}{%
 \if@factura
   \expandafter\newgeometry\expandafter{\@GeometriaReverso}%
   \topskip1sp% ¬°¬°No puedo poner 0 porque se genera una p√°gina en blanco extra!!
  \begin{minipage}[t][\textheight-\pagetotal]{\linewidth}%
   \thispagestyle{empty}%
   \@LetraReverso\BODY
  \end{minipage}
  \clearpage
 \fi}

%% Comando auxiliar para agregar un car√°cter al final de cada l√≠nea en la descripci√≥n dentro del cuadro de la factura si ocupa √©sta m√°s de una l√≠nea.
%% Gracias a Gustavo Mezzetti y a David Carlisle (Thanks to Gustavo Mezzetti and David Carlisle).
%% http://tex.stackexchange.com/questions/296035/insert-a-special-character-at-each-end-of-line-in-a-paragraph
%% http://tex.stackexchange.com/questions/248944/how-to-put-before-lines
\newcommand{\@DescripcionAuxCmd}[2]{%
 \immediate\write\@auxout{\gdef\noexpand\@TamDescripcion{\the\linewidth}}% Para poder establecer la l√≠nea diagonal hay que saber el tama√±o del campo de la descripci√≥n.
 \ifimpdesc\settowidth{\@TempDimen}{\@EscribeTipoDeImpuesto{#2}}\fi
 \savebox{\@CajaPrueba}{%
  \parbox[t]{\linewidth}{%
   \David@XStart
   \ifcentradesc\centering\arraybackslash\fi
   #1%
   \David@XEnd
   \ifdim\@TempDimen=0pt%
   \else
    \hfill\kern\@SeparaFinLineaDesc\@EscribeTipoDeImpuesto{#2}%
   \fi
   \par\global\count1=\prevgraf}}%
 \ifsinmarcas
  \usebox{\@CajaPrueba}%
 \else
  \ifnum\count1=1%
   \usebox{\@CajaPrueba}%
  \else
   \ifdim\@TempDimen>\wd\@CajaCaracterCR
   \else
    \setlength{\@TempDimen}{\wd\@CajaCaracterCR}%
   \fi
   \parbox[t]{\linewidth-\@TempDimen-\@SeparaFinLineaDesc}{%
    \David@XStart
    \ifcentradesc\centering\arraybackslash\fi
    #1%
    \David@XEnd
    \par
    \global\count1=\prevgraf% Esto lo necesitamos en otro lado para calcular el espacio extra en los √≠tems.
    \count0=\prevgraf
    \count2=\prevgraf
    \loop
     \ifnum\count0=\count2
      \ifimpdesc
       \vskip-\baselineskip
       \mbox{}\hfill
       \rlap{%
        \hspace*{\@TempDimen}%
        \hspace*{\@SeparaFinLineaDesc}%
        \llap{\@EscribeTipoDeImpuesto{#2}}}%
      \fi
     \else
      \mbox{}\hfill
      \rlap{%
       \hspace*{\@TempDimen}%
       \hspace*{\@SeparaFinLineaDesc}%
       \hspace*{-\wd\@CajaCaracterCR}%
       \usebox{\@CajaCaracterCR}}%
     \fi
     \vskip-2\baselineskip
     \advance\count0 -1
     \ifnum\count0 > 0
    \repeat
    \kern\count2\baselineskip\mbox{}%
    \strut}%
  \fi
 \fi}

%% Comandos auxiliares para colocar en \parbox cada celda.
\newcommand{\@NumItemAuxCmd}[1]{%
 \savebox{\@CajaPrueba}{#1}%
 \ifdim\wd\@CajaPrueba > \@TamNumItem \global\@TamNumItem=\wd\@CajaPrueba\fi
 \parbox[t]{\@TamNumItem}{#1}}

\newcommand{\@CantidadAuxCmd}[1]{%
 \savebox{\@CajaPrueba}{#1}%
 \ifdim\wd\@CajaPrueba > \@TamCantidad \global\@TamCantidad=\wd\@CajaPrueba\fi
 \parbox[t]{\@TamCantidad}{#1}}

\newcommand{\@PrecioUAuxCmd}[1]{%
 \savebox{\@CajaPrueba}{#1}%
 \ifdim\wd\@CajaPrueba > \@TamPrecioU \global\@TamPrecioU=\wd\@CajaPrueba\fi
 \parbox[t]{\@TamPrecioU}{#1}}

\newcommand{\@PrecioSAuxCmd}[1]{%
 \savebox{\@CajaPrueba}{#1}%
 \ifdim\wd\@CajaPrueba > \@TamPrecioS \global\@TamPrecioS=\wd\@CajaPrueba\fi
 \parbox[t]{\@TamPrecioS}{#1}}

\newcommand{\@DescuentoAuxCmd}[1]{%
 \savebox{\@CajaPrueba}{#1}%
 \ifdim\wd\@CajaPrueba > \@TamDescuento \global\@TamDescuento=\wd\@CajaPrueba\fi
 \parbox[t]{\@TamDescuento}{#1}}

\newcommand{\@IVAAuxCmd}[1]{%
 \savebox{\@CajaPrueba}{#1}%
 \ifdim\wd\@CajaPrueba > \@TamIVA \global\@TamIVA=\wd\@CajaPrueba\fi
 \parbox[t]{\@TamIVA}{#1}}

\newcommand{\@PrecioTAuxCmd}[1]{%
 \savebox{\@CajaPrueba}{#1}%
 \ifdim\wd\@CajaPrueba > \@TamPrecioT \global\@TamPrecioT=\wd\@CajaPrueba\fi
 \parbox[t]{\@TamPrecioT}{#1}}

%% Presentaci√≥n de totales en modo de columnas.
\newcommand{\@EscribeTotalCol}[1]{%
 \expandafter\FPifeq\csname Desc#1\endcsname{0}%
  \ifsinivaexpresado\else\@EscribeTotalColBI{#1}\fi
 \else
  \@EscribeTotalColSubt{#1}%
  \@EscribeTotalColDesc{#1}%
  \ifsinivaexpresado\else\@EscribeTotalColBI{#1}\fi
 \fi}

%% Forma agupada para la presentaci√≥n de totales en modo de columnas.
\newcommand{\@EscribeTotalColAgrupado}{%
 \if@Exento\if@DescE\@EscribeTotalColSubt{E}\fi\fi
 \if@BIR\if@DescR\@EscribeTotalColSubt{R}\fi\fi
 \if@DescG\@EscribeTotalColSubt{G}\fi
 \if@BIA\if@DescA\@EscribeTotalColSubt{A}\fi\fi
 \if@Exento\if@DescE\@EscribeTotalColDesc{E}\fi\fi
 \if@BIR\if@DescR\@EscribeTotalColDesc{R}\fi\fi
 \if@DescG\@EscribeTotalColDesc{G}\fi
 \if@BIA\if@DescA\@EscribeTotalColDesc{A}\fi\fi
 \ifsinivaexpresado
 \else
  \if@Exento\@EscribeTotalColBI{E}\fi
  \if@BIR\@EscribeTotalColBI{R}\fi
  \@EscribeTotalColBI{G}%
  \if@BIA\@EscribeTotalColBI{A}\fi
  \if@BIR\@EscribeTotalColAlicuota{R}\fi
  \@EscribeTotalColAlicuota{G}%
  \if@BIA\@EscribeTotalColAlicuota{A}\fi
  %% (quitado por no vigente)
  % \ifbool{Electro}{\@EscribeTotalColAlicuotaGDesc}{}%
 \fi}

\newcommand{\@EscribeTotalColBI}[1]{%
 \@LetraTitTotales \csname @@BI#1\endcsname
  \ifx#1E%
  \else
   \ifG\ \hfill(\csname @Alicuota#1porc\endcsname\%)\else\mbox{}\fi
  \fi
 & \@LetraNumTotales\@SignoMonetarioAux\numprint{\csname BI#1\endcsname} \\}

\newcommand{\@EscribeTotalColAlicuota}[1]{%
 {\@LetraTitTotales \csname @@Alicuota#1\endcsname\ \hfill (\csname @Alicuota#1porc\endcsname\%)}
 & \@LetraNumTotales\@SignoMonetarioAux\numprint{\csname Alicuota#1\endcsname} \\}

%% (quitado por no vigente)
 % \newcommand{\@EscribeTotalColAlicuotaGDesc}{%
 % {\@LetraTitTotales \@@AlicuotaGDesc\ \hfill (\@AlicuotaGDescPorc\%)}
 % & \@LetraNumTotales\@SignoMonetarioAux\numprint{\AlicuotaGDesc} \\}

\newcommand{\@EscribeTotalColSubt}[1]{%
 {\@LetraTitTotales \csname @@Subtotal#1\endcsname}
 & \@LetraNumTotales\@SignoMonetarioAux\numprint{\csname Subt#1\endcsname} \\}

\newcommand{\@EscribeTotalColDesc}[1]{%
 {\@LetraTitTotales \csname @@Descuento#1\endcsname
 \csname if@Desc#1num\endcsname \else \ \hfill (\csname @Descuento#1porc\endcsname\%)\fi}
 & \@LetraNumTotales\@SignoMonetarioAux\numprint{\csname Desc#1\endcsname} \\}

%% Presentaci√≥n de los totales en modo filas.
\newcommand{\@EscribeTotalFilasBI}[1]{%
 \@EscribeTotalFilasBIizq{#1}: & \@EscribeTotalFilasBIder{#1}}

\newcommand{\@EscribeTotalFilasAlicuota}[1]{%
 \@EscribeTotalFilasAlicuotaizq{#1}: & \@EscribeTotalFilasAlicuotader{#1}}

%% (no implementado)
 % \newcommand{\@EscribeTotalFilasDesc}[1]{%
 %  \@EscribeTotalFilasDescizq{#1}: & \@EscribeTotalFilasDescder{#1}}

\newcommand{\@EscribeTotalFilasSoloBI}[1]{%
 {\@LetraTitTotales\@EscribeTotalFilasBIizq{#1}:} {\@LetraNumTotales\@EscribeTotalFilasBIder{#1}}}

%% (no implementado)
 % \newcommand{\@EscribeTotalFilasSoloDesc}[1]{%
 % {\@LetraTitTotales\@EscribeTotalFilasDescizq{#1}:} {\@LetraNumTotales\@EscribeTotalFilasDescder{#1}}}

\newcommand{\@EscribeTotalFilasSoloAlicuota}[1]{%
 {\@LetraTitTotales\@EscribeTotalFilasAlicuotaizq{#1}:} {\@LetraNumTotales\@EscribeTotalFilasAlicuotader{#1}}}

\newcommand{\@EscribeTotalFilasBIizq}[1]{%
 \@LetraTitTotales\csname @@BI#1\endcsname
 \ifx#1G%
  \ifG \ (\@AlicuotaGporc\%)\fi%  Si hay otra B.I. que no sea general, escribimos el porcentaje expl√≠cito en la general.
 \else
  \ifx#1E%
  \else
  \ (\csname @Alicuota#1porc\endcsname\%)%
  \fi
 \fi}

\newcommand{\@EscribeTotalFilasBIder}[1]{%
 \@LetraNumTotales\@SignoMonetarioAux\numprint{\csname BI#1\endcsname}}

\newcommand{\@EscribeTotalFilasAlicuotaizq}[1]{%
 \@LetraTitTotales\csname @@Alicuota#1\endcsname \ (\csname @Alicuota#1porc\endcsname\%)}

\newcommand{\@EscribeTotalFilasAlicuotader}[1]{%
 \@LetraNumTotales\@SignoMonetarioAux\numprint{\csname Alicuota#1\endcsname}}

%% (no implementado)
 % \newcommand{\@EscribeTotalFilasDescizq}[1]{%
 %  \@LetraTitTotales\csname @@Descuento#1\endcsname \ (\csname @Descuento#1porc\endcsname\%)}

 % \newcommand{\@EscribeTotalFilasDescder}[1]{%
 %  \@LetraNumTotales\@SignoMonetarioAux\numprint{\csname Desc#1\endcsname}}

\newcommand{\@EscribeTotalFilasAuxTotal}{\@LetraTitTotal\@@Total: & \@LetraNumTotal\@SignoMonetarioAux\numprint{\Total}}
 
\newcommand{\@EscribeTotalFilas}[2][]{%
 \begin{tabular}[b]{@{}l@{\extracolsep{1ex}}r@{}}% ¬°Esta tabla tiene que abrir hacia abajo para que la separaci√≥n entre las filas se pueda colocar con \@SeparaFilas!
  \csname @EscribeTotalFilasBI\endcsname{#2}%
  \ifx#2E%
   \ifx#1T%
    \\[\@SeparaFilas]%
    \@EscribeTotalFilasAuxTotal
   \fi
  \else
   \\[\@SeparaFilas]%
   \csname @EscribeTotalFilasAlicuota\endcsname{#2}%
  \fi
 \end{tabular}}

%% Comando auxiliar para escribir el signo monetario cuando aplica
\newcommand{\@SignoMonetarioAux}{%
 \ifsinmonedatotales\else\@Moneda\hspace*{\@EspacioSignoMonetario}\fi}

\newcommand{\@GeneraCajasTotalesFilas}{%
 \if@Exento
  \newbox{\@CajaBIE}\newbox{\@CajaBIET}%
  \savebox{\@CajaBIE}{\@EscribeTotalFilasSoloBI{E}}%
  \savebox{\@CajaBIET}{\@EscribeTotalFilas[T]{E}}%
 \fi
 \if@BIR
  \addtocounter{@IVANoGeneral}{1}%
  \newbox{\@CajaBIR}\newbox{\@CajaAliR}\newbox{\@CajaBIAliR}%
  \savebox{\@CajaBIR}{\@EscribeTotalFilasSoloBI{R}}%
  \savebox{\@CajaAliR}{\@EscribeTotalFilasSoloAlicuota{R}}%
  \savebox{\@CajaBIAliR}{\@EscribeTotalFilas{R}}%
 \fi
 \newbox{\@CajaBIG}\newbox{\@CajaAliG}\newbox{\@CajaBIAliG}%
 \savebox{\@CajaBIG}{\@EscribeTotalFilasSoloBI{G}}%
 \savebox{\@CajaAliG}{\@EscribeTotalFilasSoloAlicuota{G}}%
 \savebox{\@CajaBIAliG}{\@EscribeTotalFilas{G}}%
 \if@BIA
  \addtocounter{@IVANoGeneral}{1}%
  \newbox{\@CajaBIA}\newbox{\@CajaAliA}\newbox{\@CajaBIAliA}%
  \savebox{\@CajaBIA}{\@EscribeTotalFilasSoloBI{A}}%
  \savebox{\@CajaAliA}{\@EscribeTotalFilasSoloAlicuota{A}}%
  \savebox{\@CajaBIAliA}{\@EscribeTotalFilas{A}}%
 \fi}

\newcommand{\@EscribeTotalesFilasGET}{%
 \hspace*{\@SepTotales}\usebox{\@CajaBIG}%
 \hspace*{\@SepTotales}\usebox{\@CajaAliG}%
 \if@Exento\hspace*{\@SepTotales}\usebox{\@CajaBIE}\fi
 \hspace*{\@SepTotales}\usebox{\@CajaTotal}%
 \ifcentrado\hspace*{\@SepTotales}\fi}

\newcommand{\@EscribeTotalesFilasGxET}{%
 \if@BIR\hspace*{\@SepTotales}\usebox{\@CajaBIAliR}\fi
 \hspace*{\@SepTotales}\usebox{\@CajaBIAliG}%
 \if@BIA\hspace*{\@SepTotales}\usebox{\@CajaBIAliA}\fi
 \hspace*{\@SepTotales}\if@Exento\usebox{\@CajaBIET}\else\usebox{\@CajaTotal}\fi
 \ifcentrado\hspace*{\@SepTotales}\fi}

\newcommand{\@EscribeTotalesFilasRGA}{%
 \hspace*{\@SepTotales}\usebox{\@CajaBIAliR}%
 \hspace*{\@SepTotales}\usebox{\@CajaBIAliG}%
 \hspace*{\@SepTotales}\usebox{\@CajaBIAliA}%
 \hspace*{\@SepTotales}}

\newcommand{\@EscribeTotalesFilasRGAET}{%
 \@EscribeTotalesFilasRGA
 \if@Exento\usebox{\@CajaBIET}\else\usebox{\@CajaTotal}\fi
 \ifcentrado\hspace*{\@SepTotales}\fi}

%% Escribe la letra que designa al tipo de impuesto que aplica al √≠tem.
\NewDocumentCommand{\@EscribeTipoDeImpuesto}{m}{%
 % Hay que abrir un grupo de ejecuci√≥n porque el cambio en la tipograf√≠a altera la celda.
 {\ifG
   \@LetraTipoIVA
   \ifx#1G\@DenomAlicuotaG\fi
   \ifx#1R\@DenomAlicuotaR\fi
   \ifx#1A\@DenomAlicuotaA\fi
   \ifx#1E\@DenomAlicuotaE\fi
  \fi}}
 
%% Comando para poner en cero los contadores de los totales porque el ambiente de la factura se eval√∫a tres veces y los totales se sumar√≠an todos tres veces.
\newcommand{\@ZERO}{%
 \FPset\BIG{0}\global\let\BIG\BIG
 \FPset\BIR{0}\global\let\BIR\BIR
 \FPset\BIA{0}\global\let\BIA\BIA
 \FPset\BIE{0}\global\let\BIE\BIE
 \FPset\SubtE{0}\global\let\SubtE\SubtE
 \FPset\SubtG{0}\global\let\SubtG\SubtG
 \FPset\SubtR{0}\global\let\SubtR\SubtR
 \FPset\SubtA{0}\global\let\SubtA\SubtA
 \FPset\SubtX{0}\global\let\SubtX\SubtX
 \FPset\DescE{0}\global\let\DescE\DescE
 \FPset\DescG{0}\global\let\DescG\DescG
 \FPset\DescR{0}\global\let\DescR\DescR
 \FPset\DescA{0}\global\let\DescA\DescA
 \FPset\DescX{0}\global\let\DescX\DescX
 \FPset\AlicuotaG{0}\global\let\AlicuotaG\AlicuotaG
 %% (quitado por no vigente)
  % \FPset\AlicuotaGDesc{0}\global\let\AlicuotaGDesc\AlicuotaGDesc
 \FPset\AlicuotaR{0}\global\let\AlicuotaR\AlicuotaR
 \FPset\AlicuotaA{0}\global\let\AlicuotaA\AlicuotaA}

%% Comandos para calcular todos los totales parciales y el total general.
\newcommand{\@CalculaTotalesI}{%
 \FPifeq\SubtG{0}\else\@CalculaTotalesII{G}\fi
 \FPifeq\SubtR{0}\else\@CalculaTotalesII{R}\fi
 \FPifeq\SubtA{0}\else\@CalculaTotalesII{A}\fi
 \FPifeq\SubtE{0}\else\@CalculaTotalesII{E}\fi
 %% (quitado por no vigente)
 % \ifbool{Electro}{%
 %  \FPiflt\BIG\@AlicuotaGDescLimite
 %   \let\@AlicuotaGDesc\@AlicuotaGDescBajo
 %  \else
 %   \let\@AlicuotaGDesc\@AlicuotaGDescAlto
 %  \fi
 %  \FPupn\@AlicuotaGDescPorc{\@AlicuotaGDesc{} 100 * \@DigitosPorc{} round clip}%
 %  \FPupn\AlicuotaGDesc{\BIG{} \@AlicuotaGDesc{} * \@DigitosMoneda{} round}%
 %  \global\let\AlicuotaGDesc\AlicuotaGDesc
 %  \global\let\@AlicuotaGDescPorc\@AlicuotaGDescPorc
 %  \global\let\@AlicuotaGDesc\@AlicuotaGDesc}{}%
 \FPupn\Total{\BIE{} \BIR{} + \BIG{} + \BIA{} + \AlicuotaR{} + \AlicuotaG{} + \AlicuotaA{} + \@DigitosMoneda{} round}%
 %% (quitado por no vigente) arriba se sumaba tambi√©n \AlicuotaGDesc{}.
 \global\let\Total\Total}

\newcommand{\@CalculaTotalesII}[1]{%
 % Sumamos al descuento.
 \expandafter\FPupn\csname Desc#1\endcsname{\csname @Descuento#1factor\endcsname{} \csname Subt#1\endcsname{} * \csname @Descuento#1num\endcsname{} + \@DigitosMoneda{} round}%
 \global\expandafter\let\csname Desc#1\expandafter\endcsname\csname Desc#1\endcsname
 % Sumamos a la base imponible.
 \expandafter\FPupn\csname BI#1\endcsname{\csname Desc#1\endcsname{} \csname Subt#1\endcsname{} - \@DigitosMoneda{} round}%
 \global\expandafter\let\csname BI#1\expandafter\endcsname\csname BI#1\endcsname
 \ifx#1E%
 \else{%
  % Sumamos a la al√≠cuota.
  \expandafter\FPupn\csname Alicuota#1\endcsname{\csname BI#1\endcsname{} \csname @Impuesto#1\endcsname{} * \@DigitosMoneda{} round}%
  \global\expandafter\let\csname Alicuota#1\expandafter\endcsname\csname Alicuota#1\endcsname}%
 \fi}

%% Comandos auxiliares para poder evaluar la definici√≥n de las columnas en la tabla con un comando que se expande completamente.
\def\@FacturaAuxColumnasEval{
 % Primera l√≠nea, la m√°s externa.
 \ifbool{SinLineasVertExt}{}{|}
 % Columna para el n√∫mero del √≠tem, si aplica.
 \ifbool{NumItem}{c}{r@{\extracolsep{0pt}}}
 % Segunda l√≠nea, que sale solamente cuando se usa la opci√≥n 'numitem'
 \ifbool{NumItem}{\ifbool{SinLineasVertInt}{}{|}}{}
 % Columna 'X' con DCU, columna fantasma con 'sincantidad' y columna 'c' con CDU.
 \ifbool{PrimeroDescripcion}{X}{
  \ifbool{SinCantidad}{l@{\extracolsep{0pt}}}{c}}
 % Tercera l√≠nea.
 \ifbool{SinCantidad}{}{\ifbool{SinLineasVertInt}{}{|}}
 % Columna 'c' con DCU, columna 'r' con DUC, columna 'X' sin espacio para 'sincantidad' y columna 'X' con CDU.
 \ifbool{DCU}{c}{
  \ifbool{DUC}{r}{
   \ifbool{SinCantidad}{X@{\extracolsep{0pt}}}{X}}}
 % Cuarta l√≠nea, que sale solamente cuando no se usa 'sincantidad'. 
 \ifbool{SinCantidad}{}{\ifbool{SinLineasVertInt}{}{|}}
 % Columna 'c' para DUC y columna 'r' para cualquier otro caso (DCU, CDU y 'sincantidad').
 \ifbool{DUC}{c}{r}
 % Quinta l√≠nea. 
 \ifbool{SinLineasVertInt}{}{|}
 % Columna 'r' para subtotal antes del descuento, o columna fantasma si no se especifica 'subtotal').
 \ifbool{Subtotal}{r}{l@{\extracolsep{0pt}}}
 % Sexta l√≠nea, que sale solamente cuando hay columna de subtotales.
 \ifbool{Subtotal}{\ifbool{SinLineasVertInt}{}{|}}{}
 % Columna 'c' para 'descuentos' y columna 'r' sin espacio si no hay descuentos individuales.
 \ifbool{Descuentos}{c}{r@{\extracolsep{0pt}}}
 % S√©ptima l√≠nea, que sale solamente cuando hay descuentos.
 \ifbool{Descuentos}{\ifbool{SinLineasVertInt}{}{|}}{}
 % Columna 'c' para 'iva' y columna 'r' sin espacio si no hay columna de IVA.
 \ifbool{IVA}{c}{r@{\extracolsep{0pt}}}
 % Octava l√≠nea, que sale solamente cuando hay columna de IVA.
 \ifbool{IVA}{\ifbool{SinLineasVertInt}{}{|}}{}
 % Columna 'r' siempre.
 r
 % Novena y √∫ltima l√≠nea.
 \ifbool{SinLineasVertExt}{}{|}}

%% Comando para hacer los c√°lculos sobre cada √≠tem y establecer las macros con el contenido de cada √≠tem introducido.
%% Aqu√≠ tenemos que hacer coincidir los par√°metros de \@CalculaItem con los de \@ITEM para poder hacer
%% \let\@CalculaItem\@ITEM cuando no hay factura sino solamente reporte.
\NewDocumentCommand{\@CalculaItem}{m m m o m m +o}{%
 \gdef\@PrecioUtemp##1{\FPupn\PrecioUtemp{##1 \PrecioUtempx{} * clip}}%
 \addtocounter{NumItem}{1}%
 % Calculamos.
 \@PrecioUtemp{#5}%
 \FPupn\PrecioU{\PrecioUtemp{} \@DigitosMoneda{} round}%
 \FPifeq\PrecioU{\PrecioUtemp}\else\CLASSWARNING{Se esta' introduciendo un precio con ma's de dos decimales: (#3 - \PrecioUtemp. Redondeado a \PrecioU)}{}\fi% Advertimos cuando el precio unitario tiene m√°s de dos decimales.
 \ifbool{Descuentos}
  {\ifx\\#6\\\FPset\Dcto{0}\else\FPupn\Dcto{#6 \@DigitosPorc{} round clip}\fi}% Fijamos en 0 el descuento si no se especifica en \Item***.
  {\FPset\Dcto{#6}%
   \FPifeq\Dcto{0}\else\CLASSWARNING{Se pidio' un descuento individual sin dar la opcio'n de la clase 'descuentos'. No se tomara' en cuenta}\fi
   \FPset\Dcto{0}}% Tambi√©n fijamos en 0 el descuento por si se especifica en \Item*** pero no se pide la opci√≥n 'descuentos'.
 \FPupn\PrecioS{#2 \PrecioU{} * \@DigitosMoneda{} round}%
 \FPupn\PrecioT{100 \Dcto{} 100 - / \PrecioS{} * \@DigitosMoneda{} round}%
 \global\let\PrecioU\PrecioU
 \global\let\PrecioS\PrecioS
 \global\let\Dcto\Dcto
 \global\let\PrecioT\PrecioT
 % Suma el elemento actual al subtotal acumulado.
 \expandafter\FPupn\csname Subt#1\endcsname{\PrecioT{} \csname Subt#1\endcsname{} + \@DigitosMoneda{} round}%
 \global\expandafter\let\csname Subt#1\expandafter\endcsname\csname Subt#1\endcsname
 % Guardamos en macros cada elemento agregado a la factura; por ejemplo: \@Item@i@Cantidad contiene la cantidad que se introdujo para el primer √≠tem; as√≠ mismo con ii@, @iii@, y as√≠ mismo tambi√©n con @Descripcion, @PrecioU, @Descuento y @PrecioT.
 \expandafter\gdef\csname @Item@\romannumeral\value{NumItem}@Cantidad\endcsname{\numprint{#2}}%
 \expandafter\gdef\csname @Item@\romannumeral\value{NumItem}@Descripcion\endcsname{#3}%
 \expandafter\global\expandafter\edef\csname @Item@\romannumeral\value{NumItem}@PrecioU\endcsname{\noexpand\numprint{\PrecioU}}%
 \expandafter\global\expandafter\edef\csname @Item@\romannumeral\value{NumItem}@PrecioS\endcsname{\noexpand\numprint{\PrecioS}}%
 \expandafter\global\expandafter\edef\csname @Item@\romannumeral\value{NumItem}@Descuento\endcsname{\noexpand\numprint{\Dcto}}%
 \expandafter\gdef\csname @Item@\romannumeral\value{NumItem}@DescripcionLarga\endcsname{#7}%
 \expandafter\global\expandafter\expandafter\edef\csname @Item@\romannumeral\value{NumItem}@IVA\endcsname{%
  \noexpand\numprint\expandafter{\csname @Alicuota#1porc\endcsname}}%
 \expandafter\global\expandafter\edef\csname @Item@\romannumeral\value{NumItem}@PrecioT\endcsname{\noexpand\numprint{\PrecioT}}}

%% Macro interna para saber si una etiqueta existe o no.
\gdef\@pruebaref#1{%
 \expandafter\ifx\csname @Etiqueta@#1\endcsname\relax
  \CLASSWARNING{La etiqueta `#1' no esta' definida}\ignorespaces
  \@PruebaReffalse
 \else
  \@PruebaReftrue
 \fi}

%% Comandos para las referencias: i) referencia al n√∫mero de √≠tem, ii) a la cantidad, iii) a la descripci√≥n, iv) al precio unitario, v) al descuento, vi) al precio total.
\gdef\itemref#1{%
 \ifbool{NumItem}{}{\CLASSWARNING{Es recomendable usar la opcio'n 'numitem' para enumerar los i'tems}}%
 \@pruebaref{#1}\if@PruebaRef \csname @Etiqueta@#1\endcsname \fi}
\gdef\cantref#1{\@pruebaref{#1}\if@PruebaRef \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @Cantidad\endcsname \fi}
\gdef\descref#1{\@pruebaref{#1}\if@PruebaRef \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @Descripcion\endcsname \fi}
\gdef\puref#1{\@pruebaref{#1}\if@PruebaRef \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @PrecioU\endcsname \fi}
\gdef\subtref#1{\@pruebaref{#1}\if@PruebaRef \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @PrecioS\endcsname \fi}
\gdef\dctoref#1{\@pruebaref{#1}\if@PruebaRef \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @Descuento\endcsname \fi}
\gdef\ldescref#1{\@pruebaref{#1}\if@PruebaRef \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @DescripcionLarga\endcsname \fi}
\gdef\ivaref#1{\@pruebaref{#1}\if@PruebaRef \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @IVA\endcsname \fi}
\gdef\ptref#1{\@pruebaref{#1}\if@PruebaRef \csname @Item@\expandafter\romannumeral\csname @Etiqueta@#1\endcsname @PrecioT\endcsname \fi}

%% Definimos un comando para la etiqueta, que se define dentro del entorno de la factura para que tenga alcance local; cuando se acaba dicho entorno, el comando \label vuelve a ser lo que est√° definido en latex.ltx.
\newcommand{\label@factura}[1]{%
 \expandafter\ifx\csname @Etiqueta@#1\endcsname\relax
  \expandafter\global\expandafter\edef\csname @Etiqueta@#1\endcsname{\arabic{NumItem}}\ignorespaces
  \CLASSINFO{Etiqueta `#1' definida para el i'tem \arabic{NumItem}}%
 \else
  \edef\@label@test@uno{\csname @Etiqueta@#1\endcsname}%
  \edef\@label@test@dos{\theNumItem}%
  \ifx\@label@test@uno\@label@test@dos
  \else
   \CLASSWARNING{La etiqueta `#1' se definio' ma's de una vez}\ignorespaces
  \fi
 \fi}

%% Todo esto tiene que estar dentro de \AtEndPreamble que es cuando \if@factura, \if@reverso e \if@reporte fueron ya aplicadas, y para que se eval√∫en adecuadamente en su momento las definiciones hechas con \edef.
\AtEndPreamble{
 % Comando auxiliar para abrir la tabla del cuadro de la factura y expandir completamente las columnas.
 \edef\@FacturaAuxInicioCmd{\noexpand\begin{tabularx}{\textwidth}{\@FacturaAuxColumnasEval}}

 % Comando auxiliar para abrir el '\multicolumn' de la nota interna y eval√∫e la presencia o no de las barras verticales.
 \edef\@ColumnasMultiColumnNotaIntAuxCmd{%
  \noexpand\multicolumn{8}{\ifbool{SinLineasVertExt}{}{|}l\ifbool{SinLineasVertExt}{}{|}}{%
   \noexpand\parbox[t]{\linewidth-2\tabcolsep-2\arrayrulewidth}{\noexpand\@LetraNotaInterna\noexpand\@NotaInterna\noexpand\strut}}%
   \noexpand\\}

 % Comando auxiliar para abrir el '\multicolumn' para los totales en el modo de columnas y expandir completamente las columnas cuando hay o no barras verticales.
 \edef\@ColumnasMultiColumnTotalesAuxCmd{%
  \noexpand\multicolumn{8}{\ifbool{SinLineasVertExt}{}{|} r}\begingroup
    \noexpand\if@ExpandeCuadro
     \noexpand\iflinea\noexpand\zsaveposx{LineaNodoBCoordX}\noexpand\zsaveposy{LineaNodoBCoordY}\noexpand\fi\noexpand\fi% Fijamos la posici√≥n (x,y) final para la l√≠nea ya que estaremos justo en el punto donde escribimos el total, y hasta all√≠ llega la l√≠nea en el modo de columnas.
     \noexpand\begin{tabular}[b]{@{\noexpand\extracolsep{2\noexpand\tabcolsep}}lr \ifbool{SinLineasVertExt}{}{|}}}

 % Comando auxiliar para la definici√≥n del ambiente de la factura; al final de este comando est√° el texto que va en el enddef del ambiente de la factura.
 \newcommand{\@FacturaAuxCmd}[1]{%
  \ifexpandecuadro
   \setlength{\@EspacioVacioInicial}{\zposy{EspacioVacioInicial}sp}%
   \setlength{\@EspacioVacioFinal}{\zposy{EspacioVacioFinal}sp}%
   \global\@EspacioVacioInicial=\@EspacioVacioInicial% Hay que globalizarlas
   \global\@EspacioVacioFinal=\@EspacioVacioFinal
   \savebox{\@CajaEspacioVacio}{\parbox[b][\@EspacioVacioInicial-\@EspacioVacioFinal]{\@TamDescripcion}{%
    \iflinea
     \if@LineaHastaFinal
      \zsaveposy{LineaNodoBCoordY}%
     \else
      \if@LineaDescripcion
       \zsaveposx{LineaNodoACoordX}\mbox{}\hfill \zsaveposx{LineaNodoBCoordX}\zsaveposy{LineaNodoBCoordY}%
      \fi
     \fi
    \fi}}%
   \ifdim \ht\@CajaEspacioVacio=0pt \global\lineafalse \else \@ExpandeCuadrotrue \fi
  \fi

  \ifx\undefined\Total\relax\else\CLASSERROR{Parece ya haberse usado un entorno de factura}\fi
  %
  % Comandos \David@SavePos, \David@XStart, \David@XEnd, \David@XPad, \David@XLeft y \David@XRight para poder manejar el salto de l√≠nea en las columnas adyacentes a la columna 'X' del tabularx (la descripci√≥n), cuando esta ocupa m√°s que una l√≠nea.
  % Gracias a David Carlisle (Thanks to David Carlisle).
  % http://tex.stackexchange.com/questions/111203/tabularx-bottom-alignment-on-r-or-l-columns-when-x-column-wraps
  \def\David@SavePos##1{\leavevmode\pdfsavepos\write\@auxout{\gdef\noexpand##1{\the\pdflastypos sp}}}%
  \def\David@XStart{\expandafter\David@SavePos\csname save@start@\romannumeral\value{NumItem}\endcsname}%
  \def\David@XEnd{\expandafter\David@SavePos\csname save@end@\romannumeral\value{NumItem}\endcsname}%
  \def\David@XPad##1##2##3{%
   \vtop{%
    \baselineskip\normalbaselineskip
    ##2%
    \expandafter
    \ifx\csname save@start@##1\endcsname
     \relax
    \else
     \dimen@\csname save@start@##1\endcsname\relax
     \loop
      \ifdim\dimen@>\csname save@end@##1\endcsname
      \advance\dimen@-\baselineskip
      \settowidth{\@TempDimen}{##3}%
       \ifdim\@TempDimen=0pt\settowidth{\@TempDimen}{##2}\fi
      \hbox{\parbox{\@TempDimen}{\@CaracterCeldasVacias}}%
     \repeat
    \fi
    ##3}}%
  \def\David@XLeft##1{\David@XPad{\romannumeral\value{NumItem}}{\hbox{##1}}{}}%
  \def\David@XRight##1{\David@XPad{\romannumeral\value{NumItem}}{}{\hbox{##1}}}%
  %
  % Caja auxiliar para el caracter de retorno de carro y poder saber si tama√±o en el campo de la descripci√≥n.
  \savebox{\@CajaCaracterCR}{\@LetraItems\@CaracterCR}
  %
  % Comando para fijar la separaci√≥n extra final de cada item, lo cual viene dado por la cantidad de l√≠neas de la descripci√≥n,
  % que est√° alojado en \count1, definido en \@DescripcionAuxCmd.
  \def\@CalculaSeparaItemsExtraFinal{%
   \setlength{\@SeparaItemsExtraFinal}{\numexpr\the\count1\normalbaselineskip-\normalbaselineskip+\@SeparaItemsExtra}%
   \global\@SeparaItemsExtraFinal=\@SeparaItemsExtraFinal}
  %
  % Comando interno general para agregar cualquier √≠tem.
  \NewDocumentCommand{\@ITEM}{m m m o m m +o}{%
   % 1. [R|G|A|E|X]; 2. cantidad; 3. descripci√≥n; 4. descripci√≥n para el csv (entre corchetes); 5. p/u; 6. dcto; 7. la descripci√≥n para el reporte.
   \@CalculaItem{##1}{##2}{##3}{##5}{##6}[##7]%
   % Si no es el primer √≠tem, entonces hace falta \\ para terminar el √≠tem anterior.
   \ifnum\value{NumItem}=1% Aqu√≠, \@CalculaItem aumenta en 1 el contador NumItem, que si vale 1 significa que a√∫n no hemos procesado la l√≠nea 1, es decir, no hay que hacer el salto de l√≠nea. La √∫ltima l√≠nea se termina en otro lado.
   \else
    \@CalculaSeparaItemsExtraFinal
    \\[\@SeparaItemsExtraFinal]
    \ifconlineasha\hline\fi% L√≠neas para separar cada √≠tem, si hiciera falta.
   \fi
   % Primer -opcional- campo: El n√∫mero del √≠tem.
   \ifbool{NumItem}{\David@XLeft{\@NumItemAuxCmd{\mbox{}\hfill \@LetraNumeros \arabic{NumItem}\hfill\mbox{}}}}{}%
   &
   % Segundo campo: Ac√° puede ir la cantidad (cdu) o la descripci√≥n (dcu y duc).
   \ifbool{SinCantidad}{}{%
    \ifbool{PrimeroDescripcion}
    {\@DescripcionAuxCmd{##3}{##1}}% dcu y duc.
    {\David@XLeft{\@CantidadAuxCmd{\mbox{}\hfill \@LetraNumeros \numprint{##2}\hfill\mbox{}}}}}% cdu.
   &
   % Tercer campo: Ac√° puede ir la descripci√≥n (cdu), la cantidad (dcu), o el precio unitario (duc).
   \ifbool{PrimeroDescripcion}{%
    \ifdcu
     \David@XRight{\@CantidadAuxCmd{\mbox{}\hfill \@LetraNumeros \numprint{##2}\hfill\mbox{}}}% dcu.
    \else
     \David@XRight{\@PrecioUAuxCmd{%
      \ifx##1X \hfill \@CaracterItemXVacio \hfill\mbox{}%
      \else
       \ifimpdesc\else\@EscribeTipoDeImpuesto{##1}\fi \hfill \@LetraNumeros \numprint{\PrecioU}
      \fi}}% duc.
    \fi}
   {\@DescripcionAuxCmd{##3}{##1}}% cdu.
   &
   % Cuarto campo: Ac√° puede ir el precio unitario (cdu y dcu) o la cantidad (duc).
   \ifbool{SinCantidad}{}{%
    \ifduc
     \David@XRight{\@CantidadAuxCmd{\mbox{}\hfill \@LetraNumeros \numprint{##2}\hfill\mbox{}}}% duc.
    \else
     \David@XRight{\@PrecioUAuxCmd{%
      \ifx##1X \hfill \@CaracterItemXVacio \hfill\mbox{}%
      \else
       \ifimpdesc\else\@EscribeTipoDeImpuesto{##1}\fi \hfill \@LetraNumeros \numprint{\PrecioU}
      \fi}}% dcu y cdu.
    \fi}%
   & % Quinto -opcional- campo: Subtotal (para luego descuentos).
   \ifbool{Subtotal}{%
    \David@XRight{\@PrecioSAuxCmd{%
     \ifx##1X \hfill \@CaracterItemXVacio \hfill\mbox{}%
     \else
      \ifimpdesc\else\@EscribeTipoDeImpuesto{##1}\fi \hfill \@LetraNumeros \numprint{\PrecioS}
     \fi}}}{}
   &
   % Sexto -opcional- campo: Descuento.
   \ifbool{Descuentos}{%
    \David@XRight{\@DescuentoAuxCmd{%
     \ifx##1X \hfill \@CaracterItemXVacio \hfill\mbox{}%
     \else
      \mbox{}\hfill \@LetraNumeros \numprint{\Dcto}\%\hfill\mbox{}%
     \fi}}}{}% Tenemos que usar un condicional booleano porque si no da problemas con el condicional \FPifeq.
   &
   % S√©ptimo -opcional- campo: IVA.
   \ifbool{IVA}{%
    \David@XRight{\@IVAAuxCmd{%
     \ifx##1X \hfill \@CaracterItemXVacio \hfill\mbox{}%
     \else
      \mbox{}\hfill \@LetraNumeros \numprint{\csname @Alicuota##1porc\endcsname}\%\hfill\mbox{}%
     \fi}}}{}% Tenemos que usar un condicional booleano porque si no da problemas con el condicional \FPifeq.
   &
   % Octavo campo: El total.
   \David@XRight{\@PrecioTAuxCmd{%
    \ifx##1X \hfill \@CaracterItemXVacio \hfill\mbox{}%
    \else
     \ifimpdesc\else\@EscribeTipoDeImpuesto{##1}\fi \hfill \@LetraNumeros \numprint{\PrecioT}
    \fi}}%
   % Escribimos al csv.
   \ifcsv
    \IfValueTF{##4}{\@EscribeItemsEnCSV{##1}{##2}{##4}}{\@EscribeItemsEnCSV{##1}{##2}{##3}}%
   \fi}%
  %
  % Comando para escribir en el .csv.
  \newcommand{\@EscribeItemsEnCSV}[3]{%
   \ifbool{SinCantidad}
   {\ifdescuentos
     \write\csv{"\unexpanded{##3}","\Dcto","\PrecioT","##1"}%
    \else
     \write\csv{"\unexpanded{##3}","\PrecioT","##1"}%
    \fi}
   {\if@cdu
     \ifdescuentos
      \write\csv{"##2","\unexpanded{##3}","\PrecioU","\Dcto","\PrecioT","##1"}%
     \else
      \write\csv{"##2","\unexpanded{##3}","\PrecioU","\PrecioT","##1"}%
     \fi
    \fi
    \ifdcu
     \ifdescuentos
      \write\csv{"\unexpanded{##3}","##2","\PrecioU","\Dcto","\PrecioT","##1"}%
     \else
      \write\csv{"\unexpanded{##3}","##2","\PrecioU","\PrecioT","##1"}%
     \fi
    \fi
    \ifduc
     \ifdescuentos
      \write\csv{"\unexpanded{##3}","\PrecioU","##2","\Dcto","\PrecioT","##1"}%
     \else
      \write\csv{"\unexpanded{##3}","\PrecioU","##2","\PrecioT","##1"}%
     \fi
    \fi}}%
  %
  % Usamos la definici√≥n de \label@factura dentro del entorno de la factura para que sea local aqu√≠ nada m√°s.
  \let\label\label@factura
  \@LetraItems% Este es el tipo de letra que tendr√°n los √≠tems, y en este tipo de letra se define el \baselineskip de toda la factura.
  \setlength{\baselineskip@@}{\baselineskip}%
  \global\baselineskip@@=\baselineskip@@
  \@FacturaAuxInicioCmd
  \ifbool{SinLineasHoriExt}{}{\hline}%
  \@ZERO
  \setlength{\tabcolsep@@}{\tabcolsep}%
  \global\tabcolsep@@=\tabcolsep@@
  % Estamos en el n√∫mero del √≠tem, si aplicara.
  \if@LineaDesdeInicio \zsaveposx{LineaNodoACoordX}\fi
  \ifbool{NumItem}{\@NumItemAuxCmd{\mbox{}\hfill \@LetraTitColumnas \@@NumItem \hfill\mbox{}}}{}%
  &
  % Avanzamos a la cantidad, o la descripci√≥n.
  \ifbool{SinCantidad}{}{\ifbool{PrimeroDescripcion}{\@DescripcionAuxCmd{\@LetraTitColumnas \@@Descripcion}{}}{\@CantidadAuxCmd{\mbox{}\hfill \@LetraTitColumnas \@@Cantidad \hfill\mbox{}}}}%
  &% Avanzamos hasta la descripci√≥n, la cantidad o el precio unitario.
  \ifbool{SinCantidad}{\@DescripcionAuxCmd{\@LetraTitColumnas \@@Descripcion}{}}
   {\if@cdu \@DescripcionAuxCmd{\@LetraTitColumnas \@@Descripcion}{}\fi
    \ifdcu \@CantidadAuxCmd{\mbox{}\hfill \@LetraTitColumnas \@@Cantidad \hfill\mbox{}}\fi
    \ifduc \@PrecioUAuxCmd{\mbox{}\hfill \@LetraTitColumnas \@@PrecioU \space (\Moneda)\hfill\mbox{}}\fi}%
  &% Avanzamos hasta el precio unitario, o la cantidad, o columna fantasma cuando es 'sincantidad'.
  \ifbool{SinCantidad}{}
   {%
    \mbox{}\hfill
    \ifduc
     \@CantidadAuxCmd{\mbox{}\hfill \@LetraTitColumnas \@@Cantidad \hfill\mbox{}}%
    \else
     \@PrecioUAuxCmd{\mbox{}\hfill \@LetraTitColumnas \@@PrecioU \space (\Moneda)\hfill\mbox{}}%
    \fi}%
  &% Avanzamos hasta el subtotal, que puede o no existir,
  \ifbool{Subtotal}{\@PrecioSAuxCmd{\mbox{}\hfill \@LetraTitColumnas \@@PrecioS \space (\Moneda)\hfill\mbox{}}}{}%
  &% Avanzamos hasta el descuento, que puede o no existir.
  \ifdescuentos \@DescuentoAuxCmd{\mbox{}\hfill \@LetraTitColumnas \@@Descuento \hfill\mbox{}}\fi
  &% Avanzamos hasta el IVA, que puede o no existir.
  \ifbool{IVA}{\@IVAAuxCmd{\mbox{}\hfill \@LetraTitColumnas \@@IVA \hfill\mbox{}}}{}
  &% Avanzamos hasta el precio total.
  \@PrecioTAuxCmd{\mbox{}\hfill \@LetraTitColumnas \ifbool{SinCantidad}{\@@Precio}{\@@PrecioT}\space (\Moneda)\hfill\mbox{}}%
  \if@LineaHastaFinal \zsaveposx{LineaNodoBCoordX}\fi
  \\
  \ifbool{SinLineaHoriTit}{}{\hline}%
  %
  #1% Aqu√≠ entran todos los items que el usuario declara dentro del ambiente.
  \@CalculaTotalesI
  \@CalculaSeparaItemsExtraFinal
  \\[\@SeparaItemsExtraFinal]% El √∫ltimo fin de l√≠nea se hace aqu√≠.
  \ifconlineasha
   \ifdefvoid{\@NotaInterna}{%
    \ifbool{SinLineasHoriExt}{\if@ExpandeCuadro\hline\fi}{\hline}}{\hline}%
  \fi% Se verifica si hace falta una l√≠nea horizontal o no.
  \iffilas
   % Esto en lugar de \ifexpandecuadro para que no se haga una linea vac√≠a en la tabla cuando la caja est√° vac√≠a.
   \if@ExpandeCuadro
    \ifbool{PrimeroDescripcion}{&\usebox{\@CajaEspacioVacio}&&&&&&\\}{&&\usebox{\@CajaEspacioVacio}&&&&&\\}%
    \ifdefvoid{\@NotaInterna}{}
    {\ifbool{SinLineaHoriNI}{}{\hline}%
     \@ColumnasMultiColumnNotaIntAuxCmd}%
    \ifbool{SinLineasHoriExt}{}{\hline}% Siempre que hay relleno se pone la l√≠nea ac√°.
   \else
    \ifdefvoid{\@NotaInterna}{%
     \ifbool{SinLineasHoriExt}{}{%
      \ifconlineasha\else\hline\fi}}% Verificamos si hay que poner la l√≠nea horizontal. Si est√° 'conlineasha' entonces ya sali√≥ la l√≠nea.
     {\ifbool{SinLineaHoriNI}{}{\ifconlineasha\else\hline\fi}%
      \@ColumnasMultiColumnNotaIntAuxCmd
      \ifbool{SinLineasHoriExt}{}{\hline}}%
   \fi
  \else
   \ifsintotales
   \else
    \ifbool{SinLineaHoriTot}{}{\ifconlineasha\else\hline\fi}% L√≠nea que cierra los √≠tems en la tabla.
   \fi
   % Agregamos el espacio esp√∫reo.
   \if@ExpandeCuadro
    % Rellenamos la tabla con espacio esp√∫reo, y le agregamos las l√≠neas externas, si aplica.
    \ifbool{SinLineasVertExt}{\multicolumn{8}{c}{\usebox{\@CajaEspacioVacio}}}{\multicolumn{8}{|c|}{\usebox{\@CajaEspacioVacio}}}\\
   \fi
   % Si pedimos sin totalizaciones, entonces cerramos la tabla ya, si no, calculamos los totales y los escribimos.
   \ifsintotales
    \ifdefvoid{\@NotaInterna}{}{\ifbool{SinLineaHoriNI}{}{\hline}\@ColumnasMultiColumnNotaIntAuxCmd}%
    \ifbool{SinLineasHoriExt}{}{\hline}%
   \else
    % Modo de columnas: Abrimos la tabla para escribir los totales y le agregamos las l√≠neas verticales externas, si aplica.
    \@ColumnasMultiColumnTotalesAuxCmd
    \ifagrupado
     \@EscribeTotalColAgrupado
    \else
     \if@Exento \@EscribeTotalCol{E}\fi
     \if@BIR\@EscribeTotalCol{R}\ifsinivaexpresado\else\@EscribeTotalColAlicuota{R}\fi\fi
     \@EscribeTotalCol{G}\ifsinivaexpresado\else\@EscribeTotalColAlicuota{G}\fi
     %% (quitado por no vigente)
     % \ifbool{Electro}{\@EscribeTotalColAlicuotaGDesc}{}%
     \if@BIA\@EscribeTotalCol{A}\ifsinivaexpresado\else\@EscribeTotalColAlicuota{A}\fi\fi
    \fi
    \ifsinivaexpresado\else\cline{2-2}\fi
    \hfill \@LetraTitTotal\@@Total & \@LetraNumTotal\@SignoMonetarioAux\numprint{\Total}\\
    \end{tabular}\endgroup
    \\
    \ifdefvoid{\@NotaInterna}{}{\ifbool{SinLineaHoriNI}{}{\hline}\@ColumnasMultiColumnNotaIntAuxCmd}%
    \ifbool{SinLineasHoriExt}{}{\hline}%
   \fi
  \fi
  \end{tabularx}%
  %
  % Generamos la macro \Total vac√≠a para que no d√© error en alg√∫n posible uso dentro del documento.
  \ifsintotales\gdef\Total{}\fi
  % Si pedimos no totalizar (sintotales), la opci√≥n filas queda desactivada.
  \iffilas
   \@LetraNumTotales
   \vspace*{\@SeparaVertical}\par
   \ifexpandecuadro\else\vfill\fi
   \@GeneraCajasTotalesFilas
   \newbox{\@CajaTotal}%
   \savebox{\@CajaTotal}{{\@LetraTitTotal\@@Total:} \@LetraNumTotal\@SignoMonetarioAux\numprint{\Total}}%
   %
   \ifnum \value{@IVANoGeneral}=0%
    \newbox{\@CajaGET}%
    \savebox{\@CajaGET}{\@EscribeTotalesFilasGET}%
    \ifdim \the\wd\@CajaGET < \textwidth
     \parbox{\textwidth}{\@EscribeTotalesFilasGET}%
    \else
     \hspace*{\@SepTotales}%
     \usebox{\@CajaBIAliG}\hspace*{\@SepTotales}%
     \if@Exento\usebox{\@CajaBIET}\else\usebox{\@CajaTotal}\fi
     \ifcentrado\hspace*{\@SepTotales}\fi
    \fi
   \fi
   \ifnum \value{@IVANoGeneral}=1%
    \newbox{\@CajaGxET}%
    \savebox{\@CajaGxET}{\@EscribeTotalesFilasGxET}%
    \ifdim \the\wd\@CajaGxET < \textwidth
     \@EscribeTotalesFilasGxET
    \else
     \hspace*{\@SepTotales}%
     \if@BIR\usebox{\@CajaBIAliR}\hspace*{\@SepTotales}\fi
     \usebox{\@CajaBIAliG}\hspace*{\@SepTotales}%
     \if@BIA\usebox{\@CajaBIAliA}\hspace*{\@SepTotales}\fi
     \\[\@SeparaFilas]\mbox{}%
     \ifcentrado\hspace*{\@SepTotales}\else\hfill\fi
     \if@Exento\usebox{\@CajaBIE}\hspace*{\@SeparaMinTotales}\fi\usebox{\@CajaTotal}%
     \ifcentrado\hspace*{\@SepTotales}\fi
    \fi
   \fi
   \ifnum \value{@IVANoGeneral}=2%
   \newbox{\@CajaRGAET}%
   \savebox{\@CajaRGAET}{\@EscribeTotalesFilasRGAET}%
    \ifdim \the\wd\@CajaRGAET < \textwidth
     \@EscribeTotalesFilasRGAET
    \else
     \newbox{\@CajaRGA}%
     \savebox{\@CajaRGA}{\@EscribeTotalesFilasRGA}%
     \ifdim \the\wd\@CajaRGA < \textwidth
      \@EscribeTotalesFilasRGA
      \\[\@SeparaFilas]\mbox{}%
      \ifcentrado\hspace*{\@SepTotales}\else\hfill\fi
      \if@Exento\usebox{\@CajaBIE}\hspace*{\@SeparaMinTotales}\fi\usebox{\@CajaTotal}%
      \ifcentrado\hspace*{\@SepTotales}\fi
     \else% Aqu√≠ casi cualquier cosa tiene aspecto feo.
      \CLASSWARNING{Es mejor no usar la opcio'n de totalizacio'n en filas en este caso, o disminuir los tama~nos de los tipos de letra para la totalizacio'n}%
      \centering{%
       \begin{tabular}{r@{\hspace*{\@SeparaMinTotales}}l}
        \usebox{\@CajaBIAliR} & \usebox{\@CajaBIAliA} \\[\@SeparaFilas]
        \usebox{\@CajaBIAliG} & \if@Exento\usebox{\@CajaBIET}\else\usebox{\@CajaTotal}\fi
       \end{tabular}}%
     \fi
    \fi
   \fi
  \fi
  \par
  \ifexpandecuadro
   \vspace*{-\@EspacioVacioInicial}%
   \vspace*{\@EspacioVacioFinal}%
   \zsaveposy{EspacioVacioInicial}%
  \fi
  \vfill
  \ifexpandecuadro\zsaveposy{EspacioVacioFinal}\fi
  \vspace*{\@SeparaVertical}\par
  \ifdefvoid{\@NotaExterna}{}{\parbox[t]{\linewidth}{\@LetraNotaExterna\@NotaExterna}\vspace*{\@SeparaVertical}\par}}
 
  \ifbool{SinCantidad}
  % Definamos todos los comandos \Item***. El descuento es opcional; por eso usamos G{0} en \NewDocumentCommand.
  {%
   \NewDocumentCommand{\Item}{m o m G{0} +o}{\@ITEM{G}{1}{#1}[#2]{#3}{#4}[#5]}% √çtem normal.
   \NewDocumentCommand{\ItemR}{m o m G{0} +o}{\global\@BIRtrue\global\Gtrue\@ITEM{R}{1}{#1}[#2]{#3}{#4}[#5]}% √çtem con IVA reducido.
   \NewDocumentCommand{\ItemA}{m o m G{0} +o}{\global\@BIAtrue\global\Gtrue\@ITEM{A}{1}{#1}[#2]{#3}{#4}[#5]}% √çtem con IVA adicional.
   \NewDocumentCommand{\ItemE}{m o m G{0} +o}{\global\@Exentotrue\global\Gtrue\@ITEM{E}{1}{#1}[#2]{#3}{#4}[#5]}% √çtem exento de IVA.
   \NewDocumentCommand{\ItemX}{m o +o}{\@ITEM{X}{1}{#1}[#2]{0}{0}[#3]}% √çtem sin precio.
   \let\ItemG\Item
   \ifcsv
    \ifdescuentos
     \write\csv{"\@@Descripcion","\@@Descuento","\@@Precio \space (\Moneda)","\@@IVA"}%
    \else
     \write\csv{"\@@Descripcion","\@@Precio \space (\Moneda)","\@@IVA"}%
    \fi
   \fi}
  {%
   \NewDocumentCommand{\Item}{m m o m G{0} +o}{\@ITEM{G}{#1}{#2}[#3]{#4}{#5}[#6]}% √çtem normal.
   \NewDocumentCommand{\ItemR}{m m o m G{0} +o}{\global\@BIRtrue\global\Gtrue\@ITEM{R}{#1}{#2}[#3]{#4}{#5}[#6]}% √çtem con IVA reducido.
   \NewDocumentCommand{\ItemA}{m m o m G{0} +o}{\global\@BIAtrue\global\Gtrue\@ITEM{A}{#1}{#2}[#3]{#4}{#5}[#6]}% √çtem con IVA adicional.
   \NewDocumentCommand{\ItemE}{m m o m G{0} +o}{\global\@Exentotrue\global\Gtrue\@ITEM{E}{#1}{#2}[#3]{#4}{#5}[#6]}% √çtem exento de IVA.
   \NewDocumentCommand{\ItemX}{m m o +o}{\@ITEM{X}{#1}{#2}[#3]{0}{0}[#4]}% √çtem sin precio.
   \let\ItemG\Item
   \ifcsv
    \if@cdu
     \ifdescuentos
      \write\csv{"\@@Cantidad","\@@Descripcion","\@@PrecioU \space (\Moneda)","\@@Descuento","\@@PrecioT \space (\Moneda)","\@@IVA"}%
     \else
      \write\csv{"\@@Cantidad","\@@Descripcion","\@@PrecioU \space (\Moneda)","\@@PrecioT \space (\Moneda)","\@@IVA"}%
     \fi
    \fi
    \ifdcu
     \ifdescuentos
      \write\csv{"\@@Descripcion","\@@Cantidad","\@@PrecioU \space (\Moneda)","\@@Descuento","\@@PrecioT \space (\Moneda)","\@@IVA"}%
     \else
      \write\csv{"\@@Descripcion","\@@Cantidad","\@@PrecioU \space (\Moneda)","\@@PrecioT \space (\Moneda)","\@@IVA"}%
     \fi
    \fi
    \ifduc
     \ifdescuentos
      \write\csv{"\@@Descripcion","\@@PrecioU \space (\Moneda)","\@@Cantidad","\@@Descuento","\@@PrecioT \space (\Moneda)","\@@IVA"}%
     \else
      \write\csv{"\@@Descripcion","\@@PrecioU \space (\Moneda)","\@@Cantidad","\@@PrecioT \space (\Moneda)","\@@IVA"}%
     \fi
    \fi
   \fi}

 \if@factura
  % Los descuentos totales no son compatibles -y no creo que lo vayan a ser- con el modo de totalizaci√≥n en filas.
  \iffilas
   \if@DescuentoTotal
    \CLASSWARNING{La opcio'n 'filas' no es compatible con los descuentos totales; sin efecto opcio'n 'filas'}
    \filasfalse
   \fi
  \fi
  \if@reverso
  \else
    \RenewEnviron{reverso}{}
  \fi
  \ifcotizacion\def\@Denominacion{\@@DenomCotiza}\else\def\@Denominacion{\@@DenomFactura}\fi%  Fijamos la denominaci√≥n del documento paras las cotizaciones o facturas, que son casos particulares del modo 'factura'.
  \expandafter\geometry\expandafter{\@GeometriaFactura}%  La geometr√≠a debe aplicarse aqu√≠.
  \AfterEndPreamble{%
   \addtolength{\@PosFechaX}{\oddsidemargin+1in}%  Le sumamos el margen izquierdo a las posiciones de las cosas; es importante que se haga en un \AfterEndPreamble antes de que empiecen a escribirse otras cosas en la p√°gina.
   \addtolength{\@PosDenomX}{\oddsidemargin+1in}%
   \addtolength{\@PosControlX}{\oddsidemargin+1in}%
   \addtolength{\@PosNotaFinalXuno}{\oddsidemargin+1in}%
   \addtolength{\@PosFirmasXuno}{\oddsidemargin+1in}%
   \setlength{\parindent}{0pt}%
   \setlength{\lineskip}{0pt}%
   \setlength{\parskip}{0pt plus 1pt}%
   \expandafter\setlength{\@SepTotales}{\the\@SeparaMinTotales plus 1fill}% \@SeparaMinTotales es el m√≠nimo espacio entre los totales en el modo 'filas', y SepTotales es una dimensi√≥n interna, estirable, con ese como su m√≠nimo.
   \thispagestyle{empty}%
   \pagenumbering{roman}%
   \@EncabezadoFactura
   \@EscribeNotaPrevia}
   \AtBeginShipoutNext{% Antes abr√≠a aqu√≠ un \AtBeginShipoutNext cuando hab√≠a reporte y un \AtEndDocument cuando no. No es necesario eso. Tambi√©n lo modifiqu√© en \FirmaFactura.
    \@CargaFondoFactura
    \@PosicionaFechas
    \ifdenom\@PosicionaDenom\fi
    \ifprefactura\@PosicionaNumControl\fi
    \ifnum\value{@Firmas}=0\else\@PosicionaFirmas\fi
    \ifdefvoid{\@NotaFinal}{}{\@PosicionaNotaFinal}}
  \iflinea
   % Para determinar las coordenadas de la l√≠nea hay que usar \AtBeginShipoutNext porque si no se hace en el 'shipout' de la p√°gina se genera un espacio en blanco extra.
   \AtBeginShipoutNext{\iflinea\@DibujaLinea\fi}
    \iffilas
     \ifbool{SinLineasVertInt}{\@LineaDesdeIniciotrue\@LineaHastaFinaltrue}{\@LineaDescripciontrue}%
    \else
     \ifsintotales
      \@LineaDesdeIniciotrue\@LineaHastaFinaltrue
     \else
      \@LineaDesdeIniciotrue\@LineaHastaTotaltrue
     \fi
    \fi
  \fi
  %% El comando para la descripci√≥n del servicio prestado.
  \NewDocumentCommand{\Descripcion}{+m}{%
   {% Abrimos un grupo adicional para que la redefinici√≥n del entorno 'tikzpicture' sea local.
    \@LetraDescripcion
    % Cuando la l√≠nea tiene grosor cero, hacemos que el entorno 'tikzpicture' sea "fake", y redefinimos \node para que obvie los par√°metros que le dimos como argumento opcional.
    \ifdim\@GrosorLineaDescripcion=0pt%
     \setlength{\@SeparaInternaDescripcion}{0pt}\setlength{\@EsquinaLineaDescripcion}{0pt}\setlength{\@SombraDescripcion}{0pt}%
     \renewenvironment{tikzpicture}{\NewDocumentCommand{\node}{o +m}{####2}}{}%
    \fi
    \begin{tikzpicture}
     % Expandimos despu√©s para poderle pasar el contenido de la macro como argumento opcional a \node.
     \expandafter\node\expandafter[\@DescripcionTIKZ]{%
      \ifbool{ExpAbajo}
       {\parbox[t][\textheight-\pagetotal-2\@SeparaInternaDescripcion-\@GrosorLineaDescripcion-\@SombraDescripcion]
        {\textwidth-2\@SeparaInternaDescripcion-\@GrosorLineaDescripcion-\@SombraDescripcion}}%
       {\parbox[t]{\textwidth-\@SombraDescripcion-2\@SeparaInternaDescripcion-2\@GrosorLineaDescripcion}}%
      {\setlength{\parindent}{0.5cm}%
       \setlength{\parskip}{2pt plus 8pt}%
       \ifbool{ExpAbajo}{\vfill}{}%
        #1%
       \ifbool{ExpAbajo}{\vfill}{}}}%
     \ifdim\@GrosorLineaDescripcion=0pt\else ;\fi% El fin del nodo va cuando hay el entorno tikzpicture original.
    \end{tikzpicture}
    \par\vspace*{\@SombraDescripcion}}}%
 \else
  \RenewEnviron{factura}{%
   \@ZERO
   \let\label\label@factura
   \let\@ITEM\@CalculaItem
   \BODY
   \@CalculaTotalesI}
  \RenewEnviron{reverso}{}
  \NewDocumentCommand{\Descripcion}{+m}{}
 \fi

 \if@reporte
  \ifdefvoid{\@InfoPagina}{\let\@InfoPagina\@InfoPaginaNoTitulo}{}%
  \if@factura
  \else
   \expandafter\geometry\expandafter{\@GeometriaReporte}%  La geometr√≠a del reporte debe aplicarse aqu√≠ cuando s√≥lo hay reporte, as√≠ se puede establecer el tama√±o del papel.
  \fi
  \NewEnviron{reporte}{%
   \if@factura
    \expandafter\newgeometry\expandafter{\@GeometriaReporte}\cleardoublepage%  La geometr√≠a debe aplicarse aqu√≠ cuando tambi√©n hay factura, pero no se puede cambiar el tama√±o del papel.
   \fi
   \let\headwidth\textwidth
   \@CargaFondoReporte
   \@EncabezadoReporte
   \ifdefvoid{\@EstiloPagReporteResto}{%
    \if@FondoReporteStar%  Si no usamos \EstiloPagReporte entonces se fijar√° 'soloabajo' cuando se use \FondoReporte* para que s√≥lo use marcas de pie de p√°gina, y si no se us√≥ \FondoReporte* entonces se fijar√° 'plain' que usa cabeceras y pies de p√°gina.
     \pagestyle{soloabajo}%
    \else
     \pagestyle{plain}%
    \fi}
    {\pagestyle{\@EstiloPagReporteResto}}%  Si usamos \EstiloPagReporte en su argumento obligatorio entonces fijamos ese estilo de p√°gina.
   \ifdefvoid{\@EstiloPagReporteUno}{%
    \if@FondoReporte%  Si no le damos a \EstiloPagReporte su argumento opcional, entonces se fijar√° 'solonumpag' como el estilo de p√°gina para la primera p√°gina, pero solamente si usamos \FondoReporte, ya que el estilo de p√°gina predeterminado al usar \FondoReporte* ya se acaba de fijar y no necesita el caso especial de la primera hoja (\thispagestyle).
     \if@FondoReporteStar
     \else
      \thispagestyle{solonumpag}%
     \fi
    \fi}
    {\thispagestyle{\@EstiloPagReporteUno}}%  Si usamoe el argumento opcional de \EstiloPagReporte establecemos ese estilo de p√°gina.
   \pagenumbering{arabic}%
   \setlength{\parindent}{0.666cm}%
   \setlength{\parskip}{4pt plus 6pt minus 2pt}% separaci√≥n entre p√°rrafos en el reporte.
   \vskip\baselineskip
   \BODY\clearpage}% espacio antes de empezar con el reporte, despu√©s del t√≠tulo -si lo hubiera-.
 \else
  \NewEnviron{reporte}{}
 \fi}

%% Comando para el dise√±o de la forma libre.
\newcommand{\@CargaFondoFactura}{%
 \if@FondoFactura
  \begin{textblock*}{\paperwidth}(0pt,0pt)%
   \includegraphics{\@FondoFactura}%
  \end{textblock*}%
 \fi}

%% Comando para el fondo del reporte.
\newcommand{\@CargaFondoReporte}{%
 \begin{textblock*}{\paperwidth}(0pt,0pt)% Tuve que abrir el textblock* aqu√≠ para que aplique siempre; de esta manera se corrige un defecto que se produce cuando se usa \vspace* al inicio de la p√°gina (dentro de \@EncabezadoReporte).
  \if@FondoReporte
   \if@FondoReporteStar
    \AddToShipoutPictureBG{\includegraphics{\@FondoReporte}}%
   \else
     \noindent\includegraphics{\@FondoReporte}%
   \fi
  \fi
 \end{textblock*}}

%% Comando que coloca los espacios para firmar.
\newcommand{\@PosicionaFirmas}{%
 \savebox{\@CajaFirmas}{%
  \parbox{\textwidth+\oddsidemargin+1in-\@PosFirmasXuno-\@PosFirmasXdos}{\@EstiloFirmas}}%
 \ifbool{FirmasYnegativo}{\addtolength{\@PosFirmasY}{\paperheight-\ht\@CajaFirmas-\dp\@CajaFirmas}}{}%
 \begin{textblock*}{\wd\@CajaFirmas}(\@PosFirmasXuno,\@PosFirmasY)%
  \usebox{\@CajaFirmas}%
 \end{textblock*}}

%% Comando que coloca la nota final.
\newcommand{\@PosicionaNotaFinal}{%
 \savebox{\@CajaNotaFinal}{%
  \parbox{\textwidth+\oddsidemargin+1in-\@PosNotaFinalXuno-\@PosNotaFinalXdos}{\@EscribeNotaFinal}}%
 \ifbool{NotaFinalYnegativo}{\addtolength{\@PosNotaFinalY}{\paperheight}}{}%
 \ifbool{NotaFinalYarriba}{\addtolength{\@PosNotaFinalY}{-\ht\@CajaNotaFinal-\dp\@CajaNotaFinal}}{}% Aqu√≠ la caja abre hacia abajo, a menos de que usemos \PosNotaFinal*
 \begin{textblock*}{\wd\@CajaNotaFinal}(\@PosNotaFinalXuno,\@PosNotaFinalY)%
  \usebox{\@CajaNotaFinal}%
 \end{textblock*}}

%% Comando que coloca el n√∫mero de control.
\newcommand{\@PosicionaNumControl}{%
 \savebox{\@CajaControl}{\@EstiloNumControl}%
 \ifbool{ControlXnegativo}{\addtolength{\@PosControlX}{\textwidth-\wd\@CajaControl}}{}%
 \ifbool{ControlYnegativo}{\addtolength{\@PosControlY}{\paperheight}}{}%
 \ifbool{ControlYarriba}{\addtolength{\@PosControlY}{-\ht\@CajaControl-\dp\@CajaControl}}{}%
 \begin{textblock*}{\wd\@CajaControl}(\@PosControlX,\@PosControlY)%
  \usebox{\@CajaControl}%
 \end{textblock*}}

%% Comando que coloca la denominaci√≥n del documento.
\newcommand{\@PosicionaDenom}{%
 \savebox{\@CajaDenom}{\@EstiloDenom}%
 \ifbool{DenomXnegativo}{\addtolength{\@PosDenomX}{\textwidth-\wd\@CajaDenom}}{}%
 \ifbool{DenomYnegativo}{\addtolength{\@PosDenomY}{\paperheight}}{}%
 \ifbool{DenomYarriba}{\addtolength{\@PosDenomY}{-\ht\@CajaDenom-\dp\@CajaDenom}}{}%
 \begin{textblock*}{\wd\@CajaDenom}(\@PosDenomX,\@PosDenomY)%
  \usebox{\@CajaDenom}%
 \end{textblock*}}

%% Comando que coloca la(s) fecha(s).
\newcommand{\@PosicionaFechas}{%
 \savebox{\@CajaFecha}{\@EstiloFechas}%
 \ifbool{FechaXnegativo}{\addtolength{\@PosFechaX}{\textwidth-\wd\@CajaFecha}}{}%
 \ifbool{FechaYnegativo}{\addtolength{\@PosFechaY}{\paperheight}}{}%
 \ifbool{FechaYarriba}{\addtolength{\@PosFechaY}{-\ht\@CajaFecha-\dp\@CajaFecha}}{}%
 \begin{textblock*}{\wd\@CajaFecha}(\@PosFechaX,\@PosFechaY)%
  \usebox{\@CajaFecha}%
 \end{textblock*}}

%% Comando que coloca la identificaci√≥n del reporte al inicio.
\newcommand{\@EscribeDatosReporte}{%
 {\@LetraEncReporte
  \setlength{\parindent}{0pt}%
  {\bfseries \@@Proveedor} \@Proveedor \par
  {\bfseries \@@Cliente} \@RazonSocial \par
  \ifdefvoid{\@Contacto}{}{{\bfseries \@@Contacto} \@Contacto \par}%
  \ifdefvoid{\@TituloReporte}{}{\vspace*{\baselineskip}{\@LetraTitReporte \centering \@TituloReporte \par}}}}

%% Comando que coloca las dos cajas del encabezado: la de los datos del cliente y la del resumen.
\newcommand{\@EscribeDatos}{%
 {\@LetraEncFactura% Abrimos un nuevo grupo para que el cambio de tipograf√≠a y la redefinici√≥n del entorno 'tikzpicture' sean locales.
  \ifdim\@GrosorLineaEncabezado=0pt%
   \setlength{\@SeparaInternaEncabezado}{0pt}\setlength{\@EsquinaLineaEncabezado}{0pt}\setlength{\@SombraEncabezado}{0pt}%
   \renewenvironment{tikzpicture}{\NewDocumentCommand{\node}{o +m}{####2}}{}%
  \fi
  \begin{tikzpicture}%
   \expandafter\node\expandafter[\@DatosTIKZ]{%
   \parbox{\textwidth-\@SombraEncabezado-2\@SeparaInternaEncabezado-\@GrosorLineaEncabezado}{\@DatosAux}}%
    \ifdim\@GrosorLineaEncabezado=0pt\else ;\fi
  \end{tikzpicture}%
  \par\vspace*{\@SombraEncabezado}}}%  Para que textblock* est√© en modo vertical.

\newcommand{\@EscribeDatosResumen}{%
 {\@LetraEncFactura% Abrimos un nuevo grupo para que el cambio de tipograf√≠a y la redefinici√≥n del entorno 'tikzpicture' sean locales.
  \ifdim\@GrosorLineaEncabezado=0pt%
   \setlength{\@SeparaInternaEncabezado}{0pt}\setlength{\@EsquinaLineaEncabezado}{0pt}\setlength{\@SombraEncabezado}{0pt}%
   \renewenvironment{tikzpicture}{\NewDocumentCommand{\node}{o +m}{####2}}{}%
  \fi
  \savebox{\@CajaDatos}{%
   \parbox[t]{\textwidth/2-\@SeparaDatosResumen/2-2\@SeparaInternaEncabezado-\@GrosorLineaEncabezado-\@SombraEncabezado}{\@DatosAux*}}%
  \savebox{\@CajaResumen}{%
   \parbox[t]{\textwidth/2-\@SeparaDatosResumen/2-2\@SeparaInternaEncabezado-\@GrosorLineaEncabezado-\@SombraEncabezado}{\@ResumenAux}}%
  \setlength{\@TamDatos}{\ht\@CajaDatos+\dp\@CajaDatos}%
  \setlength{\@TamResumen}{\ht\@CajaResumen+\dp\@CajaResumen}%
  \ifdim\@TamDatos>\@TamResumen
   \setlength{\@TamFinalEncabezado}{\@TamDatos}%
  \else
   \setlength{\@TamFinalEncabezadoado}{\@TamResumen}%
  \fi
  \begin{tikzpicture}%
   \expandafter\node\expandafter[\@DatosTIKZ]{%
    \parbox[t][\@TamFinalEncabezado]{\textwidth/2-\@SeparaDatosResumen/2-2\@SeparaInternaEncabezado-\@GrosorLineaEncabezado-\@SombraEncabezado}{%    
    \@DatosAux*}}%
   \ifdim\@GrosorLineaEncabezado=0pt\else ;\fi
  \end{tikzpicture}%
  \hspace*{\@SeparaDatosResumen}\hspace*{\@SombraEncabezado}%
  \begin{tikzpicture}%
   \expandafter\node\expandafter[\@ResumenTIKZ]{%
    \parbox[t][\@TamFinalEncabezado]{\textwidth/2-\@SeparaDatosResumen/2-2\@SeparaInternaEncabezado-\@GrosorLineaEncabezado-\@SombraEncabezado}{%
     \@ResumenAux}}%
   \ifdim\@GrosorLineaEncabezado=0pt\else ;\fi
  \end{tikzpicture}%
  \par\vspace*{\@SombraEncabezado}}}%  El \par es para que textblock* est√© en modo vertical.

%% Comando que coloca la caja para la nota previa, con la posibilidad de TikZ.
\newcommand{\@EscribeNotaPrevia}{%
 {% Abrimos un nuevo grupo para que la redefinici√≥n del entorno 'tikzpicture' sea local.
  \baselineskip0pt
  \ifdefvoid{\@NotaPrevia}{}{%
   \ifdim\@GrosorLineaNotaPrevia=0pt%
    \setlength{\@SeparaInternaNotaPrevia}{0pt}\setlength{\@EsquinaLineaNotaPrevia}{0pt}\setlength{\@SombraNotaPrevia}{0pt}%
    \renewenvironment{tikzpicture}{\NewDocumentCommand{\node}{o +m}{####2}}{}%
   \fi
   \begin{tikzpicture}%
    \expandafter\node\expandafter[\@NotaPreviaTIKZ]{%
    \parbox{\textwidth-\@SombraNotaPrevia-2\@SeparaInternaNotaPrevia-\@GrosorLineaNotaPrevia}{\@EstiloNotaPrevia}}%
     \ifdim\@GrosorLineaNotaPrevia=0pt\else ;\fi
   \end{tikzpicture}%
   \par\vspace*{\@SombraNotaPrevia}\vspace*{\@SeparaVertical}%
   \ifexpandecuadro\else\vfill\fi}}}

%% Comando que coloca la caja para la nota final, con la posibilidad de TikZ.
\newcommand{\@EscribeNotaFinal}{%
 {% Abrimos un nuevo grupo para que la redefinici√≥n del entorno 'tikzpicture' sea local.
  \ifdim\@GrosorLineaNotaFinal=0pt%
   \setlength{\@SeparaInternaNotaFinal}{0pt}\setlength{\@EsquinaLineaNotaFinal}{0pt}\setlength{\@SombraNotaFinal}{0pt}%
   \renewenvironment{tikzpicture}{\NewDocumentCommand{\node}{o +m}{####2}}{}%
  \fi
  \begin{tikzpicture}%
   \expandafter\node\expandafter[\@NotaFinalTIKZ]{%
   \parbox{\textwidth-\@PosNotaFinalXuno-\@PosNotaFinalXdos+\oddsidemargin+1in-\@SombraNotaFinal-2\@SeparaInternaNotaFinal-\@GrosorLineaNotaFinal}{\@EstiloNotaFinal}}%
    \ifdim\@GrosorLineaNotaFinal=0pt\else ;\fi
  \end{tikzpicture}%
  \par\vspace*{\@SombraNotaFinal}}}

%% Comandos auxiliares para los datos y el resumen.
%% En el caso de los datos, la versi√≥n \@DatosAux se ejecuta cuando no hay resumen, y la versi√≥n \@DatosAux* se ejecuta cuando hay resumen.
\NewDocumentCommand{\@DatosAux}{s}{%
 \hfill {\@LetraTitEnc \@@Datos}\hfill \mbox{}\par
 \IfBooleanT{#1}{\vfill}%
 {\bfseries \if@Nombre \@@Nombre \else \@@RazonSocial \fi} \@RazonSocial
 \IfBooleanTF{#1}{\par}{\dotfill}%
 {\bfseries \@@RIF} {\ttfamily \@RIF}\par
 \ifdefvoid{\@Contacto}{}{{\bfseries \@@Contacto} \@Contacto \par}%
 {\bfseries \@@Direccion} \@Direccion \par
 \ifdefvoid{\@Telefono}{}{{\bfseries \@@Telefono} {\ttfamily \@Telefono}}%
 \ifdefvoid{\@Email}
  {\par}
  {\IfBooleanTF{#1}
   {\par}
   {\ifdefvoid{\@Telefono}{}{\hspace*{\@SeparaTelefonoEmail}\@CaracterSeparaTelefonoEmail\hspace*{\@SeparaTelefonoEmail}}}%
  {\bfseries \@@Email} {\ttfamily \@Email}}%
 \IfBooleanT{#1}{\vfill}}

\newcommand{\@ResumenAux}{\hfill {\@LetraTitEnc \@@Resumen}\hfill \mbox{}\vfill\@Resumen\vfill}

%% Comando que coloca la l√≠nea diagonal.
\newcommand{\@DibujaLinea}{%
 \setlength{\@LineaNodoXo}{\zposx{LineaNodoACoordX} sp}%
 \setlength{\@LineaNodoYo}{\zposy{LineaNodoBCoordY} sp}%
 \setlength{\@LineaNodoXf}{\zposx{LineaNodoBCoordX} sp}%
 \setlength{\@LineaNodoYf}{\zposy{LineaNodoBCoordY} sp}%
 \addtolength{\@LineaNodoYo}{\@EspacioVacioInicial-\@EspacioVacioFinal}%
 \if@LineaDesdeInicio
  \addtolength{\@LineaNodoXo}{-\tabcolsep@@}%
 \fi
 \if@LineaHastaFinal
  \addtolength{\@LineaNodoXf}{\tabcolsep@@}%
 \fi
 \iffilas
  \addtolength{\@LineaNodoYf}{-.3\baselineskip@@}%
  \if@LineaDescripcion
   \addtolength{\@LineaNodoXo}{-\tabcolsep@@}%
   \addtolength{\@LineaNodoXf}{\tabcolsep@@}%
  \fi
 \else
  \ifsintotales
  \addtolength{\@LineaNodoYf}{-.3\baselineskip@@}%
  \else
   \if@DescG \addtolength{\@LineaNodoYo}{2\baselineskip@@}\fi
   \if@DescR \if@BIR \addtolength{\@LineaNodoYo}{2\baselineskip@@}\fi\fi
   \if@DescA \if@BIA \addtolength{\@LineaNodoYo}{2\baselineskip@@}\fi\fi
   \if@DescE \if@Exento \addtolength{\@LineaNodoYo}{2\baselineskip@@}\fi\fi
   \addtolength{\@LineaNodoYo}{\baselineskip@@}%
   \addtolength{\@LineaNodoYf}{-.3\baselineskip@@}%
   \ifsinivaexpresado
   \else
    \addtolength{\@LineaNodoYo}{2\baselineskip@@}%
    \if@BIR\addtolength{\@LineaNodoYo}{2\baselineskip@@}\fi
    \if@BIA\addtolength{\@LineaNodoYo}{2\baselineskip@@}\fi
    \if@Exento\addtolength{\@LineaNodoYo}{\baselineskip@@}\fi
   \fi
  \fi
 \fi
 \iflinea
  \begin{textblock*}{\paperwidth-\@LineaNodoXo}(\@LineaNodoXo,\paperheight-\@LineaNodoYo)%
   \begin{tikzpicture}%
    \draw (\@LineaNodoXo,\@LineaNodoYo) -- (\@LineaNodoXf,\@LineaNodoYf);%
   \end{tikzpicture}%
  \end{textblock*}%
 \fi}

%% Escribimos los totales al archivo csv.
\newcommand{\@EscribeTotalesEnCSV}{%
 \ifcsv
  \if@Exento
   \if@DescE
    \immediate\write\csv{Totales: \@@SubtotalE: \Moneda \SubtE^^JTotales: \@@DescuentoE: \Moneda \DescE}%
   \fi
   \immediate\write\csv{Totales: \@@BIE: \Moneda \BIE}%
  \fi
  \if@BIR
   \if@DescE
    \immediate\write\csv{Totales: \@@SubtotalR: \Moneda \SubtR^^JTotales: \@@DescuentoR: \Moneda \DescR}%
   \fi
   \immediate\write\csv{Totales: \@@BIR: \Moneda \BIR^^JTotales: \@@AlicuotaR: \Moneda \AlicuotaR}%
  \fi
  \if@DescG
   \immediate\write\csv{Totales: \@@SubtotalG: \Moneda \SubtG^^JTotales: \@@DescuentoG: \Moneda \DescG}%
  \fi
  \immediate\write\csv{Totales: \@@BIG: \Moneda \BIG^^JTotales: \@@AlicuotaG: \Moneda \AlicuotaG}%
  %% (quitado por no vigente)
  % \FPifeq\AlicuotaGDesc{0}\else\immediate\write\csv{Totales: \@@AlicuotaGDesc: \Moneda \AlicuotaGDesc}\fi
  \if@BIA
   \if@DescA
    \immediate\write\csv{Totales: \@@SubtotalA: \Moneda \SubtA^^JTotales: \@@DescuentoA: \Moneda \DescA}%
   \fi
   \immediate\write\csv{Totales: \@@BIA: \Moneda \BIA^^JTotales: \@@AlicuotaA: \Moneda \AlicuotaA}%
  \fi
  \immediate\write\csv{Totales: \@@Total: \Moneda \Total}%
  \immediate\closeout\csv
 \fi}

%% Hubo que redefinir \cleardoublepage agreg√°ndole \thispagestyle{empty} porque si no queda una p√°gina en blanco con cabeceras de p√°gina usando twoside.
\def\cleardoublepage{%
 \clearpage
 \if@twoside
  \ifodd\c@page
   \else
    \hbox{}\thispagestyle{empty}\newpage
    \if@twocolumn
     \hbox{}\newpage
    \fi
   \fi
 \fi}

%</class>
%<*def>
%% Dise√±o hecho en TikZ para los datos del cliente, el resumen, la nota previa, la descripci√≥n y la nota final.
\def\@DatosTIKZ{%
 draw=black, fill=white, inner sep=\@SeparaInternaEncabezado, line width=\@GrosorLineaEncabezado, rounded corners=\@EsquinaLineaEncabezado, copy shadow={top color=black, bottom color=black, shadow xshift=\@SombraEncabezado, shadow yshift=-\@SombraEncabezado}}

\let\@ResumenTIKZ\@DatosTIKZ

\def\@NotaPreviaTIKZ{%
 draw=black, fill=white, inner sep=\@SeparaInternaNotaPrevia, line width=\@GrosorLineaNotaPrevia, rounded corners=\@EsquinaLineaNotaPrevia, copy shadow={top color=black, bottom color=black, shadow xshift=\@SombraNotaPrevia, shadow yshift=-\@SombraNotaPrevia}}

\def\@DescripcionTIKZ{%
 draw=black, fill=white, inner sep=\@SeparaInternaDescripcion, line width=\@GrosorLineaDescripcion, rounded corners=\@EsquinaLineaDescripcion, copy shadow={top color=black, bottom color=black, shadow xshift=\@SombraDescripcion, shadow yshift=-\@SombraDescripcion}}

\def\@NotaFinalTIKZ{%
 draw=black, fill=white, inner sep=\@SeparaInternaNotaFinal, line width=\@GrosorLineaNotaFinal, rounded corners=\@EsquinaLineaNotaFinal, copy shadow={top color=black, bottom color=black, shadow xshift=\@SombraNotaFinal, shadow yshift=-\@SombraNotaFinal}}

%% El dise√±o de las distintas partes de la hoja.
\newcommand{\@EstiloFirmas}{
 \@LetraFirmas
 \ifnum \value{@Firmas}=1
 \else
  \parbox{\@TamLineaFirmas}{
   \rule{\@TamLineaFirmas}{\@GrosorLineaFirmas}
   \centering \ifdefvoid{\@Conforme}{\@@Conforme}{\@Conforme}}
 \fi
 \hfill
 \parbox{\@TamLineaFirmas}{
  \rule{\@TamLineaFirmas}{\@GrosorLineaFirmas}
  \centering \ifdefvoid{\@Emisor}{\ifcotizacion \@@Emisor \else \@@Pagado \fi}{\@Emisor}}}

\newcommand{\@EstiloNotaPrevia}{\@LetraNotaPrevia \@NotaPrevia}

\newcommand{\@EstiloNotaFinal}{\@LetraNotaFinal \@NotaFinal}

\newcommand{\@EstiloNumControl}{%
 \renewcommand{\baselinestretch}{0}\selectfont
 \begin{tabular}{@{\extracolsep{0pt}}l}
  \@LetraDenom \@@Control \\[.4em]
  {\@LetraDenom\@NumSerieControl-}\space\@LetraNumeracion\@NumControl \\
 \end{tabular}}

\newcommand{\@EstiloDenom}{%
 \@LetraDenom\@Denominacion
 \ifsinnumero
 \else
  \space\space{\@LetraNumeracion N\textordmasculine\space\@Num}%
 \fi}

\newcommand*{\@EstiloFechas}{%
 \renewcommand{\baselinestretch}{0}%
 \setlength{\tabcolsep}{0pt}%
 \@LetraFecha\begin{tabular}{r@{\extracolsep{1ex}}l@{\extracolsep{0pt}}}
 \@@Fecha & \ttfamily\@Fecha \\[.3em]
 \ifvencimiento \@@FechaVencimiento & \ttfamily\@FechaVencimiento \\ \else \vspace*{-.3em}\fi
 \end{tabular}}

\newcommand{\@InfoPaginaNoTitulo}{\@LetraInfoPagina Reporte correspondiente a la factura n\'umero \@Num \space de fecha \@Fecha}

\newcommand{\@InfoPaginaTitulo}{\@LetraInfoPagina \@TituloReporte \space - \@Proveedor \space - \@Fecha}

%% Estilos de p√°gina: normal, s√≥lo cabeceras, s√≥lo pies de p√°gina y s√≥lo n√∫mero de p√°gina al pie.
\fancypagestyle{plain}{%
 \expandafter\ps@fancy
 \fancyhf{}%
 \renewcommand{\headrulewidth}{\@GrosorLineaInfoPag}%
 \fancyhead[LEO]{\@InfoPagina}%
 \fancyfoot[C]{\thepage}}

\fancypagestyle{soloarriba}{%
 \expandafter\ps@fancy
 \fancyhf{}%
 \renewcommand{\headrulewidth}{\@GrosorLineaInfoPag}%
 \fancyhead[LO]{\@InfoPagina}%
 \fancyhead[RO]{\thepage}%
 \if@twoside
  \fancyhead[LE]{\thepage}%
  \fancyhead[RE]{\@InfoPagina}%
 \fi}

\fancypagestyle{soloabajo}{%
 \expandafter\ps@fancy
 \fancyhf{}%
 \renewcommand{\headrulewidth}{0pt}%
 \fancyfoot[LO]{\@InfoPagina}%
 \fancyfoot[RO]{\thepage}%
 \if@twoside
  \fancyfoot[RE]{\@InfoPagina}%
  \fancyfoot[LE]{\thepage}%
 \fi}

\fancypagestyle{solonumpag}{%
 \expandafter\ps@fancy
 \fancyhf{}%
 \renewcommand{\headrulewidth}{0pt}%
 \fancyfoot[C]{\thepage}}

%</def>
%<*!class&!def&!firma&!fondo&!membrete&!aux&!batchfile>
%% Descripci√≥n de este ejemplo:
%
%%<desc>
%<beispiel>%%  Adaptado a otra legislaci√≥n
%<factuno|factdos|facttres|factcuatro|factcinco|factseis|factsiete|factocho|factnueve|factdiez|repuno|repdos>%%  Escribimos una factura
%<reptres>%%  No escribimos factura ni usamos las macros que definen valores para su uso
%<factnueve|factdiez|repuno>%%  Escribimos en el reverso de la factura
%<prefac|beispiel>%%  (prefactura) Escribimos una prefactura
%<cotiza>%%  (cotizacion) Escribimos una cotizaci√≥n
%<repuno|repdos|reptres>%%  Escribimos un reporte
%<repuno>%%  (sinreverso) Escribimos el reverso de la factura pero s√≥lo producimos su anverso
%<repuno>%%  (conreporte) Generamos factura y reporte
%<repdos>%%  (soloreporte) Escribimos factura y reporte, pero s√≥lo producimos el reporte
%<reptres>%%  (soloreporte) Generamos solamente el reporte
%<factcinco|factocho>%%  Escribimos factura y reporte, pero s√≥lo producimos la factura
%
%<factdiez>%%  Establecemos algunas opciones de la clase a trav√©s de comandos
%
%<factuno>%%  Hacemos una factura b√°sica con todo en sus valores por omisi√≥n, no ajustamos nada
%
%<reptres>%%  (twoside) El reporte se imprime en las dos caras del papel
%
%<factcinco>%%  (sincantidad) Cuadro de la factura sin la columna de cantidades
%<factdos|factseis>%%  (numitem) Con la columna para enumerar los √≠tems
%<factdos|factseis>%%  (descuentos) Con la columna para descuentos individuales
%<factseis>%%  (subtotal) Con la columna extra para subtotal
%<factcinco>%%  (iva) Con la columna para el IVA
%
%<facttres>%%  (agrupado) Agrupados los totales por tipo y no por gravamen
%<factcuatro|factcinco|factsiete>%%  (filas) Totalizaci√≥n en modo de filas
%<factsiete>%%  (centrado) Centrados los totales en el modo de filas
%
%<factdos>%%  (dcu) Primero la descripci√≥n, luego la cantidad, luego el precio unitario
%<factcuatro>%%  (duc) Primero la descripci√≥n, luego el precio unitario, luego la cantidad
%<factcinco|factseis|factsiete>%%  (denom) Escribe la denominaci√≥n (‚ÄúFACTURA‚Äù) y el n√∫mero
%<cotiza>%%  (sinnumero) Escribe la denominaci√≥n (‚ÄúCOTIZACI√ìN‚Äù) pero sin n√∫mero
%<cotiza>%%  (sintotales) No totaliza, para que el cliente tenga un presupuesto por distintos √≠tems que luego elegir√° entre ellos, es decir, una lista de precios
%
%<factdos|factseis>%%  (sinlineasve) Sin l√≠neas verticales externas
%<facttres|factcuatro>%%  (sinlineasvi) Sin l√≠neas verticales internas
%<factdiez>%%  (sinlineasv) Sin l√≠neas verticales
%<factdos>%%  (sinlineahtot) Sin l√≠nea horizontal interna despu√©s de los √≠tems y antes de los totales
%<factcuatro>%%  (sinlineahtit) Sin l√≠nea horizontal interna despu√©s del t√≠tulo de las columnas
%<factseis>%%  (sinlineashi) Sin l√≠neas horizontales internas
%<factsiete>%%  (sinlineashe) Sin l√≠neas horizontales externas
%<factnueve>%%  (sinlineahni)  Sin l√≠nea horizontal interna despu√©s de la nota interna.
%<factdiez>%%  (sinlineash) Sin l√≠neas horizontales
%<facttres|factcinco>%%  (conlineasha) Separado cada √≠tem con una l√≠nea horizontal
%
%<factcinco|factocho>%%  (sinexpandir) Sin expandir el cuadro de la factura ni la descripci√≥n
%<facttres|factcuatro|prefac>%%  (expandecuadro) Expande el cuadro de la factura con espacio en blanco
%<prefac|factcuatro>%%  (linea) Con l√≠nea para inutilizar el espacio en blanco
%
%<facttres>%%  (impdesc) Con el tipo de impuesto como parte de la descripci√≥n y no de los precios
%<factdos>%%  (centradesc) Centra la descripci√≥n en los elementos en la factura
%<factsiete>%%  (sinmarcas) Cuando la descripci√≥n de un √≠tem ocupa m√°s que una l√≠nea, no pone el car√°cter que indica continuaci√≥n en la siguiente l√≠nea ni los caracteres en las columnas vac√≠as
%<factcinco|factseis|factsiete>%%  (todosiva) Forzando a totalizar todos los IVA as√≠ no existan productos gravados con ellos
%<factnueve>%%  (G) Escribiendo una letra ‚ÄòG‚Äô en los √≠tems gravados con IVA general as√≠ sea el √∫nico gravamen a facturar
%<factdiez>%%  (sinmonedatotales) No agrega el s√≠mbolo monetario en los totales
%<factocho>%%  (siniva) Sin IVA
%<factdos>%%  (unafirma) S√≥lo la firma del emisor
%<facttres>%%  (sinfirmas) Sin firmas
%<factdiez>%%  (vencimiento) Con fecha de vencimiento expl√≠cita as√≠ no haya cr√©dito
%
%<factocho>%%  (csv) Escribe un archivo CSV con la informaci√≥n num√©rica de la factura
%<beispiel>%%  (nospanish) Sin cargar babel en castellano, ni la codificaci√≥n T1 para la tipograf√≠as
%
%<factdos|factcuatro>%%  Usando \Nombre y \CI en lugar de \RazonSocial y \RIF
%<factdos|factcuatro|reptres>%%  Sin especificar la persona de contacto
%<factcinco|factseis>%%  Sin especificar el tel√©fono del cliente
%<factcuatro|factseis>%%  Sin especificar el e-mail del cliente
%<factcinco|repuno>%%  (\Emisor) Especificando el nombre del emisor de la factura
%<factcinco|factseis>%%  (\Conforme) Especificando el nombre de quien firma la copia de la factura como recibida
%<repuno>%%  Sin especificar el proveedor, as√≠ toma el emisor de la factura como el nombre del proveedor
%<repdos|reptres>%%  (\Proveedor) Especificando el nombre del proveedor para el encabezado del reporte
%
%<facttres>%%  Sin especificar fecha para que tome la fecha del d√≠a.
% %<factnueve>%%  Con nota interna autom√°tica por el descuento en pagos electr√≥nicos.
% %<factdiez>%%  Con nota interna autom√°tica con el monto en Bs.F dada la fecha de emisi√≥n de la factura antes de que a la moneda se le quitara el adjetivo ‚Äúsoberano‚Äù.
%
%<factcuatro>%%  (\Fecha*) Suministrando la fecha seg√∫n formato de datetime2 sin alterar c√≥mo sale escrita
%<facttres>%%  (\FormatoFecha) Cambiando el separador de la fecha para que salga escrita dd/mm/yyyy
%<factcinco>%%  (\FormatoFecha) Suministrando la fecha seg√∫n el formato yyyymmdd pero que salga escrita dd.mm.yyyy
%<factseis>%%  (\FormatoFecha) Cambiando el formato para que la fecha salga escrita en el formato default de datetime2 pero cambiando el separador yyyy/mm/dd
%<factocho>%%  Redefiniendo el formato de la fecha (redefiniendo macros \@@Fecha y \@EstiloFecha)
%
%<factnueve>%%  (\Credito) Especificando la cantidad de d√≠as para el cr√©dito
%<facttres>%%  (\DescuentoE y \DescuentoG) Con descuentos totales en porcentajes para exentos y gravables con IVA general
%<factocho>%%  (\Descuento*) Con descuentos totales en dinero neto (y no en porcentajes) aplicables por igual a todos los tipos de elementos existentes
%<prefac>%%  (\Descuento) Con descuentos totales en porcentaje aplicables por igual a todos los tipos de elementos existentes
%
%<factsiete>%%  Redefiniendo el texto para la cantidad (redefiniendo macro \@@Cantidad)
%
%<factsiete>%%  (\GeometriaFactura) Cambiando la geometr√≠a del papel de la factura
%<factdiez>%%  (\GeometriaReverso) Cambiando la geometr√≠a del reverso de la factura
%<repdos>%%  (\GeometriaReporte) Cambiando la geometr√≠a del papel del reporte
%<prefac|cotiza>%%  (\FondoFactura) Con el fondo de la imprenta agregado
%<repuno>%%  (\FondoReporte) Especificamos el fondo o membrete del reporte, s√≥lo para la primera p√°gina
%<repdos>%%  (\FondoReporte*) Especificamos el fondo o membrete del reporte para todas las p√°ginas
%<reptres>%%  Sin especificar fondo de reporte
%<repuno>%%  (\InicioReporte) Estableciendo un margen superior distinto para la primera p√°gina del reporte por presencia de membrete
%<repuno|reptres>%%  (\TituloReporte) Establecemos el t√≠tulo del reporte sin que salga en las cabeceras ni pies de p√°gina
%<repdos>%%  (\TituloReporte*) Establecemos el t√≠tulo del reporte para que salga en las cabeceras o pies de p√°gina
%<reptres>%%  (\InfoPagina) Personalizamos la informaci√≥n de la cabecera del reporte y mostramos el nombre del proveedor all√≠
%<reptres>%%  (\EstiloPagReporte) Cambiamos el estilo de p√°gina para que la informaci√≥n del reporte aparezca como pie de p√°gina
%<cotiza>%%  (\FirmaFactura) Agregando la firma escaneada en la factura, es decir, en la cotizaci√≥n
%
%<factdos|facttres|factsiete>%%  (\SepVertical) Alterando la separaci√≥n m√≠nima vertical entre los elementos
%<factdos|factcinco>%%  (\SepDatosResumen) Alterando la separaci√≥n horizontal entre los datos del cliente y el resumen
%<factdos|facttres|factseis>%%  (\SepEncabezado) Alterando el margen interno desde el contorno hasta el texto en el encabezado
%<factnueve>%%  (\SepNotaPrevia) Alterando el margen interno desde el contorno hasta el texto en la nota previa
%<factdos|factseis>%%  (\SepDescripcion) Alterando la distancia desde el contorno hasta el texto en la descripci√≥n
%<factnueve>%%  (\SepNotaFinal) Especificando la distancia desde el contorno hasta el texto de la nota final, predeterminadamente sin contorno
%<factdos|factcuatro>%%  (\SepItemsExtra) Agregando una separaci√≥n extra entre los √≠tems en la factura
%<factsiete>%%  (\SepFilas) Alterando la separaci√≥n horizontal y vertical entre los totales en el modo de filas
%<facttres|factsiete>%%  (\LineaEncabezado) Alterando la l√≠nea de las cajas del encabezado, la curvatura en la esquina y la sombra
%<factdiez>%%  (\LineaNotaPrevia) Alterando la l√≠nea de la nota previa, para desaparecerla
%<factdos|factsiete>%%  (\LineaDescripcion) Alterando la l√≠nea de la descripci√≥n, la curvatura en la esquina y la sombra
%<factnueve>%%  (\LineaNotaFinal) Agregando el contorno para la nota final que predeterminadamente est√° deshabilitado
%<factsiete>%%  (\LineaFirmas) Alterando la longitud de las l√≠neas para firmar y su grosor
%<factsiete>%%  (\PosFecha, \PosFirmas y \PosDenom) Alterando la posici√≥n de la fecha, las firmas y de la denominaci√≥n del documento
%<factnueve>%%  (\PosNotaFinal) Alterando la posici√≥n de la nota final
%<factcuatro|factocho>%%  (\Letra***) Cambiando varias de las tipograf√≠as
%
%<!factcuatro&!reptres>%%  (\NotaFinal) Con nota final
%<factnueve>%%  Haciendo menci√≥n a las fechas y al cr√©dito en la nota final
%<factcuatro>%%  Sin nota final
%<factuno|factdos|factcinco|factocho>%%  (\Resumen) Con resumen
%<facttres|factcuatro|factseis|factsiete|prefac|cotiza|repuno|repdos>%%  Sin resumen
%<factcuatro|factnueve|factdiez>%%  (\NotaPrevia) Con nota previa
%<factocho|factnueve>%%  (\NotaInterna) Con nota interna
%<factnueve>%%  (\NotaExterna) Con nota externa
%
%<factdos|facttres>%%  Con art√≠culos gravados con todos los IVA
%<factseis|factsiete|factocho>%%  Escribimos un √≠tem cuya descripci√≥n ocupa m√°s que una l√≠nea
%<factdos|factcuatro|factcinco>%%  (\ItemX) Agregando un √≠tem sin precio
%
%<!facttres&!reptres&!beispiel>%%  (\Descripcion) Con descripci√≥n larga
%<facttres|reptres>%%  Sin descripci√≥n larga
%
%<factseis|repdos>%%  Con etiquetas y referencias
%
%<repuno>%%  (\FirmaReporte) Agregando en el reporte la l√≠nea para firmar a mano
%<factocho|repdos|reptres>%%  (\FirmaReporte) Agregando la firma escaneada en el reporte
%<factocho|repdos|reptres>%%  Con \FirmaReporte, ajustando el corrimiento en ‚Äúy‚Äù de la firma respecto a la l√≠nea
%<repdos|reptres>%%  Con \FirmaReporte, cambiando la ubicaci√≥n en ‚Äúx‚Äù de la l√≠nea de la firma y cambiando la longitud de la l√≠nea hacia los lados
%<reptres>%%  Con \FirmaReporte, cambiando el nombre de la persona que va a firmar
%%</desc>
%%
%<factuno>\documentclass{factura}
%<!factuno>\documentclass[
%<prefac|beispiel>prefactura,
%<cotiza>cotizacion,
%<repuno>sinreverso,
%<repuno>conreporte,
%<repdos|reptres>soloreporte,
%<beispiel>nospanish,
%<reptres>twoside,
%<factcinco>sincantidad,
%<factdos|factseis>numitem,
%<factdos|factseis>descuentos,
%<factseis>subtotal,
%<factcinco>iva,
%<factcuatro|factcinco|factsiete>filas,
%<factdiez>filas, % luego queda sin efecto con \filasfalse en el pre√°mbulo
%<factsiete>centrado,
%<facttres>agrupado,
%<factcinco|factseis|factsiete>denom,
%<cotiza>sinnumero, % sin esta opci√≥n aparecer√° el n√∫mero de la cotizaci√≥n.
%<cotiza>sintotales,
%<factdos>dcu,
%<factcuatro>duc,
%<factdos|factseis>sinlineasve,
%<facttres|factcuatro>sinlineasvi,
%<factdos>sinlineahtot,
%<factcuatro>sinlineahtit,
%<factseis>sinlineashi,
%<factsiete>sinlineashe,
%<factnueve>sinlineahni,
%<facttres|factcinco>conlineasha,
%<factcinco|factocho>sinexpandir,
%<facttres|factcuatro|prefac>expandecuadro,
%<factcuatro|prefac>linea,
%<facttres>impdesc,
%<factdos>centradesc,
%<factsiete>sinmarcas,
%<factcinco|factseis|factsiete>todosiva,
%<factnueve>G,
%<factdiez>sinmonedatotales,
%<factocho>siniva,
%<factnueve>% electro,
%<factdos>unafirma,
%<prefac|cotiza>% dosfirmas, % para poner las dos firmas.
%<prefac>% unafirma, % para poner la firma del emisor.
%<cotiza>% sinfirmas, % para no poner firmas.
%<facttres>sinfirmas,
%<factdiez>vencimiento,
%<factocho>csv,
%<factdiez>csv, % luego queda sin efecto con \csvfalse en el pre√°mbulo
%<!factuno>]{factura}

%<factdiez>% Cambiamos por aqu√≠ como condicionales las opciones de la clase; es lo mismo que arriba en \documentclass.
%<factdiez>\sinlineasvtrue \sinlineashtrue \filasfalse \csvfalse
%<factdiez>
\input{factura-ejemplo-aux.tex}% Se incluye para efectos del ejemplo, as√≠ tendremos disponible la macro \Ejemplo.
\usepackage[utf8]{inputenc}
%<beispiel>\usepackage[official]{eurosym}
%<beispiel>\usepackage[ngerman]{babel}
%<beispiel>\usepackage[T1]{fontenc}
%<beispiel>
%<beispiel>\Moneda{\euro{}}
%<beispiel>\makeatletter
%<beispiel>\def\@AlicuotaG{0.19}
%<beispiel>\def\@AlicuotaR{0.07}
%<beispiel>\def\@DenomAlicuotaG{A}
%<beispiel>\def\@DenomAlicuotaR{C}
%<beispiel>\def\@DenomAlicuotaE{B}
%<beispiel>\def\@@Datos{Kundenidentifikation}
%<beispiel>\def\@@Resumen{Zusammenfassung}
%<beispiel>\def\@@Fecha{Datum:}
%<beispiel>\def\@@Nombre{Kunde:} \def\@@RazonSocial{Kunde:}
%<beispiel>\def\@@RIF{USt-IdNr:} \def\@@CT{USt-IdNr:}
%<beispiel>\def\@@Contacto{Kontactperson:}
%<beispiel>\def\@@Direccion{Adresse:}
%<beispiel>\def\@@Telefono{Telefon:}
%<beispiel>\def\@@Email{E-mail:}
%<beispiel>\def\@@Cliente{Kunde:}
%<beispiel>\def\@@Proveedor{Lieferant:}
%<beispiel>\def\@@Cantidad{Menge}
%<beispiel>\def\@@Descripcion{Beschreibung}
%<beispiel>\def\@@PrecioU{Einzelpreis}
%<beispiel>\def\@@PrecioT{Gesamt}
%<beispiel>\def\@@Precio{Preis}
%<beispiel>\def\@@AlicuotaG{MwSt A}
%<beispiel>\def\@@AlicuotaR{MwSt C}
%<beispiel>\def\@@BIG{Netto 19\%}
%<beispiel>\def\@@BIR{Netto 7\%}
%<beispiel>\def\@@BIE{Mwst-befreit}
%<beispiel>\def\@@Total{Brutto}% Zu zahlen / Brutto / Summe / Gesamt
%<beispiel>\def\@@Conforme{der Kunde}
%<beispiel>\def\@@DenomFactura{Rechnung}
%<beispiel>\def\@@DenomCotiza{Voranschlag}
%<beispiel>
%<beispiel>\renewcommand{\@EstiloDenom}{\@LetraDenom\@Denominacion-\ifsinnumero\else\@LetraNumeracion Nr:\space\@Num\fi}
%<beispiel>\renewcommand{\@EstiloNumControl}{}
%<beispiel>\makeatother

%<factcinco|factseis|factsiete|cotiza|prefac|repuno|repdos|beispiel>\Num{1}
%<prefac>% \NumControl{1001}
%<prefac>% \NumSerieControl{9}
%<!factdos&!factcuatro&!beispiel>\RazonSocial{Ayala San Vicente Usureros}
%<factdos|factcuatro|beispiel>\Nombre{Jacinto de Ayala y San Vicente}
%<!factdos&!factcuatro&!beispiel&!reptres>\RIF{Y-12.345.678-9}
%<factdos|factcuatro|beispiel>\CI{V-987.654.321}
%<!factdos&!factcuatro&!reptres&!beispiel>\Contacto{Jacinto de Ayala}
%<!reptres>\Direccion{Av. Ayala, Galp√≥n San Vicente, Sector Arauca, Apure, Venezuela}
%<!factcinco&!factseis&!reptres>\Telefono{+58 (987) 654.32.10}
%<!factcuatro&!factseis&!reptres>\Email{jacinto@ayala.sv}
%<factcinco|repuno>\Emisor{L√°zaro de la Vega}
%<factcinco>\Conforme{\Contacto}
%<factseis>\Conforme{Ramela San Vicente}
%<repdos|reptres>\Proveedor{L√°zaro de la Vega y San Rom√°n}

%<factcinco>\FormatoFecha[yyyymmdd]{ddmmyyyy}{.}
%<facttres>\FormatoFecha{ddmmyyyy}{/}
%<factseis>\FormatoFecha{default}{/}
%<!facttres&!factcuatro&!factcinco>\Fecha{06-11-2019}
%<factcuatro>\Fecha*{2019}{06}{11}
%<factcinco>\Fecha{20191106}
%<factsiete|factocho>
%<factsiete|factocho>\makeatletter
%<factocho> \renewcommand{\@@Fecha}{\slshape FECHA:}
%<factocho> \renewcommand{\@EstiloFechas}{\@LetraFecha\bfseries\@@Fecha\space{\color{blue}\@Fecha}}
%<factsiete> \renewcommand{\@@Cantidad}{Cant.}
%<factsiete|factocho>\makeatother
%<factnueve>\Credito{11}

%<prefac>\Descuento{18}
%<facttres>\DescuentoE{15}
%<facttres>\DescuentoG{20}
%<factocho>\Descuento*{300}
%<prefac|facttres|factocho>
%<factsiete>\GeometriaFactura{legalpaper,vmargin={5cm,5.5cm},hmargin={1cm,1cm},footskip=0pt,headsep=0pt,headheight=0pt}
%<factdiez>\GeometriaReverso{vmargin={4cm,4cm},hmargin={4cm,4cm},footskip=0pt,headsep=0pt,headheight=0pt}
%<repdos>\GeometriaReporte{vmargin={4.4cm,2.5cm},hmargin={3cm,2cm},footskip=1.2cm,headsep=0.777cm,headheight=1.5cm}
%<prefac|cotiza|beispiel>\FondoFactura{factura-ejemplo-fondo}
%<repuno>\FondoReporte{factura-ejemplo-membrete}
%<repdos>\FondoReporte*{factura-ejemplo-membrete}
%<repuno>\InicioReporte{2.2cm}
%<repuno|reptres>\TituloReporte{El t√≠tulo del reporte}
%<repdos>\TituloReporte*{El t√≠tulo del reporte}
%<reptres>\InfoPagina{La cabecera o pie del reporte - \Proveedor}
%<repuno|reptres>% \EstiloPagReporte{soloabajo}
%<repuno|reptres>% \EstiloPagReporte[soloabajo]{plain}
%<repuno|reptres>% \EstiloPagReporte[empty]{plain}
%<repdos|reptres>% \EstiloPagReporte[empty]{soloabajo}
%<reptres>% \EstiloPagReporte{plain}
%<repuno|repdos|reptres>% \EstiloPagReporte{solonumpag}
%<repdos>% \EstiloPagReporte{soloabajo}
%<repuno|reptres>% \EstiloPagReporte[solonumpag]{plain}
%<repuno|reptres>% \EstiloPagReporte[solonumpag]{soloarriba}
%<reptres>\EstiloPagReporte[solonumpag]{soloabajo}
%<repuno>% \EstiloPagReporte[solonumpag]{soloabajo}
%<repuno|reptres>% \EstiloPagReporte[empty]{soloarriba}
%<repuno|reptres>% \EstiloPagReporte{soloarriba}
%<cotiza>\FirmaFactura{\includegraphics[width=4.5cm]{factura-ejemplo-firma}}[0pt][17pt]
%<factdos|facttres|factsiete>\SepVertical{0.75cm}
%<factdos|factcinco>\SepDatosResumen{1cm}
%<factdos|facttres|factseis>\SepEncabezado{16pt}
%<factdos|factcuatro>\SepItemsExtra{5pt}
%<factdos|factseis>\SepDescripcion{16pt}
%<factnueve>\SepNotaPrevia{16pt}
%<factsiete>\SepFilas{1cm}{10pt}
%<factnueve>\SepNotaFinal{16pt}
%<facttres|factsiete>\LineaEncabezado{1pt}{20pt}{3pt}
%<factdiez>\LineaNotaPrevia{0pt}
%<factdos|factsiete>\LineaDescripcion{1pt}{20pt}{3pt}
%<factnueve>\LineaNotaFinal{0.4pt}{4pt}{3pt}
%<factsiete>\LineaFirmas{6.5cm}{2pt}
%<factsiete>% Puede usarse \PosFecha* o \PosDenom*, \PosControl* o \PosNotaFinal* para que el texto se despliegue en la posici√≥n 'Y' dada pero hacia arriba y no hacia abajo. \PosFirmas no acepta eso.
%<factnueve>\PosNotaFinal{.9cm}{.9cm}{-5.3cm}
%<factsiete>\PosFecha{-0cm}{-1.5cm}
%<factsiete>\PosFirmas{1cm}{1cm}{-3cm}
%<factsiete>\PosDenom{-0cm}{4.3cm}
%<factcuatro>\LetraDescripcion{\fontsize{20}{30}}
%<factcuatro>\LetraTitEnc{\fontsize{15}{20}\bfseries}
%<factcuatro>\LetraFirmas{\fontsize{16}{20}\itshape}
%<factcuatro>\LetraNotaFinal{\fontsize{18}{28}\bfseries}
%<factocho>\LetraItems{\fontsize{20}{30}}
%<factocho>\LetraNumeros{\fontsize{20}{30}}
%<factocho>\LetraTipoIVA{\fontsize{20}{30}\bfseries}
%<factocho>\LetraTitTotales{\fontsize{20}{30}\slshape}
%<factocho>\LetraNumTotales{\fontsize{20}{30}}
%<factocho>\LetraTitColumnas{\fontsize{15}{20}}
%<factocho>\LetraTitTotal{\fontsize{20}{30}\bfseries\slshape}
%<factocho>\LetraNumTotal{\fontsize{20}{30}\bfseries}
%<factocho>\tabcolsep7pt
%<!factuno&!factcinco&!prefac&!reptres>
%<cotiza>% \Denom{PRESUPUESTO} % Tambi√©n podemos cambiar el nombre del documento.
%<!factcuatro&!factnueve&!beispiel&!reptres>\NotaFinal{La nota final...}
%<factnueve>\NotaFinal{La factura se emiti√≥ el \Fecha{} con cr√©dito de \Credito{} dias, siendo su vencimiento el \FechaVencimiento.}
%<beispiel>\NotaFinal{Die Zahlungsbedingungen}
%<factuno|factdos|factcinco|factocho>\Resumen{El resumen opcional}
%<beispiel>\Resumen{Zusammenfassung}
%<factcuatro|factnueve|factdiez>\NotaPrevia{\hfill LA NOTA PREVIA}
%<factocho|factnueve>\NotaInterna{LA NOTA INTERNA}
%<factnueve>\NotaExterna{LA NOTA EXTERNA}

\begin{document}
%<!reptres>
%<!reptres>\begin{factura}
%<!factdos&!factcinco&!factseis&!repdos&!reptres&!beispiel> \Item{1}{√≠tem con IVA general}{1000}
%<factseis|repdos> \Item{2}{√≠tem con IVA general, viene con descuento}{1000}{8}[Un √≠tem que ofrecemos a precio de costo y que est√° gravado con IVA general]\label{primeritem}
%<factuno|factcuatro|repdos> \Item{4}{otro √≠tem con IVA general}{100}
%<cotiza> \Item{1}{otro √≠tem con IVA general}{1100}
%<cotiza> \Item{1}{otro √≠tem m√°s con IVA general}{1200}
%<facttres|prefac> \ItemR{1}{√≠tem con IVA reducido}{1000}
%<facttres> \ItemA{1}{√≠tem con IVA adicional}{1000}
%<facttres> \ItemE{1}{√≠tem exento de impuesto}{1000}
%<factdos|factseis> \Item{1}{√≠tem con IVA general, viene con descuento}{1000}{12}
%<factsiete|factocho> \Item{10}{otro √≠tem con IVA general (descripci√≥n larga para mostrar el cambio de l√≠nea)}[otro √≠tem con IVA general (esta descripci√≥n es s√≥lo para el .csv)]{1000}
%<factdos> \ItemR{1}{√≠tem con IVA reducido, viene con descuento}{1000}{5}
%<factdos> \ItemA{1}{√≠tem con IVA adicional, viene con descuento}{1000}{10}
%<factdos> \ItemE{1}{√≠tem exento de impuesto}{1000}
%<factdos|factcuatro> \ItemX{1}{l√≠nea sin precio}
%<factcinco> \Item{√≠tem sin cantidad, con IVA general}{1000}
%<factcinco> \ItemA{√≠tem sin cantidad, con IVA adicional}{1000}
%<factcinco> \ItemX{l√≠nea sin precio}
%<beispiel> \Item{1}{Artikel mit 19\% MwSt}{100}
%<beispiel> \ItemR{1}{Artikel mit 7\% MwSt}{100}
%<beispiel> \ItemE{1}{Artikel mit kein MwSt}{100}
%<!reptres>\end{factura}
%<!facttres&!reptres>
%<!facttres&!factseis&!reptres&!beispiel>\Descripcion{La descripci√≥n larga}
%<factseis>\Descripcion{
%<factseis>
%<beispiel>\Descripcion{Lange Beschreibung.}
%<factcinco|factocho|factnueve|factdiez|repuno|repdos|reptres>
%<factnueve|factdiez|repuno>\begin{reverso}
%<factnueve|factdiez|repuno>esquina superior izquierda del reverso\hfill esquina superior derecha del reverso\par
%<factnueve|factdiez|repuno>\vfill
%<factnueve|factdiez|repuno>esquina inferior izquierda del reverso\hfill esquina inferior derecha del reverso
%<factnueve|factdiez|repuno>\end{reverso}
%<repuno>
%<factcinco|factocho|repuno|repdos|reptres>\begin{reporte}
%<factcinco|factocho|repuno|repdos|reptres> El reporte - p√°gina 1\newpage El reporte - p√°gina 2 \newpage El reporte - p√°gina 3.
%<repdos>
%<factseis|repdos> Se facturaron en total \arabic{NumItem} art√≠culos.
%<factseis|repdos>
%<factseis|repdos> En el art√≠culo n√∫mero \itemref{primeritem} se facturaron \cantref{primeritem} ‚Äú\descref{primeritem}‚Äù, cada uno por un valor de \Moneda~\puref{primeritem}, dando un subtotal por este elemento de \Moneda~\subtref{primeritem}; el descuento en ese art√≠culo es del \dctoref{primeritem}\%, dando un total de \Moneda~\ptref{primeritem}, y esta gravado con IVA de \ivaref{primeritem}\%. Ampliando la descripci√≥n podemos decir que este √≠tem es: ‚Äú\ldescref{primeritem}‚Äù.
%<factseis|repdos>
%<factseis|repdos> La base imponible total de esta factura es de \Moneda~\numprint\BIG; el IVA es de \Moneda~\numprint\AlicuotaG,  y el total final es de \Moneda~\numprint\Total.
%<factseis|repdos>
%<factseis|repdos> % Estas son todas las macros para las totalizaciones: \BIG, \BIR, \BIA, \BIE, \AlicuotaG, \AlicuotaR, \AlicuotaA, \SubtG, \SubtR, \SubtA, \SubtE, \DescG, \DescR, \DescA, \DescE.
%<factseis>}
%<repuno> \vspace{1.5cm}\FirmaReporte
%<factocho> \FirmaReporte[\includegraphics[width=4.5cm]{factura-ejemplo-firma}][0pt][17pt]
%<repdos> \FirmaReporte[\includegraphics[width=4.5cm]{factura-ejemplo-firma}][0pt][17pt][3cm][3cm]
%<reptres> \FirmaReporte[\includegraphics[width=4.5cm]{factura-ejemplo-firma}][0pt][17pt]{el que firma}[4cm][0.8cm]
%<factcinco|factocho|repuno|repdos|reptres>\end{reporte}

%% Este es un comando auxiliar suministrado por factura-ejemplo-aux.tex para escribir el detalle del ejemplo en la √∫ltima hoja.
\Ejemplo

\end{document}
%</!class&!def&!firma&!fondo&!membrete&!aux&!batchfile>
%<*firma>
%% (PSTricks code generated with LaTeXDraw 2.0.8)
%% (Compilar con XeLaTeX)
\documentclass{standalone}
\usepackage[usenames,dvipsnames]{pstricks}
\begin{document}
 \begin{pspicture}(0,-3.19388)(13.8397665,3.18)
  \pscustom[linewidth=0.1,linecolor=red]{
   \newpath
   \moveto(0.0,0.9762225)
   \lineto(1.0057193,0.95771605)
   \curveto(1.5085789,0.94846284)(2.4492223,1.1335286)(2.8870058,1.3278477)
   \curveto(3.3247895,1.5221668)(4.064289,2.0079648)(4.366005,2.2994435)
   \curveto(4.667721,2.5909224)(4.9457726,2.9518008)(4.9221087,3.0212007)
   \curveto(4.8984447,3.0906003)(4.762377,3.16)(4.6499724,3.16)
   \curveto(4.5375686,3.16)(4.1175327,2.9934406)(3.8099012,2.8268814)
   \curveto(3.5022693,2.6603222)(2.721358,1.6748462)(2.2480783,0.85592973)
   \curveto(1.7747989,0.037013244)(1.1358713,-0.91607606)(0.97022337,-1.050249)
   \curveto(0.8045755,-1.1844217)(0.5975156,-1.3185943)(0.5561036,-1.3185943)
   \curveto(0.5146916,-1.3185943)(0.43186772,-1.2121814)(0.39045575,-1.1057684)
   \curveto(0.34904376,-0.9993555)(0.37270775,-0.7495166)(0.4377837,-0.6060907)
   \curveto(0.50285965,-0.46266478)(0.6152636,-0.3608783)(0.6625916,-0.4025183)
   \curveto(0.7099195,-0.44415832)(0.82232344,-0.56907773)(0.8873994,-0.65235716)
   \curveto(0.9524753,-0.7356369)(1.354763,-0.86980957)(1.6919748,-0.9207028)
   \curveto(2.0291865,-0.97159606)(2.5202143,-1.0178626)(2.67403,-1.0132358)
   \curveto(2.827846,-1.008609)(3.0112422,-0.9207028)(3.0408218,-0.8374231)
   \curveto(3.0704017,-0.75414366)(3.0999818,-0.69862366)(3.0999818,-0.7263837)
   \curveto(3.0999818,-0.75414366)(3.1709735,-0.80966306)(3.2419655,-0.8374231)
   \curveto(3.3129578,-0.8651831)(3.4667737,-0.80041015)(3.5495975,-0.7078772)
   \curveto(3.6324213,-0.6153442)(3.7744055,-0.6199707)(3.8335655,-0.7171304)
   \curveto(3.8927252,-0.81429017)(4.141197,-0.9114496)(4.330509,-0.9114496)
   \curveto(4.5198207,-0.9114496)(4.7978725,-0.86055636)(4.8866124,-0.80966306)
   \curveto(4.9753523,-0.75877017)(5.0995884,-0.74489015)(5.135084,-0.7819034)
   \curveto(5.1705804,-0.8189166)(5.324396,-0.8281702)(5.442716,-0.80041015)
   \curveto(5.5610366,-0.7726501)(5.6971045,-0.7680234)(5.7148523,-0.7911566)
   \curveto(5.7326,-0.81428987)(5.8745837,-0.83279663)(5.9988194,-0.8281699)
   \curveto(6.1230555,-0.8235431)(6.2887034,-0.78653014)(6.330116,-0.75414366)
   \curveto(6.3715277,-0.7217572)(6.454352,-0.69862366)(6.495764,-0.7078772)
   \curveto(6.537175,-0.7171304)(6.6554956,-0.6060907)(6.7324038,-0.48579803)
   \curveto(6.8093114,-0.36550537)(7.0163713,-0.041640013)(7.1465235,0.16193238)
   \curveto(7.2766747,0.36550477)(7.4245753,0.12491944)(7.442323,-0.3192389)
   \curveto(7.4600706,-0.7633969)(7.5133147,-1.6748462)(7.548811,-2.1421375)
   \curveto(7.5843067,-2.6094286)(7.5251465,-3.10448)(7.4304905,-3.13224)
   \curveto(7.335835,-3.16)(7.1465235,-3.17388)(7.051867,-3.16)
   \curveto(6.9572105,-3.14612)(6.9276304,-2.748228)(6.992707,-2.3642163)
   \curveto(7.057783,-1.980205)(7.436407,-1.4296337)(7.7499547,-1.2630746)
   \curveto(8.063502,-1.0965155)(8.619606,-0.80966306)(8.862162,-0.6893704)
   \curveto(9.104718,-0.56907773)(9.394602,-0.5181845)(9.441929,-0.58758426)
   \curveto(9.489257,-0.656984)(9.589829,-0.67549074)(9.643073,-0.6245975)
   \curveto(9.696317,-0.57370424)(9.767309,-0.5089313)(9.785057,-0.49505126)
   \curveto(9.802805,-0.48117125)(9.897461,-0.49505126)(9.974369,-0.5228113)
   \curveto(10.051277,-0.55057126)(10.175512,-0.62922424)(10.22284,-0.6801172)
   \curveto(10.270168,-0.73101014)(10.388489,-0.76802367)(10.45948,-0.75414366)
   \curveto(10.530473,-0.7402637)(10.65471,-0.6616107)(10.7079525,-0.59683746)
   \curveto(10.761196,-0.5320642)(10.838105,-0.5043045)(10.861769,-0.54131776)
   \curveto(10.885432,-0.5783307)(10.932761,-0.6477307)(10.956425,-0.6801172)
   \curveto(10.980088,-0.7125037)(11.033333,-0.75877017)(11.062913,-0.7726501)
   \curveto(11.092493,-0.78653014)(11.157568,-0.7680234)(11.193064,-0.7356369)
   \curveto(11.2285595,-0.7032504)(11.305469,-0.6662372)(11.34688,-0.6616107)
   \curveto(11.388292,-0.656984)(11.512528,-0.48579773)(11.595351,-0.31923857)
   \curveto(11.678176,-0.15267944)(11.778748,-0.02313324)(11.796496,-0.060146485)
   \curveto(11.814244,-0.09715942)(11.843824,-0.6569836)(11.855657,-1.1797949)
   \curveto(11.867488,-1.7026062)(11.87932,-2.2901905)(11.87932,-2.3549633)
   \curveto(11.87932,-2.4197364)(11.938479,-2.0773644)(11.997639,-1.6702198)
   \curveto(12.056799,-1.263075)(12.186951,-0.85592985)(12.257943,-0.85592985)
   \curveto(12.328936,-0.85592985)(12.459087,-0.8374231)(12.518247,-0.8189166)
   \curveto(12.577407,-0.80041015)(12.719391,-0.78653014)(12.802215,-0.7911566)
   \curveto(12.885039,-0.7957831)(13.03294,-0.7726501)(13.098015,-0.74489015)
   \curveto(13.163091,-0.7171301)(13.257747,-0.5922107)(13.287327,-0.49505126)
   \curveto(13.316907,-0.39789185)(13.352403,-0.33774537)(13.358318,-0.3747583)
   \curveto(13.364233,-0.41177154)(13.3878975,-0.48117125)(13.405647,-0.51355773)
   \curveto(13.423395,-0.5459442)(13.48847,-0.57370424)(13.535798,-0.56907773)
   \curveto(13.583126,-0.564451)(13.66595,-0.5598242)(13.701447,-0.5598242)
   \curveto(13.736943,-0.5598242)(13.784271,-0.5551978)(13.819766,-0.5413177)}
  \pscustom[linewidth=0.1,linecolor=red]{
   \newpath
   \moveto(12.952644,0.18)
   \lineto(13.020389,0.13)
   \curveto(13.05426,0.105)(13.135551,0.085)(13.182974,0.09)
   \curveto(13.230394,0.095)(13.304913,0.13)(13.332009,0.16)
   \curveto(13.359106,0.19)(13.399754,0.285)(13.413303,0.35)
   \curveto(13.426852,0.415)(13.4404,0.49)(13.4404,0.52)}
 \end{pspicture}
\end{document}
%</firma>
%<*fondo|membrete>
\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{tikz}\usetikzlibrary{positioning}
\usepackage{calc}
\usepackage[letterpaper,hmargin={1cm,1cm},vmargin={1cm,1cm},footskip=0pt,headsep=0pt,headheight=0pt]{geometry}
\parindent0pt
\lineskip0pt
\pagestyle{empty}
\begin{document}
 \begin{minipage}[b][\textheight]{\textwidth}
  \baselineskip13pt
  \parskip0pt
  \lineskip0pt
  \hspace*{\fill}%
  \begin{tikzpicture}
   \node (Nombre) [draw=none, fill=gray, rounded corners=4pt]{%
    \parbox{0.57\textwidth}{%
     \vspace*{0.1cm}%
     \centering
     \color{white}\fontfamily{ppl}\LARGE\bfseries
     L√°zaro de la Vega y San Rom√°n}};
   \node [node distance=0pt, below = of Nombre, outer sep=0pt, draw=gray, line width=2pt, inner sep=3.5pt, rounded corners=8pt]{%
    \parbox{0.66\textwidth}{%
     \vspace*{3pt}%
     \parskip2pt
     \centering
     \color{gray}\fontfamily{ppl}\footnotesize\bfseries
     Av. Garcilaso de la Vega, Qta. San Rom√°n, Santa M√≥nica, Caracas, Venezuela.
     \par
     Tel√©fono: +58 (123) 456.78.90 / email: l√°zaro@sanrom.√°n
     \vspace*{3pt}}};
  \end{tikzpicture}
  \hspace*{\fill}\par
  \hspace*{\fill}%
  \parbox{0.63\textwidth}{%
   \color{gray}\fontfamily{aer}\footnotesize\bfseries
   \hfill
   RIF: V-87.654.321-0}%
  \hspace*{\fill}\par
  \vfill\mbox{}%
%<fondo>  \fontsize{6}{8}\selectfont
%<fondo>  \hspace*{0.5cm}%
%<fondo>  \parskip2pt
%<fondo>  {\bfseries ESTA FORMA LIBRE VA SIN TACHADURA NI ENMIENDA \hfill S√ìLO EL ORIGINAL DA DERECHO A CR√âDITO FISCAL}
%<fondo>  \hspace*{0.5cm}\par
%<fondo>  \fontdimen2\font=0.55em
%<fondo>  Imprenta: \hfill IMPRESOS DE LA VEGA. Av. Garcilaso de la Vega, Qta. San Rom√°n, Santa M√≥nica, Caracas, Venezuela. RIF: R-87.654.321-0. Tlf: (0123) 456.78.90\newline
%<fondo>  \fontdimen2\font=0.65em
%<fondo>  e-mail: \hfill imprenta@sanrom.√°n. No. Providencia SENIAT 01/01060 de fecha 12/11/2008 - Control desde No. 00-000001 hasta No. 00-010000 / Fecha 01/01/2018.\par
 \end{minipage}
\end{document}
%</fondo|membrete>
%<*aux>
%% Helper file; not to be compiled standalone, only to be included on examples.
%% Archivo auxiliar; no para ser compilado sino para ser incluido en los ejemplos.
%%
\usepackage{xspace,catchfilebetweentags,regexpatch}
\def\ejemplooptcolor{\color{blue}}
\def\ejemplomacrocolor{\color{purple}}
\makeatletter
\catcode`\%=11
\catcode`\|=14
\newcommand{\Ejemplo}{|
 \newpage
 \ClearShipoutPictureBG
 \newgeometry{vmargin={2cm,2cm},hmargin={2cm,2cm},footskip=0pt,headheight=0pt,headsep=0pt,footnotesep=0pt}|
 \thispagestyle{empty}|
 \catcode`\<=12
 \catcode`\>=12
 \CatchFileBetweenDelims{\DescEjemplo}{\jobname.tex}{<desc>}{</desc>}[\catcode37=11\catcode13=14\makeatletter]|
 \catcode`\%=11
 \makeatletter
 \regexpatchcmd*{\DescEjemplo}{\cC.\cO[*]*}{\c{begingroup}\c{ejemplomacrocolor}\c{ttfamily}\c{string}\0\c{endgroup}\c{xspace}}{}{}|
 \regexpatchcmd*{\DescEjemplo}{(\()(\cL[a-zG]*)(\))}{(\c{begingroup}\c{ejemplooptcolor}\c{ttfamily}\2\c{endgroup})}{}{}|
 \xpatchcmd*{\DescEjemplo}{%% }{\item}{}{}|
 \xpatchcmd*{\DescEjemplo}{%%}{}{}{}|
 \makeatother
 {\bfseries Descripci\'on de este ejemplo {\slshape \jobname.tex}:}
 \begin{itemize}
  \DescEjemplo
 \end{itemize}
 \catcode`\%=14
 \catcode`\<=13
 \catcode`\>=13
 }
\catcode`\%=14
\catcode`\|=12
\makeatother
%</aux>
%    \end{macrocode}
% \Finale
% \starttodo
